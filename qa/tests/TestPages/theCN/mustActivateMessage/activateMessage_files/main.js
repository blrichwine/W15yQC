//     (c) 2010-2012 Jeremy Ashkenas, DocumentCloud Inc.

//     Backbone may be freely distributed under the MIT license.

/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

/*!
 * Amplify Core 1.1.0
 * 
 * Copyright 2011 appendTo LLC. (http://appendto.com/team)
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 * 
 * http://amplifyjs.com
 */

/*!
 * Amplify Store - Persistent Client-Side Storage 1.1.0
 * 
 * Copyright 2011 appendTo LLC. (http://appendto.com/team)
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 * 
 * http://amplifyjs.com
 */

/*!
 * Amplify Request 1.1.0
 * 
 * Copyright 2011 appendTo LLC. (http://appendto.com/team)
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 * 
 * http://amplifyjs.com
 */

// Copyright (c) 2012 Florian H., https://github.com/js-coder https://github.com/js-coder/cookie.js

/**
 * @license RequireJS text 2.0.5 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

/*!
 * fancyBox - jQuery Plugin
 * version: 2.1.4 (Thu, 10 Jan 2013)
 * @requires jQuery v1.6 or later
 *
 * Examples at http://fancyapps.com/fancybox/
 * License: www.fancyapps.com/fancybox/#license
 *
 * Copyright 2012 Janis Skarnelis - janis@fancyapps.com
 *
 */

/*!
 * backbone.layoutmanager.js v0.7.1
 * Copyright 2012, Tim Branyen (@tbranyen)
 * backbone.layoutmanager.js may be freely distributed under the MIT license.
 * http://tbranyen.github.com/backbone.layoutmanager/
 */

/*
 * Date Format 1.2.3
 * (c) 2007-2009 Steven Levithan <stevenlevithan.com>
 * http://blog.stevenlevithan.com/archives/date-time-format
 * MIT license
 *
 * Includes enhancements by Scott Trenda <scott.trenda.net>
 * and Kris Kowal <cixar.com/~kris.kowal/>
 *
 * Accepts a date, a mask, or a date and a mask.
 * Returns a formatted version of the given date.
 * The date defaults to the current date/time.
 * The mask defaults to dateFormat.masks.default.
 */

/*
	jQuery Autosize v1.16.6
	(c) 2013 Jack Moore - jacklmoore.com
	updated: 2013-03-12
	license: http://www.opensource.org/licenses/mit-license.php
*/

/*! jQuery UI - v1.9.2 - 2013-02-04
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.position.js, jquery.ui.draggable.js, jquery.ui.autocomplete.js, jquery.ui.datepicker.js, jquery.ui.menu.js
* Copyright (c) 2013 jQuery Foundation and other contributors Licensed MIT */

(function(){var e=this,t=e._,n={},i=Array.prototype,r=Object.prototype,o=Function.prototype,s=i.push,a=i.slice,u=i.concat,l=r.toString,c=r.hasOwnProperty,d=i.forEach,f=i.map,h=i.reduce,p=i.reduceRight,m=i.filter,g=i.every,v=i.some,y=i.indexOf,b=i.lastIndexOf,_=Array.isArray,w=Object.keys,x=o.bind,k=function(e){return e instanceof k?e:this instanceof k?(this._wrapped=e,void 0):new k(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=k),exports._=k):e._=k,k.VERSION="1.4.3";var C=k.each=k.forEach=function(e,t,i){if(null!=e)if(d&&e.forEach===d)e.forEach(t,i);else if(e.length===+e.length){for(var r=0,o=e.length;o>r;r++)if(t.call(i,e[r],r,e)===n)return}else for(var s in e)if(k.has(e,s)&&t.call(i,e[s],s,e)===n)return};k.map=k.collect=function(e,t,n){var i=[];return null==e?i:f&&e.map===f?e.map(t,n):(C(e,function(e,r,o){i[i.length]=t.call(n,e,r,o)}),i)};var T="Reduce of empty array with no initial value";k.reduce=k.foldl=k.inject=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),h&&e.reduce===h)return i&&(t=k.bind(t,i)),r?e.reduce(t,n):e.reduce(t);if(C(e,function(e,o,s){r?n=t.call(i,n,e,o,s):(n=e,r=!0)}),!r)throw new TypeError(T);return n},k.reduceRight=k.foldr=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return i&&(t=k.bind(t,i)),r?e.reduceRight(t,n):e.reduceRight(t);var o=e.length;if(o!==+o){var s=k.keys(e);o=s.length}if(C(e,function(a,u,l){u=s?s[--o]:--o,r?n=t.call(i,n,e[u],u,l):(n=e[u],r=!0)}),!r)throw new TypeError(T);return n},k.find=k.detect=function(e,t,n){var i;return E(e,function(e,r,o){return t.call(n,e,r,o)?(i=e,!0):void 0}),i},k.filter=k.select=function(e,t,n){var i=[];return null==e?i:m&&e.filter===m?e.filter(t,n):(C(e,function(e,r,o){t.call(n,e,r,o)&&(i[i.length]=e)}),i)},k.reject=function(e,t,n){return k.filter(e,function(e,i,r){return!t.call(n,e,i,r)},n)},k.every=k.all=function(e,t,i){t||(t=k.identity);var r=!0;return null==e?r:g&&e.every===g?e.every(t,i):(C(e,function(e,o,s){return(r=r&&t.call(i,e,o,s))?void 0:n}),!!r)};var E=k.some=k.any=function(e,t,i){t||(t=k.identity);var r=!1;return null==e?r:v&&e.some===v?e.some(t,i):(C(e,function(e,o,s){return r||(r=t.call(i,e,o,s))?n:void 0}),!!r)};k.contains=k.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):E(e,function(e){return e===t})},k.invoke=function(e,t){var n=a.call(arguments,2);return k.map(e,function(e){return(k.isFunction(t)?t:e[t]).apply(e,n)})},k.pluck=function(e,t){return k.map(e,function(e){return e[t]})},k.where=function(e,t){return k.isEmpty(t)?[]:k.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},k.max=function(e,t,n){if(!t&&k.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&k.isEmpty(e))return-1/0;var i={computed:-1/0,value:-1/0};return C(e,function(e,r,o){var s=t?t.call(n,e,r,o):e;s>=i.computed&&(i={value:e,computed:s})}),i.value},k.min=function(e,t,n){if(!t&&k.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&k.isEmpty(e))return 1/0;var i={computed:1/0,value:1/0};return C(e,function(e,r,o){var s=t?t.call(n,e,r,o):e;i.computed>s&&(i={value:e,computed:s})}),i.value},k.shuffle=function(e){var t,n=0,i=[];return C(e,function(e){t=k.random(n++),i[n-1]=i[t],i[t]=e}),i};var S=function(e){return k.isFunction(e)?e:function(t){return t[e]}};k.sortBy=function(e,t,n){var i=S(t);return k.pluck(k.map(e,function(e,t,r){return{value:e,index:t,criteria:i.call(n,e,t,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(i>n||void 0===i)return-1}return e.index<t.index?-1:1}),"value")};var D=function(e,t,n,i){var r={},o=S(t||k.identity);return C(e,function(t,s){var a=o.call(n,t,s,e);i(r,a,t)}),r};k.groupBy=function(e,t,n){return D(e,t,n,function(e,t,n){(k.has(e,t)?e[t]:e[t]=[]).push(n)})},k.countBy=function(e,t,n){return D(e,t,n,function(e,t){k.has(e,t)||(e[t]=0),e[t]++})},k.sortedIndex=function(e,t,n,i){n=null==n?k.identity:S(n);for(var r=n.call(i,t),o=0,s=e.length;s>o;){var a=o+s>>>1;r>n.call(i,e[a])?o=a+1:s=a}return o},k.toArray=function(e){return e?k.isArray(e)?a.call(e):e.length===+e.length?k.map(e,k.identity):k.values(e):[]},k.size=function(e){return null==e?0:e.length===+e.length?e.length:k.keys(e).length},k.first=k.head=k.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:a.call(e,0,t)},k.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},k.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},k.rest=k.tail=k.drop=function(e,t,n){return a.call(e,null==t||n?1:t)},k.compact=function(e){return k.filter(e,k.identity)};var N=function(e,t,n){return C(e,function(e){k.isArray(e)?t?s.apply(n,e):N(e,t,n):n.push(e)}),n};k.flatten=function(e,t){return N(e,t,[])},k.without=function(e){return k.difference(e,a.call(arguments,1))},k.uniq=k.unique=function(e,t,n,i){k.isFunction(t)&&(i=n,n=t,t=!1);var r=n?k.map(e,n,i):e,o=[],s=[];return C(r,function(n,i){(t?i&&s[s.length-1]===n:k.contains(s,n))||(s.push(n),o.push(e[i]))}),o},k.union=function(){return k.uniq(u.apply(i,arguments))},k.intersection=function(e){var t=a.call(arguments,1);return k.filter(k.uniq(e),function(e){return k.every(t,function(t){return k.indexOf(t,e)>=0})})},k.difference=function(e){var t=u.apply(i,a.call(arguments,1));return k.filter(e,function(e){return!k.contains(t,e)})},k.zip=function(){for(var e=a.call(arguments),t=k.max(k.pluck(e,"length")),n=Array(t),i=0;t>i;i++)n[i]=k.pluck(e,""+i);return n},k.object=function(e,t){if(null==e)return{};for(var n={},i=0,r=e.length;r>i;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},k.indexOf=function(e,t,n){if(null==e)return-1;var i=0,r=e.length;if(n){if("number"!=typeof n)return i=k.sortedIndex(e,t),e[i]===t?i:-1;i=0>n?Math.max(0,r+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;r>i;i++)if(e[i]===t)return i;return-1},k.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(b&&e.lastIndexOf===b)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var r=i?n:e.length;r--;)if(e[r]===t)return r;return-1},k.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=0,o=Array(i);i>r;)o[r++]=e,e+=n;return o};var A=function(){};k.bind=function(e,t){var n,i;if(e.bind===x&&x)return x.apply(e,a.call(arguments,1));if(!k.isFunction(e))throw new TypeError;return n=a.call(arguments,2),i=function(){if(!(this instanceof i))return e.apply(t,n.concat(a.call(arguments)));A.prototype=e.prototype;var r=new A;A.prototype=null;var o=e.apply(r,n.concat(a.call(arguments)));return Object(o)===o?o:r}},k.bindAll=function(e){var t=a.call(arguments,1);return 0==t.length&&(t=k.functions(e)),C(t,function(t){e[t]=k.bind(e[t],e)}),e},k.memoize=function(e,t){var n={};return t||(t=k.identity),function(){var i=t.apply(this,arguments);return k.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},k.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},k.defer=function(e){return k.delay.apply(k,[e,1].concat(a.call(arguments,1)))},k.throttle=function(e,t){var n,i,r,o,s=0,a=function(){s=new Date,r=null,o=e.apply(n,i)};return function(){var u=new Date,l=t-(u-s);return n=this,i=arguments,0>=l?(clearTimeout(r),r=null,s=u,o=e.apply(n,i)):r||(r=setTimeout(a,l)),o}},k.debounce=function(e,t,n){var i,r;return function(){var o=this,s=arguments,a=function(){i=null,n||(r=e.apply(o,s))},u=n&&!i;return clearTimeout(i),i=setTimeout(a,t),u&&(r=e.apply(o,s)),r}},k.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},k.wrap=function(e,t){return function(){var n=[e];return s.apply(n,arguments),t.apply(this,n)}},k.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},k.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},k.keys=w||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)k.has(e,n)&&(t[t.length]=n);return t},k.values=function(e){var t=[];for(var n in e)k.has(e,n)&&t.push(e[n]);return t},k.pairs=function(e){var t=[];for(var n in e)k.has(e,n)&&t.push([n,e[n]]);return t},k.invert=function(e){var t={};for(var n in e)k.has(e,n)&&(t[e[n]]=n);return t},k.functions=k.methods=function(e){var t=[];for(var n in e)k.isFunction(e[n])&&t.push(n);return t.sort()},k.extend=function(e){return C(a.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},k.pick=function(e){var t={},n=u.apply(i,a.call(arguments,1));return C(n,function(n){n in e&&(t[n]=e[n])}),t},k.omit=function(e){var t={},n=u.apply(i,a.call(arguments,1));for(var r in e)k.contains(n,r)||(t[r]=e[r]);return t},k.defaults=function(e){return C(a.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},k.clone=function(e){return k.isObject(e)?k.isArray(e)?e.slice():k.extend({},e):e},k.tap=function(e,t){return t(e),e};var F=function(e,t,n,i){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof k&&(e=e._wrapped),t instanceof k&&(t=t._wrapped);var r=l.call(e);if(r!=l.call(t))return!1;switch(r){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=n.length;o--;)if(n[o]==e)return i[o]==t;n.push(e),i.push(t);var s=0,a=!0;if("[object Array]"==r){if(s=e.length,a=s==t.length)for(;s--&&(a=F(e[s],t[s],n,i)););}else{var u=e.constructor,c=t.constructor;if(u!==c&&!(k.isFunction(u)&&u instanceof u&&k.isFunction(c)&&c instanceof c))return!1;for(var d in e)if(k.has(e,d)&&(s++,!(a=k.has(t,d)&&F(e[d],t[d],n,i))))break;if(a){for(d in t)if(k.has(t,d)&&!s--)break;a=!s}}return n.pop(),i.pop(),a};k.isEqual=function(e,t){return F(e,t,[],[])},k.isEmpty=function(e){if(null==e)return!0;if(k.isArray(e)||k.isString(e))return 0===e.length;for(var t in e)if(k.has(e,t))return!1;return!0},k.isElement=function(e){return!(!e||1!==e.nodeType)},k.isArray=_||function(e){return"[object Array]"==l.call(e)},k.isObject=function(e){return e===Object(e)},C(["Arguments","Function","String","Number","Date","RegExp"],function(e){k["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),k.isArguments(arguments)||(k.isArguments=function(e){return!(!e||!k.has(e,"callee"))}),k.isFunction=function(e){return"function"==typeof e},k.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},k.isNaN=function(e){return k.isNumber(e)&&e!=+e},k.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==l.call(e)},k.isNull=function(e){return null===e},k.isUndefined=function(e){return void 0===e},k.has=function(e,t){return c.call(e,t)},k.noConflict=function(){return e._=t,this},k.identity=function(e){return e},k.times=function(e,t,n){for(var i=Array(e),r=0;e>r;r++)i[r]=t.call(n,r);return i},k.random=function(e,t){return null==t&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var j={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};j.unescape=k.invert(j.escape);var M={escape:RegExp("["+k.keys(j.escape).join("")+"]","g"),unescape:RegExp("("+k.keys(j.unescape).join("|")+")","g")};k.each(["escape","unescape"],function(e){k[e]=function(t){return null==t?"":(""+t).replace(M[e],function(t){return j[e][t]})}}),k.result=function(e,t){if(null==e)return null;var n=e[t];return k.isFunction(n)?n.call(e):n},k.mixin=function(e){C(k.functions(e),function(t){var n=k[t]=e[t];k.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),q.call(this,n.apply(k,e))}})};var O=0;k.uniqueId=function(e){var t=""+ ++O;return e?e+t:t},k.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,I={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},R=/\\|'|\r|\n|\t|\u2028|\u2029/g;k.template=function(e,t,n){n=k.defaults({},n,k.templateSettings);var i=RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),r=0,o="__p+='";e.replace(i,function(t,n,i,s,a){return o+=e.slice(r,a).replace(R,function(e){return"\\"+I[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(o+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),s&&(o+="';\n"+s+"\n__p+='"),r=a+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{var s=Function(n.variable||"obj","_",o)}catch(a){throw a.source=o,a}if(t)return s(t,k);var u=function(e){return s.call(this,e,k)};return u.source="function("+(n.variable||"obj")+"){\n"+o+"}",u},k.chain=function(e){return k(e).chain()};var q=function(e){return this._chain?k(e).chain():e};k.mixin(k),C(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];k.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],q.call(this,n)}}),C(["concat","join","slice"],function(e){var t=i[e];k.prototype[e]=function(){return q.call(this,t.apply(this._wrapped,arguments))}}),k.extend(k.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),define("underscore",["jquery"],function(e){return function(){var t;return t||e._}}(this)),function(){var e,t=this,n=t.Backbone,i=Array.prototype.slice,r=Array.prototype.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="0.9.2";var o=t._;o||"undefined"==typeof require||(o=require("underscore"));var s=t.jQuery||t.Zepto||t.ender;e.$=s,e.setDomLibrary=function(e){s=e},e.noConflict=function(){return t.Backbone=n,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=/\s+/,u=e.Events={on:function(e,t,n){var i,r,o,s,u;if(!t)return this;for(e=e.split(a),i=this._callbacks||(this._callbacks={});r=e.shift();)u=i[r],o=u?u.tail:{},o.next=s={},o.context=n,o.callback=t,i[r]={tail:s,next:u?u.next:o};return this},off:function(e,t,n){var i,r,s,u,l,c;if(r=this._callbacks){if(!(e||t||n))return delete this._callbacks,this;for(e=e?e.split(a):o.keys(r);i=e.shift();)if(s=r[i],delete r[i],s&&(t||n))for(u=s.tail;(s=s.next)!==u;)l=s.callback,c=s.context,(t&&l!==t||n&&c!==n)&&this.on(i,l,c);return this}},trigger:function(e){var t,n,r,o,s,u,l;if(!(r=this._callbacks))return this;for(u=r.all,e=e.split(a),l=i.call(arguments,1);t=e.shift();){if(n=r[t])for(o=n.tail;(n=n.next)!==o;)n.callback.apply(n.context||this,l);if(n=u)for(o=n.tail,s=[t].concat(l);(n=n.next)!==o;)n.callback.apply(n.context||this,s)}return this}};u.bind=u.on,u.unbind=u.off;var l=e.Model=function(e,t){var n;e||(e={}),t&&t.parse&&(e=this.parse(e)),(n=N(this,"defaults"))&&(e=o.extend({},n,e)),t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=o.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=o.clone(this.attributes),this.initialize.apply(this,arguments)};o.extend(l.prototype,u,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var n=this.get(e);return this._escapedAttributes[e]=o.escape(null==n?"":""+n)},has:function(e){return null!=this.get(e)},set:function(e,t,n){var i,r,s;if(o.isObject(e)||null==e?(i=e,n=t):(i={},i[e]=t),n||(n={}),!i)return this;if(i instanceof l&&(i=i.attributes),n.unset)for(r in i)i[r]=void 0;if(!this._validate(i,n))return!1;this.idAttribute in i&&(this.id=i[this.idAttribute]);var a=n.changes={},u=this.attributes,c=this._escapedAttributes,d=this._previousAttributes||{};for(r in i)s=i[r],(!o.isEqual(u[r],s)||n.unset&&o.has(u,r))&&(delete c[r],(n.silent?this._silent:a)[r]=!0),n.unset?delete u[r]:u[r]=s,o.isEqual(d[r],s)&&o.has(u,r)==o.has(d,r)?(delete this.changed[r],delete this._pending[r]):(this.changed[r]=s,n.silent||(this._pending[r]=!0));return n.silent||this.change(n),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,o.extend({},e,{unset:!0}))},fetch:function(t){t=t?o.clone(t):{};var n=this,i=t.success;return t.success=function(e,r,o){return n.set(n.parse(e,o),t)?(i&&i(n,e),void 0):!1},t.error=e.wrapError(t.error,n,t),(this.sync||e.sync).call(this,"read",this,t)},save:function(t,n,i){var r,s;if(o.isObject(t)||null==t?(r=t,i=n):(r={},r[t]=n),i=i?o.clone(i):{},i.wait){if(!this._validate(r,i))return!1;s=o.clone(this.attributes)}var a=o.extend({},i,{silent:!0});if(r&&!this.set(r,i.wait?a:i))return!1;var u=this,l=i.success;i.success=function(e,t,n){var s=u.parse(e,n);return i.wait&&(delete i.wait,s=o.extend(r||{},s)),u.set(s,i)?(l?l(u,e):u.trigger("sync",u,e,i),void 0):!1},i.error=e.wrapError(i.error,u,i);var c=this.isNew()?"create":"update",d=(this.sync||e.sync).call(this,c,this,i);return i.wait&&this.set(s,a),d},destroy:function(t){t=t?o.clone(t):{};var n=this,i=t.success,r=function(){n.trigger("destroy",n,n.collection,t)};if(this.isNew())return r(),!1;t.success=function(e){t.wait&&r(),i?i(n,e):n.trigger("sync",n,e,t)},t.error=e.wrapError(t.error,n,t);var s=(this.sync||e.sync).call(this,"delete",this,t);return t.wait||r(),s},url:function(){var e=N(this,"urlRoot")||N(this.collection,"url")||A();return this.isNew()?e:e+("/"==e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var n in this._silent)this._pending[n]=!0;var i=o.extend({},e.changes,this._silent);this._silent={};for(var n in i)this.trigger("change:"+n,this,this.get(n),e);if(t)return this;for(;!o.isEmpty(this._pending);){this._pending={},this.trigger("change",this,e);for(var n in this.changed)this._pending[n]||this._silent[n]||delete this.changed[n];this._previousAttributes=o.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?o.has(this.changed,e):!o.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?o.clone(this.changed):!1;var t,n=!1,i=this._previousAttributes;for(var r in e)o.isEqual(i[r],t=e[r])||((n||(n={}))[r]=t);return n},previous:function(e){return arguments.length&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=o.extend({},this.attributes,e);var n=this.validate(e,t);return n?(t&&t.error?t.error(this,n,t):this.trigger("error",this,n,t),!1):!0}});var c=e.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};o.extend(c.prototype,u,{model:l,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var n,i,s,a,u,l,c={},d={},f=[];for(t||(t={}),e=o.isArray(e)?e.slice():[e],n=0,s=e.length;s>n;n++){if(!(a=e[n]=this._prepareModel(e[n],t)))throw Error("Can't add an invalid model to a collection");u=a.cid,l=a.id,c[u]||this._byCid[u]||null!=l&&(d[l]||this._byId[l])?f.push(n):c[u]=d[l]=a}for(n=f.length;n--;)e.splice(f[n],1);for(n=0,s=e.length;s>n;n++)(a=e[n]).on("all",this._onModelEvent,this),this._byCid[a.cid]=a,null!=a.id&&(this._byId[a.id]=a);if(this.length+=s,i=null!=t.at?t.at:this.models.length,r.apply(this.models,[i,0].concat(e)),this.comparator&&this.sort({silent:!0}),t.silent)return this;for(n=0,s=this.models.length;s>n;n++)c[(a=this.models[n]).cid]&&(t.index=n,a.trigger("add",a,this,t));return this},remove:function(e,t){var n,i,r,s;for(t||(t={}),e=o.isArray(e)?e.slice():[e],n=0,i=e.length;i>n;n++)s=this.getByCid(e[n])||this.get(e[n]),s&&(delete this._byId[s.id],delete this._byCid[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,t.silent||(t.index=r,s.trigger("remove",s,this,t)),this._removeReference(s));return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,o.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return o.isEmpty(e)?[]:this.filter(function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},sort:function(e){if(e||(e={}),!this.comparator)throw Error("Cannot sort a set without a comparator");var t=o.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return o.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var n=0,i=this.models.length;i>n;n++)this._removeReference(this.models[n]);return this._reset(),this.add(e,o.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(t){t=t?o.clone(t):{},void 0===t.parse&&(t.parse=!0);var n=this,i=t.success;return t.success=function(e,r,o){n[t.add?"add":"reset"](n.parse(e,o),t),i&&i(n,e)},t.error=e.wrapError(t.error,n,t),(this.sync||e.sync).call(this,"read",this,t)},create:function(e,t){var n=this;if(t=t?o.clone(t):{},e=this._prepareModel(e,t),!e)return!1;t.wait||n.add(e,t);var i=t.success;return t.success=function(r,o){t.wait&&n.add(r,t),i?i(r,o):r.trigger("sync",e,o,t)},e.save(null,t),e},parse:function(e){return e},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(t||(t={}),e instanceof l)e.collection||(e.collection=this);else{var n=e;t.collection=this,e=new this.model(n,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!=e&&"remove"!=e||n==this)&&("destroy"==e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments))}});var d=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];o.each(d,function(e){c.prototype[e]=function(){return o[e].apply(o,[this.models].concat(o.toArray(arguments)))}});var f=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},h=/\((.*?)\)/g,p=/:\w+/g,m=/\*\w+/g,g=/[\-{}\[\]+?.,\\\^$|#\s]/g;o.extend(f.prototype,u,{initialize:function(){},route:function(t,n,i){return o.isRegExp(t)||(t=this._routeToRegExp(t)),i||(i=this[n]),e.history.route(t,o.bind(function(r){var o=this._extractParameters(t,r);i&&i.apply(this,o),this.trigger.apply(this,["route:"+n].concat(o)),e.history.trigger("route",this,n,o)},this)),this},navigate:function(t,n){return e.history.navigate(t,n),this},_bindRoutes:function(){if(this.routes)for(var e,t=o.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])},_routeToRegExp:function(e){return e=e.replace(g,"\\$&").replace(h,"(?:$1)?").replace(p,"([^/]+)").replace(m,"(.*?)"),RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var v=e.History=function(){this.handlers=[],o.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},y=/^[#\/]|\s+$/g,b=/^\/+|\/+$/g,_=/msie [\w.]+/,w=/\/$/;v.started=!1,o.extend(v.prototype,u,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(w,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(y,"")},start:function(t){if(v.started)throw Error("Backbone.history has already been started");v.started=!0,this.options=o.extend({},{root:"/"},this.options,t),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var n=this.getFragment(),i=document.documentMode,r=_.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);this.root=("/"+this.root+"/").replace(b,"/"),r&&this._wantsHashChange&&(this.iframe=e.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(n)),this._hasPushState?e.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!r?e.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=n;var s=this.location,a=s.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&s.hash&&(this.fragment=this.getHash().replace(y,""),this.history.replaceState({},document.title,this.root+this.fragment+s.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){e.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),v.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),n=o.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return n},navigate:function(e,t){if(!v.started)return!1;if(t&&t!==!0||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),e.history=new v;var x=e.View=function(e){this.cid=o.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},k=/^(\S+)\s*(.*)$/,C=["model","collection","el","id","attributes","className","tagName"];o.extend(x.prototype,u,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,n){var i=document.createElement(e);return t&&s(i).attr(t),n&&s(i).html(n),i},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof s?e:s(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=N(this,"events"))){this.undelegateEvents();for(var t in e){var n=e[t];if(o.isFunction(n)||(n=this[e[t]]),!n)throw Error('Method "'+e[t]+'" does not exist');var i=t.match(k),r=i[1],s=i[2];n=o.bind(n,this),r+=".delegateEvents"+this.cid,""===s?this.$el.bind(r,n):this.$el.delegate(s,r,n)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=o.extend({},this.options,e));for(var t=0,n=C.length;n>t;t++){var i=C[t];e[i]&&(this[i]=e[i])}this.options=e},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var e=N(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}}});var T=function(e,t){var n=D(this,e,t);return n.extend=this.extend,n};l.extend=c.extend=f.extend=x.extend=T;var E={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};e.sync=function(t,n,i){var r=E[t];i||(i={});var a={type:r,dataType:"json"};return i.url||(a.url=N(n,"url")||A()),i.data||!n||"create"!=t&&"update"!=t||(a.contentType="application/json",a.data=JSON.stringify(n.toJSON())),e.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),e.emulateHTTP&&("PUT"===r||"DELETE"===r)&&(e.emulateJSON&&(a.data._method=r),a.type="POST",a.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}),"GET"===a.type||e.emulateJSON||(a.processData=!1),s.ajax(o.extend(a,i))},e.wrapError=function(e,t,n){return function(i,r){r=i===t?r:i,e?e(t,r,n):t.trigger("error",t,r,n)}};var S=function(){},D=function(e,t,n){var i;return i=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},o.extend(i,e),S.prototype=e.prototype,i.prototype=new S,t&&o.extend(i.prototype,t),n&&o.extend(i,n),i.prototype.constructor=i,i.__super__=e.prototype,i},N=function(e,t){return e&&e[t]?o.isFunction(e[t])?e[t]():e[t]:null},A=function(){throw Error('A "url" property or function must be specified')}}.call(this),define("backbone",["underscore","jquery"],function(e){return function(){var t;return t||e.Backbone}}(this));var Mustache;(function(e){"undefined"!=typeof module&&module.exports?module.exports=e:"function"==typeof define?define("mustache",e):Mustache=e})(function(){function e(e,t){return RegExp.prototype.test.call(e,t)}function t(t){return!e(m,t)}function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return _[e]})}function r(e){this.string=e,this.tail=e,this.pos=0}function o(e,t){this.view=e,this.parent=t,this.clearCache()}function s(){this.clearCache()}function a(e){for(var t,n=e[3],i=n;(t=e[4])&&t.length;)e=t[t.length-1],i=e[3];return[n,i]}function u(e){function t(e,t,i){if(!n[e]){var r=u(t);n[e]=function(e,t){return r(e,t,i)}}return n[e]}var n={};return function(n,i,r){for(var o,s,u="",l=0,c=e.length;c>l;++l)switch(o=e[l],o[0]){case"#":s=r.slice.apply(r,a(o)),u+=n._section(o[1],i,s,t(l,o[4],r));break;case"^":u+=n._inverted(o[1],i,t(l,o[4],r));break;case">":u+=n._partial(o[1],i);break;case"&":u+=n._name(o[1],i);break;case"name":u+=n._escaped(o[1],i);break;case"text":u+=o[1]}return u}}function l(e){for(var t,n,i=[],r=i,o=[],s=0;e.length>s;++s)switch(t=e[s],t[0]){case"#":case"^":t[4]=[],o.push(t),r.push(t),r=t[4];break;case"/":if(0===o.length)throw Error("Unopened section: "+t[1]);if(n=o.pop(),n[1]!==t[1])throw Error("Unclosed section: "+n[1]);r=o.length>0?o[o.length-1][4]:i;break;default:r.push(t)}if(n=o.pop())throw Error("Unclosed section: "+n[1]);return i}function c(e){for(var t,n,i=0;e.length>i;++i)t=e[i],n&&"text"===n[0]&&"text"===t[0]?(n[1]+=t[1],n[3]=t[3],e.splice(i--,1)):n=t}function d(e){if(2!==e.length)throw Error("Invalid tags: "+e.join(" "));return[RegExp(n(e[0])+"\\s*"),RegExp("\\s*"+n(e[1]))]}var f={};f.name="mustache.js",f.version="0.7.0",f.tags=["{{","}}"],f.Scanner=r,f.Context=o,f.Writer=s;var h=/\s*/,p=/\s+/,m=/\S/,g=/\s*=/,v=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/,b=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)
},_={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.escape=i,r.prototype.eos=function(){return""===this.tail},r.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},r.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return t},o.make=function(e){return e instanceof o?e:new o(e)},o.prototype.clearCache=function(){this._cache={}},o.prototype.push=function(e){return new o(e,this)},o.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."===e)t=this.view;else for(var n=this;n;){if(e.indexOf(".")>0){var i=e.split("."),r=0;for(t=n.view;t&&i.length>r;)t=t[i[r++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},s.prototype.clearCache=function(){this._cache={},this._partialCache={}},s.prototype.compile=function(e,t){var n=this._cache[e];if(!n){var i=f.parse(e,t);n=this._cache[e]=this.compileTokens(i,e)}return n},s.prototype.compilePartial=function(e,t,n){var i=this.compile(t,n);return this._partialCache[e]=i,i},s.prototype.compileTokens=function(e,t){var n=u(e),i=this;return function(e,r){if(r)if("function"==typeof r)i._loadPartial=r;else for(var s in r)i.compilePartial(s,r[s]);return n(i,o.make(e),t)}},s.prototype.render=function(e,t,n){return this.compile(e)(t,n)},s.prototype._section=function(e,t,n,i){var r=t.lookup(e);switch(typeof r){case"object":if(b(r)){for(var o="",s=0,a=r.length;a>s;++s)o+=i(this,t.push(r[s]));return o}return r?i(this,t.push(r)):"";case"function":var u=this,l=function(e){return u.render(e,t)};return r.call(t.view,n,l)||"";default:if(r)return i(this,t)}return""},s.prototype._inverted=function(e,t,n){var i=t.lookup(e);return!i||b(i)&&0===i.length?n(this,t):""},s.prototype._partial=function(e,t){e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e));var n=this._partialCache[e];return n?n(t):""},s.prototype._name=function(e,t){var n=t.lookup(e);return"function"==typeof n&&(n=n.call(t.view)),null==n?"":n+""},s.prototype._escaped=function(e,t){return f.escape(this._name(e,t))},f.parse=function(e,i){function o(){if(k&&!C)for(;x.length;)w.splice(x.pop(),1);else x=[];k=!1,C=!1}i=i||f.tags;for(var s,a,u,m,b=d(i),_=new r(e),w=[],x=[],k=!1,C=!1;!_.eos();){if(s=_.pos,u=_.scanUntil(b[0]))for(var T=0,E=u.length;E>T;++T)m=u.charAt(T),t(m)?x.push(w.length):C=!0,w.push(["text",m,s,s+1]),s+=1,"\n"===m&&o();if(s=_.pos,!_.scan(b[0]))break;if(k=!0,a=_.scan(y)||"name",_.scan(h),"="===a)u=_.scanUntil(g),_.scan(g),_.scanUntil(b[1]);else if("{"===a){var S=RegExp("\\s*"+n("}"+i[1]));u=_.scanUntil(S),_.scan(v),_.scanUntil(b[1]),a="&"}else u=_.scanUntil(b[1]);if(!_.scan(b[1]))throw Error("Unclosed tag at "+_.pos);w.push([a,u,s,_.pos]),("name"===a||"{"===a||"&"===a)&&(C=!0),"="===a&&(i=u.split(p),b=d(i))}return c(w),l(w)};var w=new s;return f.clearCache=function(){return w.clearCache()},f.compile=function(e,t){return w.compile(e,t)},f.compilePartial=function(e,t,n){return w.compilePartial(e,t,n)},f.compileTokens=function(e,t){return w.compileTokens(e,t)},f.render=function(e,t,n){return w.render(e,t,n)},f.to_html=function(e,t,n,i){var r=f.render(e,t,n);return"function"!=typeof i?r:(i(r),void 0)},f}()),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,o,s,a=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?u+"":"null";case"boolean":case"null":return u+"";case"object":if(!u)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(u)){for(o=u.length,n=0;o>n;n+=1)s[n]=str(n,u)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,n=0;o>n;n+=1)"string"==typeof rep[n]&&(i=rep[n],r=str(i,u),r&&s.push(quote(i)+(gap?": ":":")+r));else for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(r=str(i,u),r&&s.push(quote(i)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;n>i;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(i=walk(r,n),void 0!==i?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("json2",function(){}),function(e){var t=[].slice,n={};e.amplify={publish:function(e){var i,r,o,s,a=t.call(arguments,1),u=0;if(!n[e])return!0;for(i=n[e].slice(),o=i.length;o>u&&(r=i[u],s=r.callback.apply(r.context,a),s!==!1);u++);return s!==!1},subscribe:function(e,t,i,r){3===arguments.length&&"number"==typeof i&&(r=i,i=t,t=null),2===arguments.length&&(i=t,t=null),r=r||10;for(var o,s=0,a=e.split(/\s/),u=a.length;u>s;s++){e=a[s],o=!1,n[e]||(n[e]=[]);for(var l=n[e].length-1,c={callback:i,context:t,priority:r};l>=0;l--)if(r>=n[e][l].priority){n[e].splice(l+1,0,c),o=!0;break}o||n[e].unshift(c)}return i},unsubscribe:function(e,t){if(n[e])for(var i=n[e].length,r=0;i>r;r++)if(n[e][r].callback===t){n[e].splice(r,1);break}}}}(this),function(e,t){function n(e,n){i.addType(e,function(o,s,a){var u,l,c,d,f=s,h=(new Date).getTime();if(!o){f={},d=[],c=0;try{for(o=n.length;o=n.key(c++);)r.test(o)&&(l=JSON.parse(n.getItem(o)),l.expires&&h>=l.expires?d.push(o):f[o.replace(r,"")]=l.data);for(;o=d.pop();)n.removeItem(o)}catch(p){}return f}if(o="__amplify__"+o,s===t){if(u=n.getItem(o),l=u?JSON.parse(u):{expires:-1},!(l.expires&&h>=l.expires))return l.data;n.removeItem(o)}else if(null===s)n.removeItem(o);else{l=JSON.stringify({data:s,expires:a.expires?h+a.expires:null});try{n.setItem(o,l)}catch(p){i[e]();try{n.setItem(o,l)}catch(p){throw i.error()}}}return f})}var i=e.store=function(e,t,n,r){var r=i.type;return n&&n.type&&n.type in i.types&&(r=n.type),i.types[r](e,t,n||{})};i.types={},i.type=null,i.addType=function(e,t){i.type||(i.type=e),i.types[e]=t,i[e]=function(t,n,r){return r=r||{},r.type=e,i(t,n,r)}},i.error=function(){return"amplify.store quota exceeded"};var r=/^__amplify__/;for(var o in{localStorage:1,sessionStorage:1})try{window[o].getItem&&n(o,window[o])}catch(s){}if(window.globalStorage)try{n("globalStorage",window.globalStorage[window.location.hostname]),"sessionStorage"===i.type&&(i.type="globalStorage")}catch(s){}(function(){if(!i.types.localStorage){var e=document.createElement("div"),n="amplify";e.style.display="none",document.getElementsByTagName("head")[0].appendChild(e);try{e.addBehavior("#default#userdata"),e.load(n)}catch(r){return e.parentNode.removeChild(e),t}i.addType("userData",function(r,o,s){e.load(n);var a,u,l,c,d,f=o,h=(new Date).getTime();if(!r){for(f={},d=[],c=0;a=e.XMLDocument.documentElement.attributes[c++];)u=JSON.parse(a.value),u.expires&&h>=u.expires?d.push(a.name):f[a.name]=u.data;for(;r=d.pop();)e.removeAttribute(r);return e.save(n),f}if(r=r.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g,"-"),o===t){if(a=e.getAttribute(r),u=a?JSON.parse(a):{expires:-1},!(u.expires&&h>=u.expires))return u.data;e.removeAttribute(r)}else null===o?e.removeAttribute(r):(l=e.getAttribute(r),u=JSON.stringify({data:o,expires:s.expires?h+s.expires:null}),e.setAttribute(r,u));try{e.save(n)}catch(p){null===l?e.removeAttribute(r):e.setAttribute(r,l),i.userData();try{e.setAttribute(r,u),e.save(n)}catch(p){throw null===l?e.removeAttribute(r):e.setAttribute(r,l),i.error()}}return f})}})(),function(){function e(e){return e===t?t:JSON.parse(JSON.stringify(e))}var n={},r={};i.addType("memory",function(i,o,s){return i?o===t?e(n[i]):(r[i]&&(clearTimeout(r[i]),delete r[i]),null===o?(delete n[i],null):(n[i]=o,s.expires&&(r[i]=setTimeout(function(){delete n[i],delete r[i]},s.expires)),o)):e(n)})}()}(this.amplify=this.amplify||{}),function(e){function t(){}function n(e){return"[object Function]"==={}.toString.call(e)}function i(e){var t=!1;return setTimeout(function(){t=!0},1),function(){var n=this,i=arguments;t?e.apply(n,i):setTimeout(function(){e.apply(n,i)},1)}}e.request=function(r,o,s){var a=r||{};"string"==typeof a&&(n(o)&&(s=o,o={}),a={resourceId:r,data:o||{},success:s});var u={abort:t},l=e.request.resources[a.resourceId],c=a.success||t,d=a.error||t;if(a.success=i(function(t,n){n=n||"success",e.publish("request.success",a,t,n),e.publish("request.complete",a,t,n),c(t,n)}),a.error=i(function(t,n){n=n||"error",e.publish("request.error",a,t,n),e.publish("request.complete",a,t,n),d(t,n)}),!l){if(!a.resourceId)throw"amplify.request: no resourceId provided";throw"amplify.request: unknown resourceId: "+a.resourceId}return e.publish("request.before",a)?(e.request.resources[a.resourceId](a,u),u):(a.error(null,"abort"),undefined)},e.request.types={},e.request.resources={},e.request.define=function(t,n,i){if("string"==typeof n){if(!(n in e.request.types))throw"amplify.request.define: unknown type: "+n;i.resourceId=t,e.request.resources[t]=e.request.types[n](i)}else e.request.resources[t]=n}}(amplify),function(e,t,n){var i=["status","statusText","responseText","responseXML","readyState"],r=/\{([^\}]+)\}/g;e.request.types.ajax=function(r){return r=t.extend({type:"GET"},r),function(o,s){function a(e,r){t.each(i,function(e,t){try{f[t]=u[t]}catch(n){}}),/OK$/.test(f.statusText)&&(f.statusText="success"),e===n&&(e=null),d&&(r="abort"),/timeout|error|abort/.test(r)?f.error(e,r):f.success(e,r),a=t.noop}var u,l=(r.url,s.abort),c=t.extend(!0,{},r,{data:o.data}),d=!1,f={readyState:0,setRequestHeader:function(e,t){return u.setRequestHeader(e,t)},getAllResponseHeaders:function(){return u.getAllResponseHeaders()},getResponseHeader:function(e){return u.getResponseHeader(e)},overrideMimeType:function(e){return u.overrideMideType(e)},abort:function(){d=!0;try{u.abort()}catch(e){}a(null,"abort")},success:function(e,t){o.success(e,t)},error:function(e,t){o.error(e,t)}};e.publish("request.ajax.preprocess",r,o,c,f),t.extend(c,{success:function(e,t){a(e,t)},error:function(e,t){a(null,t)},beforeSend:function(t,n){u=t,c=n;var i=r.beforeSend?r.beforeSend.call(this,f,c):!0;return i&&e.publish("request.before.ajax",r,o,c,f)}}),t.ajax(c),s.abort=function(){f.abort(),l.call(this)}}},e.subscribe("request.ajax.preprocess",function(e,i,o){var s=[],a=o.data;"string"!=typeof a&&(a=t.extend(!0,{},e.data,a),o.url=o.url.replace(r,function(e,t){return t in a?(s.push(t),a[t]):n}),t.each(s,function(e,t){delete a[t]}),o.data=a)}),e.subscribe("request.ajax.preprocess",function(e,n,i){var r=i.data,o=e.dataMap;o&&"string"!=typeof r&&(t.isFunction(o)?i.data=o(r):(t.each(e.dataMap,function(e,t){e in r&&(r[t]=r[e],delete r[e])}),i.data=r))});var o=e.request.cache={_key:function(e,t,n){function i(){return n.charCodeAt(o++)<<24|n.charCodeAt(o++)<<16|n.charCodeAt(o++)<<8|n.charCodeAt(o++)<<0}n=t+n;for(var r=n.length,o=0,s=i();r>o;)s^=i();return"request-"+e+"-"+s},_default:function(){var e={};return function(t,n,i,r){var s=o._key(n.resourceId,i.url,i.data),a=t.cache;if(s in e)return r.success(e[s]),!1;var u=r.success;r.success=function(t){e[s]=t,"number"==typeof a&&setTimeout(function(){delete e[s]},a),u.apply(this,arguments)}}}()};e.store&&(t.each(e.store.types,function(t){o[t]=function(n,i,r,s){var a=o._key(i.resourceId,r.url,r.data),u=e.store[t](a);if(u)return r.success(u),!1;var l=s.success;s.success=function(i){e.store[t](a,i,{expires:n.cache.expires}),l.apply(this,arguments)}}}),o.persist=o[e.store.type]),e.subscribe("request.before.ajax",function(e){var t=e.cache;return t?(t=t.type||t,o[t in o?t:"_default"].apply(this,arguments)):n}),e.request.decoders={jsend:function(e,t,n,i,r){"success"===e.status?i(e.data):"fail"===e.status?r(e.data,"fail"):"error"===e.status&&(delete e.status,r(e,"error"))}},e.subscribe("request.before.ajax",function(n,i,r,o){function s(e,t){u(e,t)}function a(e,t){l(e,t)}var u=o.success,l=o.error,c=t.isFunction(n.decoder)?n.decoder:n.decoder in e.request.decoders?e.request.decoders[n.decoder]:e.request.decoders._default;c&&(o.success=function(e,t){c(e,t,o,s,a)},o.error=function(e,t){c(e,t,o,s,a)})})}(amplify,jQuery),define("amplify",function(){}),!function(e,t){var n=function(){return n.get.apply(n,arguments)};n.utils=utils={isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isPlainObject:function(e){return!!e&&"[object Object]"===Object.prototype.toString.call(e)},toArray:function(e){return Array.prototype.slice.call(e)},getKeys:Object.keys||function(e){var t=[],n="";for(n in e)e.hasOwnProperty(n)&&t.push(n);return t},escape:function(e){return e.replace(/[,;"\\=\s%]/g,function(e){return encodeURIComponent(e)})},retrieve:function(e,t){return null==e?t:e}},n.defaults={},n.expiresMultiplier=86400,n.set=function(n,i,r){if(utils.isPlainObject(n))for(var o in n)n.hasOwnProperty(o)&&this.set(o,n[o],i);else{r=utils.isPlainObject(r)?r:{expires:r};var s=r.expires!==t?r.expires:this.defaults.expires||"",a=typeof s;"string"===a&&""!==s?s=new Date(s):"number"===a&&(s=new Date(+new Date+1e3*this.expiresMultiplier*s)),""!==s&&"toGMTString"in s&&(s=";expires="+s.toGMTString());var u=r.path||this.defaults.path;u=u?";path="+u:"";var l=r.domain||this.defaults.domain;l=l?";domain="+l:"";var c=r.secure||this.defaults.secure?";secure":"";e.cookie=utils.escape(n)+"="+utils.escape(i)+s+u+l+c}return this},n.remove=function(e){e=utils.isArray(e)?e:utils.toArray(arguments);for(var t=0,n=e.length;n>t;t++)this.set(e[t],"",-1);return this},n.empty=function(){return this.remove(utils.getKeys(this.all()))},n.get=function(e,n){n=n||t;var i=this.all();if(utils.isArray(e)){for(var r={},o=0,s=e.length;s>o;o++){var a=e[o];r[a]=utils.retrieve(i[a],n)}return r}return utils.retrieve(i[e],n)},n.all=function(){if(""===e.cookie)return{};for(var t=e.cookie.split("; "),n={},i=0,r=t.length;r>i;i++){var o=t[i].split("=");n[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return n},n.enabled=function(){if(navigator.cookieEnabled)return!0;var e="_"===n.set("_","_").get("_");return n.remove("_"),e},"function"==typeof define&&define.amd?define("cookie",[],function(){return n}):"undefined"!=typeof exports?exports.cookie=n:window.cookie=n}(document),define("cnamplify",["jquery","underscore","cookie"],function(e,t,n){var i={};return i.set=function(n,i){var r={};t.has(arguments,2)&&t.isObject(arguments[2])&&e.extend(r,{},arguments[2]),amplify.store(n,i,r)},i.get=function(e){return amplify.store(e)},i.remove=function(e){amplify.store(e,null)},i.cookie={},i.cookie.set=function(i,r){"cn_token"==i&&window.cn.set("token",r);var o={path:"/"};t.has(arguments,2)&&t.isObject(arguments[2])&&(o=e.extend({},o,arguments[2])),n.set(i,r,o)},i.cookie.get=function(e){var t=n.get(e);return"cn_token"==e&&window.cn.set("token",t),t},i.cookie.remove=function(e){"cn_token"==e&&window.cn.set("token",""),n.remove(e)},i.cookie.empty=function(){window.cn.set("token",""),n.empty()},i.cookie.all=function(){return n.all()},i}),define("text",["module"],function(e){var t,n,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s="undefined"!=typeof location&&location.href,a=s&&location.protocol&&location.protocol.replace(/\:/,""),u=s&&location.hostname,l=s&&(location.port||void 0),c=[],d=e.config&&e.config()||{};return t={version:"2.0.5",strip:function(e){if(e){e=e.replace(r,"");var t=e.match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(r){}if(e){i=[n];break}}return e},parseName:function(e){var t,n,i,r=!1,o=e.indexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),n=e.substring(o+1,e.length)):t=e,i=n||t,o=i.indexOf("!"),-1!==o&&(r="strip"===i.substring(o+1),i=i.substring(0,o),n?n=i:t=i),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var o,s,a,u=t.xdRegExp.exec(e);return u?(o=u[2],s=u[3],s=s.split(":"),a=s[1],s=s[0],!(o&&o!==n||s&&s.toLowerCase()!==i.toLowerCase()||(a||s)&&a!==r)):!0},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,d.isBuild&&(c[e]=i),r(i)},load:function(e,n,i,r){if(r.isBuild&&!r.inlineText)return i(),void 0;d.isBuild=r.isBuild;var o=t.parseName(e),c=o.moduleName+(o.ext?"."+o.ext:""),f=n.toUrl(c),h=d.useXhr||t.useXhr;!s||h(f,a,u,l)?t.get(f,function(n){t.finishLoad(e,o.strip,n,i)},function(e){i.error&&i.error(e)}):n([c],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,i)})},write:function(e,n,i){if(c.hasOwnProperty(n)){var r=t.jsEscape(c[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,r,o){var s=t.parseName(n),a=s.ext?"."+s.ext:"",u=s.moduleName+a,l=i.toUrl(s.moduleName+a)+".js";t.load(u,i,function(){var n=function(e){return r(l,e)};n.asModule=function(e,t){return r.asModule(e,l,t)},t.write(e,u,n,o)},o)}},"node"===d.env||!d.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var i=n.readFileSync(e,"utf8");0===i.indexOf("")&&(i=i.substring(1)),t(i)}):"xhr"===d.env||!d.env&&t.createXhr()?t.get=function(e,n,i,r){var o,s=t.createXhr();if(s.open("GET",e,!0),r)for(o in r)r.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),r[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(){var t,r;4===s.readyState&&(t=s.status,t>399&&600>t?(r=Error(e+" HTTP status: "+t),r.xhr=s,i(r)):n(s.responseText))},s.send(null)}:("rhino"===d.env||!d.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(t.get=function(e,t){var n,i,r="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),u="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),n.append(i);null!==(i=a.readLine());)n.append(s),n.append(i);u=""+n+""}finally{a.close()}t(u)}),t}),define("text!templates/common/pop-up-window/master.html",[],function(){return'<div class="head">\r\n	<h4>{{title}}</h4>\r\n</div>\r\n<div class="main">\r\n	<div class="text">{{{content}}}</div>\r\n    {{#closeButton}}\r\n    <div class="operate">\r\n        <button class="cancel bt bt-gray bt-size-normal" type="button">Close</button>\r\n    </div>\r\n    {{/closeButton}}\r\n</div>'}),define("text!templates/common/pop-up-window/confirm.html",[],function(){return'<div class="head">\r\n	<h4>{{title}}</h4>\r\n</div>\r\n<div class="main">\r\n	<div class="text">{{{content}}}</div>\r\n    {{#button}}\r\n    <div class="operate">\r\n        <button class="sure bt bt-blue-2 bt-size-normal" type="button">{{string.yes}}</button>\r\n        <button class="cancel bt bt-gray bt-size-normal" type="button">{{string.no}}</button>\r\n    </div>\r\n    {{/button}}\r\n</div>'}),define("text!templates/common/pop-up-window/upload.html",[],function(){return'<div class="head">\r\n	<h4 id="pop_up_upload_title">{{title}}</h4>\r\n</div>\r\n<div class="main" id="pop_up_upload_wrapper">\r\n	<div id="pop_up_upload_content" class="text">{{{content}}}</div>\r\n    <div class="pop_up_upload_status"></div>\r\n    {{#button}}\r\n    <div class="operate">\r\n        <button id="pop_up_upload" class="bt bt-blue-2 bt-size-normal" type="button">{{string.upload}}</button>\r\n        <button class="cancel bt bt-gray bt-size-normal" type="button">{{string.cancel}}</button>\r\n    </div>\r\n    {{/button}}\r\n</div>'}),define("tools/json-str-to-json-obj",[],function(){return function(strJson){try{var j="("+strJson+")";return eval(j)}catch(e){return null}}}),function(){function e(){this.returnValue=!1}function t(){this.cancelBubble=!0}var n,i,r=0,o=[],s={},a={},u={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},l=/[<>&\"\']/g,c=window.setTimeout,d={};(function(e){var t,n,i,r=e.split(/,/);for(t=0;r.length>t;t+=2)for(i=r[t+1].split(/ /),n=0;i.length>n;n++)a[i[n]]=r[t]})("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var f={VERSION:"1.5.6",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:a,ua:function(){var e,t,n,i=navigator,r=i.userAgent,o=i.vendor;return e=/WebKit/.test(r),n=e&&-1!==o.indexOf("Apple"),t=window.opera&&window.opera.buildNumber,{windows:-1!==navigator.platform.indexOf("Win"),android:/Android/.test(r),ie:!e&&!t&&/MSIE/gi.test(r)&&/Explorer/gi.test(i.appName),webkit:e,gecko:!e&&/Gecko/.test(r),safari:n,opera:!!t}}(),typeOf:function(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(e){return f.each(arguments,function(t,n){n>0&&f.each(t,function(t,n){e[n]=t})}),e},cleanName:function(e){var t,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;n.length>t;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(e,t){return t.name=e,o[e]=t,o.push(t),t},guid:function(){var e,t=(new Date).getTime().toString(32);for(e=0;5>e;e++)t+=Math.floor(65535*Math.random()).toString(32);return(f.guidPrefix||"p")+t+(r++).toString(32)},buildUrl:function(e,t){var n="";return f.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},each:function(e,t){var i,r,o;if(e)if(i=e.length,i===n){for(r in e)if(e.hasOwnProperty(r)&&t(e[r],r)===!1)return}else for(o=0;i>o;o++)if(t(e[o],o)===!1)return},formatSize:function(e){return e===n||/\D/.test(e)?f.translate("N/A"):e>1073741824?Math.round(e/1073741824,1)+" GB":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"},getPos:function(e,t){function n(e){var t,n,i=0,r=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===u.compatMode?u.documentElement:u.body,i=n.left+t.scrollLeft,r=n.top+t.scrollTop),{x:i,y:r}}var i,r,o,s=0,a=0,u=document;if(e=e,t=t||u.body,e&&e.getBoundingClientRect&&f.ua.ie&&(!u.documentMode||8>u.documentMode))return r=n(e),o=n(t),{x:r.x-o.x,y:r.y-o.y};for(i=e;i&&i!=t&&i.nodeType;)s+=i.offsetLeft||0,a+=i.offsetTop||0,i=i.offsetParent;for(i=e.parentNode;i&&i!=t&&i.nodeType;)s-=i.scrollLeft||0,a-=i.scrollTop||0,i=i.parentNode;return{x:s,y:a}},getSize:function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}},parseSize:function(e){var t;return"string"==typeof e&&(e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),t=e[2],e=+e[1],"g"==t&&(e*=1073741824),"m"==t&&(e*=1048576),"k"==t&&(e*=1024)),e},xmlEncode:function(e){return e?(""+e).replace(l,function(e){return u[e]?"&"+u[e]+";":e}):e},toArray:function(e){var t,n=[];for(t=0;e.length>t;t++)n[t]=e[t];return n},inArray:function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n}return-1},addI18n:function(e){return f.extend(s,e)},translate:function(e){return s[e]||e},isEmptyObj:function(e){if(e===n)return!0;for(var t in e)return!1;return!0},hasClass:function(e,t){var n;return""==e.className?!1:(n=RegExp("(^|\\s+)"+t+"(\\s+|$)"),n.test(e.className))},addClass:function(e,t){f.hasClass(e,t)||(e.className=""==e.className?t:e.className.replace(/\s+$/,"")+" "+t)},removeClass:function(e,t){var n=RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})},getStyle:function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},addEvent:function(r,o,s){var a,u,l;l=arguments[3],o=o.toLowerCase(),i===n&&(i="Plupload_"+f.guid()),r.addEventListener?(a=s,r.addEventListener(o,a,!1)):r.attachEvent&&(a=function(){var n=window.event;n.target||(n.target=n.srcElement),n.preventDefault=e,n.stopPropagation=t,s(n)},r.attachEvent("on"+o,a)),r[i]===n&&(r[i]=f.guid()),d.hasOwnProperty(r[i])||(d[r[i]]={}),u=d[r[i]],u.hasOwnProperty(o)||(u[o]=[]),u[o].push({func:a,orig:s,key:l})},removeEvent:function(e,t){var r,o,s;if("function"==typeof arguments[2]?o=arguments[2]:s=arguments[2],t=t.toLowerCase(),e[i]&&d[e[i]]&&d[e[i]][t]){r=d[e[i]][t];for(var a=r.length-1;a>=0&&(r[a].key!==s&&r[a].orig!==o||(e.removeEventListener?e.removeEventListener(t,r[a].func,!1):e.detachEvent&&e.detachEvent("on"+t,r[a].func),r[a].orig=null,r[a].func=null,r.splice(a,1),o===n));a--);if(r.length||delete d[e[i]][t],f.isEmptyObj(d[e[i]])){delete d[e[i]];try{delete e[i]}catch(u){e[i]=n}}}},removeAllEvents:function(e){var t=arguments[1];e[i]!==n&&e[i]&&f.each(d[e[i]],function(n,i){f.removeEvent(e,i,t)})}};f.Uploader=function(e){function t(){var e,t,n=0;if(this.state==f.STARTED){for(t=0;u.length>t;t++)e||u[t].status!=f.QUEUED?n++:(e=u[t],e.status=f.UPLOADING,this.trigger("BeforeUpload",e)&&this.trigger("UploadFile",e));n==u.length&&(this.stop(),this.trigger("UploadComplete",u))}}function i(){var e,t;for(r.reset(),e=0;u.length>e;e++)t=u[e],t.size!==n?(r.size+=t.size,r.loaded+=t.loaded):r.size=n,t.status==f.DONE?r.uploaded++:t.status==f.FAILED?r.failed++:r.queued++;r.size===n?r.percent=u.length>0?Math.ceil(100*(r.uploaded/u.length)):0:(r.bytesPerSec=Math.ceil(r.loaded/((+new Date-s||1)/1e3)),r.percent=r.size>0?Math.ceil(100*(r.loaded/r.size)):0)}var r,s,a={},u=[],l=!1;r=new f.QueueProgress,e=f.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},e),f.extend(this,{state:f.STOPPED,runtime:"",features:{},files:u,settings:e,total:r,id:f.guid(),init:function(){function r(){var e,t,n,i=l[p++];if(i){if(e=i.getFeatures(),t=h.settings.required_features)for(t=t.split(","),n=0;t.length>n;n++)if(!e[t[n]])return r(),void 0;i.init(h,function(t){t&&t.success?(h.features=e,h.runtime=i.name,h.trigger("Init",{runtime:i.name}),h.trigger("PostInit"),h.refresh()):r()})}else h.trigger("Error",{code:f.INIT_ERROR,message:f.translate("Init error.")})}var a,l,d,h=this,p=0;if("function"==typeof e.preinit?e.preinit(h):f.each(e.preinit,function(e,t){h.bind(t,e)}),e.page_url=e.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(e.url)||(e.url=e.page_url+e.url),e.chunk_size=f.parseSize(e.chunk_size),e.max_file_size=f.parseSize(e.max_file_size),h.bind("FilesAdded",function(t,i){var r,o,s,a=0,l=e.filters;for(l&&l.length&&(s=[],f.each(l,function(e){f.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?s.push("\\.*"):s.push("\\."+e.replace(RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),s=RegExp(s.join("|")+"$","i")),r=0;i.length>r;r++)o=i[r],o.loaded=0,o.percent=0,o.status=f.QUEUED,!s||s.test(o.name)?o.size!==n&&o.size>e.max_file_size?t.trigger("Error",{code:f.FILE_SIZE_ERROR,message:f.translate("File size error."),file:o}):(u.push(o),a++):t.trigger("Error",{code:f.FILE_EXTENSION_ERROR,message:f.translate("File extension error."),file:o});return a?(c(function(){h.trigger("QueueChanged"),h.refresh()},1),void 0):!1}),e.unique_names&&h.bind("UploadFile",function(e,t){var n=t.name.match(/\.([^.]+)$/),i="tmp";n&&(i=n[1]),t.target_name=t.id+"."+i}),h.bind("UploadProgress",function(e,t){t.percent=t.size>0?Math.ceil(100*(t.loaded/t.size)):100,i()}),h.bind("StateChanged",function(e){if(e.state==f.STARTED)s=+new Date;else if(e.state==f.STOPPED)for(a=e.files.length-1;a>=0;a--)e.files[a].status==f.UPLOADING&&(e.files[a].status=f.QUEUED,i())}),h.bind("QueueChanged",i),h.bind("Error",function(e,n){n.file&&(n.file.status=f.FAILED,i(),e.state==f.STARTED&&c(function(){t.call(h)},1))}),h.bind("FileUploaded",function(e,n){n.status=f.DONE,n.loaded=n.size,e.trigger("UploadProgress",n),c(function(){t.call(h)},1)}),e.runtimes)for(l=[],d=e.runtimes.split(/\s?,\s?/),a=0;d.length>a;a++)o[d[a]]&&l.push(o[d[a]]);else l=o;r(),"function"==typeof e.init?e.init(h):f.each(e.init,function(e,t){h.bind(t,e)})},refresh:function(){this.trigger("Refresh")},start:function(){u.length&&this.state!=f.STARTED&&(this.state=f.STARTED,this.trigger("StateChanged"),t.call(this))},stop:function(){this.state!=f.STOPPED&&(this.state=f.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(){l=arguments[0]!==n?arguments[0]:!0,this.trigger("DisableBrowse",l)
},getFile:function(e){var t;for(t=u.length-1;t>=0;t--)if(u[t].id===e)return u[t]},removeFile:function(e){var t;for(t=u.length-1;t>=0;t--)if(u[t].id===e.id)return this.splice(t,1)[0]},splice:function(e,t){var i;return i=u.splice(e===n?0:e,t===n?u.length:t),this.trigger("FilesRemoved",i),this.trigger("QueueChanged"),i},trigger:function(e){var t,n,i=a[e.toLowerCase()];if(i)for(n=Array.prototype.slice.call(arguments),n[0]=this,t=0;i.length>t;t++)if(i[t].func.apply(i[t].scope,n)===!1)return!1;return!0},hasEventListener:function(e){return!!a[e.toLowerCase()]},bind:function(e,t,n){var i;e=e.toLowerCase(),i=a[e]||[],i.push({func:t,scope:n||this}),a[e]=i},unbind:function(e){e=e.toLowerCase();var t,i=a[e],r=arguments[1];if(i){if(r!==n){for(t=i.length-1;t>=0;t--)if(i[t].func===r){i.splice(t,1);break}}else i=[];i.length||delete a[e]}},unbindAll:function(){var e=this;f.each(a,function(t,n){e.unbind(n)})},destroy:function(){this.stop(),this.trigger("Destroy"),this.unbindAll()}})},f.File=function(e,t,n){var i=this;i.id=e,i.name=t,i.size=n,i.loaded=0,i.percent=0,i.status=0},f.Runtime=function(){this.getFeatures=function(){},this.init=function(){}},f.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},f.runtimes={},window.plupload=f}(),define("plupload",function(){}),function(e,t,n){function i(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}var r={},o={};n.flash={trigger:function(e,t,n){setTimeout(function(){var i=r[e];i&&i.trigger("Flash:"+t,n)},0)}},n.runtimes.Flash=n.addRuntime("flash",{getFeatures:function(){return{jpgresize:!0,pngresize:!0,maxWidth:8091,maxHeight:8091,chunks:!0,progress:!0,multipart:!0,multi_selection:!0}},init:function(e,s){function a(){return t.getElementById(e.id+"_flash")}function u(){return d++>5e3?(s({success:!1}),void 0):(o[e.id]===!1&&setTimeout(u,1),void 0)}var l,c,d=0,f=t.body;return 10>i()?(s({success:!1}),void 0):(o[e.id]=!1,r[e.id]=e,l=t.getElementById(e.settings.browse_button),c=t.createElement("div"),c.id=e.id+"_flash_container",n.extend(c.style,{position:"absolute",top:"0px",background:e.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"}),c.className="plupload flash",e.settings.container&&(f=t.getElementById(e.settings.container),"static"===n.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(c),function(){var i,r;i='<object id="'+e.id+'_flash" type="application/x-shockwave-flash" data="'+e.settings.flash_swf_url+'" ',n.ua.ie&&(i+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),i+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+e.settings.flash_swf_url+'" /><param name="flashvars" value="id='+escape(e.id)+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',n.ua.ie?(r=t.createElement("div"),c.appendChild(r),r.outerHTML=i,r=null):c.innerHTML=i}(),u(),l=c=null,e.bind("Destroy",function(e){var i;n.removeAllEvents(t.body,e.id),delete o[e.id],delete r[e.id],i=t.getElementById(e.id+"_flash_container"),i&&i.parentNode.removeChild(i)}),e.bind("Flash:Init",function(){var i={};try{a().setFileFilters(e.settings.filters,e.settings.multi_selection)}catch(r){return s({success:!1}),void 0}o[e.id]||(o[e.id]=!0,e.bind("UploadFile",function(t,r){var o=t.settings,s=e.settings.resize||{};a().uploadFile(i[r.id],o.url,{name:r.target_name||r.name,mime:n.mimeTypes[r.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:o.chunk_size,width:s.width,height:s.height,quality:s.quality,multipart:o.multipart,multipart_params:o.multipart_params||{},file_data_name:o.file_data_name,format:/\.(jpg|jpeg)$/i.test(r.name)?"jpg":"png",headers:o.headers,urlstream_upload:o.urlstream_upload})}),e.bind("CancelUpload",function(){a().cancelUpload()}),e.bind("Flash:UploadProcess",function(e,t){var r=e.getFile(i[t.id]);r.status!=n.FAILED&&(r.loaded=t.loaded,r.size=t.size,e.trigger("UploadProgress",r))}),e.bind("Flash:UploadChunkComplete",function(e,t){var r,o=e.getFile(i[t.id]);r={chunk:t.chunk,chunks:t.chunks,response:t.text},e.trigger("ChunkUploaded",o,r),o.status!==n.FAILED&&e.state!==n.STOPPED&&a().uploadNextChunk(),t.chunk==t.chunks-1&&(o.status=n.DONE,e.trigger("FileUploaded",o,{response:t.text}))}),e.bind("Flash:SelectFiles",function(t,r){var o,s,a,u=[];for(s=0;r.length>s;s++)o=r[s],a=n.guid(),i[a]=o.id,i[o.id]=a,u.push(new n.File(a,o.name,o.size));u.length&&e.trigger("FilesAdded",u)}),e.bind("Flash:SecurityError",function(t,r){e.trigger("Error",{code:n.SECURITY_ERROR,message:n.translate("Security error."),details:r.message,file:e.getFile(i[r.id])})}),e.bind("Flash:GenericError",function(t,r){e.trigger("Error",{code:n.GENERIC_ERROR,message:n.translate("Generic error."),details:r.message,file:e.getFile(i[r.id])})}),e.bind("Flash:IOError",function(t,r){e.trigger("Error",{code:n.IO_ERROR,message:n.translate("IO error."),details:r.message,file:e.getFile(i[r.id])})}),e.bind("Flash:ImageError",function(t,r){e.trigger("Error",{code:parseInt(r.code,10),message:n.translate("Image error."),file:e.getFile(i[r.id])})}),e.bind("Flash:StageEvent:rollOver",function(i){var r,o;r=t.getElementById(e.settings.browse_button),o=i.settings.browse_button_hover,r&&o&&n.addClass(r,o)}),e.bind("Flash:StageEvent:rollOut",function(i){var r,o;r=t.getElementById(e.settings.browse_button),o=i.settings.browse_button_hover,r&&o&&n.removeClass(r,o)}),e.bind("Flash:StageEvent:mouseDown",function(i){var r,o;r=t.getElementById(e.settings.browse_button),o=i.settings.browse_button_active,r&&o&&(n.addClass(r,o),n.addEvent(t.body,"mouseup",function(){n.removeClass(r,o)},i.id))}),e.bind("Flash:StageEvent:mouseUp",function(i){var r,o;r=t.getElementById(e.settings.browse_button),o=i.settings.browse_button_active,r&&o&&n.removeClass(r,o)}),e.bind("Flash:ExifData",function(t,n){e.trigger("ExifData",e.getFile(i[n.id]),n.data)}),e.bind("Flash:GpsData",function(t,n){e.trigger("GpsData",e.getFile(i[n.id]),n.data)}),e.bind("QueueChanged",function(){e.refresh()}),e.bind("FilesRemoved",function(e,t){var n;for(n=0;t.length>n;n++)a().removeFile(i[t[n].id])}),e.bind("StateChanged",function(){e.refresh()}),e.bind("Refresh",function(i){var r,o,s;a().setFileFilters(e.settings.filters,e.settings.multi_selection),r=t.getElementById(i.settings.browse_button),r&&(o=n.getPos(r,t.getElementById(i.settings.container)),s=n.getSize(r),n.extend(t.getElementById(i.id+"_flash_container").style,{top:o.y+"px",left:o.x+"px",width:s.w+"px",height:s.h+"px"}))}),e.bind("DisableBrowse",function(e,t){a().disableBrowse(t)}),s({success:!0}))}),void 0)}})}(window,document,plupload),define("pluploadFlash",function(){}),function(e,t,n,r){function o(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsDataURL(t),i.onload=function(){n(i.result)},void 0):n(t.getAsDataURL())}function s(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsBinaryString(t),i.onload=function(){n(i.result)},void 0):n(t.getAsBinary())}function a(e,n,i,r){var s,a,u,d,h=this;o(f[e.id],function(o){s=t.createElement("canvas"),s.style.display="none",t.body.appendChild(s),a=s.getContext("2d"),u=new Image,u.onerror=u.onabort=function(){r({success:!1})},u.onload=function(){var t,f,p,m;if(n.width||(n.width=u.width),n.height||(n.height=u.height),d=Math.min(n.width/u.width,n.height/u.height),1>d)t=Math.round(u.width*d),f=Math.round(u.height*d);else{if(!n.quality||"image/jpeg"!==i)return r({success:!1}),void 0;t=u.width,f=u.height}if(s.width=t,s.height=f,a.drawImage(u,0,0,t,f),"image/jpeg"===i&&(p=new l(atob(o.substring(o.indexOf("base64,")+7))),p.headers&&p.headers.length&&(m=new c,m.init(p.get("exif")[0])&&(m.setExif("PixelXDimension",t),m.setExif("PixelYDimension",f),p.set("exif",m.getBinary()),h.hasEventListener("ExifData")&&h.trigger("ExifData",e,m.EXIF()),h.hasEventListener("GpsData")&&h.trigger("GpsData",e,m.GPS())))),n.quality&&"image/jpeg"===i)try{o=s.toDataURL(i,n.quality/100)}catch(g){o=s.toDataURL(i)}else o=s.toDataURL(i);o=o.substring(o.indexOf("base64,")+7),o=atob(o),p&&p.headers&&p.headers.length&&(o=p.restore(o),p.purge()),s.parentNode.removeChild(s),r({success:!0,data:o})},u.src=o})}function u(){function e(e,t){var n,r=o?0:-8*(t-1),s=0;for(n=0;t>n;n++)s|=i.charCodeAt(e+n)<<Math.abs(r+8*n);return s}function t(e,t,n){var n=3===arguments.length?n:i.length-t-1;i=i.substr(0,t)+e+i.substr(n+t)}function n(e,n,i){var r,s="",a=o?0:-8*(i-1);for(r=0;i>r;r++)s+=String.fromCharCode(255&n>>Math.abs(a+8*r));t(s,e,i)}var i,o=!1;return{II:function(e){return e===r?o:(o=e,void 0)},init:function(e){o=!1,i=e},SEGMENT:function(e,n,r){switch(arguments.length){case 1:return i.substr(e,i.length-e-1);case 2:return i.substr(e,n);case 3:t(r,e,n);break;default:return i}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,i){return i===r?e(t,4):(n(t,i,4),void 0)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var i="";for(n+=t;n>t;t++)i+=String.fromCharCode(e(t,1));return i}}}function l(e){var t,n,i,o={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},s=[],a=r,c=0;if(t=new u,t.init(e),65496===t.SHORT(0)){for(n=2,i=Math.min(1048576,e.length);i>=n;)if(a=t.SHORT(n),a>=65488&&65495>=a)n+=2;else{if(65498===a||65497===a)break;c=t.SHORT(n+2)+2,o[a]&&t.STRING(n+4,o[a].signature.length)===o[a].signature&&s.push({hex:a,app:o[a].app.toUpperCase(),name:o[a].name.toUpperCase(),start:n,length:c,segment:t.SEGMENT(n,c)}),n+=c}return t.init(null),{headers:s,restore:function(e){t.init(e);var i=new l(e);if(!i.headers)return!1;for(var r=i.headers.length;r>0;r--){var o=i.headers[r-1];t.SEGMENT(o.start,o.length,"")}i.purge(),n=65504==t.SHORT(2)?4+t.SHORT(4):2;for(var r=0,a=s.length;a>r;r++)t.SEGMENT(n,0,s[r].segment),n+=s[r].length;return t.SEGMENT()},get:function(e){for(var t=[],n=0,i=s.length;i>n;n++)s[n].app===e.toUpperCase()&&t.push(s[n].segment);return t},set:function(e,t){var n=[];"string"==typeof t?n.push(t):n=t;for(var i=ii=0,r=s.length;r>i&&(s[i].app===e.toUpperCase()&&(s[i].segment=n[ii],s[i].length=n[ii].length,ii++),!(ii>=n.length));i++);},purge:function(){s=[],t.init(null)}}}}function c(){function e(e,t){var n,i,o,a,u,d,f,h,p=s.SHORT(e),m=[],g={};for(n=0;p>n;n++)if(f=d=e+12*n+2,o=t[s.SHORT(f)],o!==r){switch(a=s.SHORT(f+=2),u=s.LONG(f+=2),f+=4,m=[],a){case 1:case 7:for(u>4&&(f=s.LONG(f)+c.tiffHeader),i=0;u>i;i++)m[i]=s.BYTE(f+i);break;case 2:u>4&&(f=s.LONG(f)+c.tiffHeader),g[o]=s.STRING(f,u-1);continue;case 3:for(u>2&&(f=s.LONG(f)+c.tiffHeader),i=0;u>i;i++)m[i]=s.SHORT(f+2*i);break;case 4:for(u>1&&(f=s.LONG(f)+c.tiffHeader),i=0;u>i;i++)m[i]=s.LONG(f+4*i);break;case 5:for(f=s.LONG(f)+c.tiffHeader,i=0;u>i;i++)m[i]=s.LONG(f+4*i)/s.LONG(f+4*i+4);break;case 9:for(f=s.LONG(f)+c.tiffHeader,i=0;u>i;i++)m[i]=s.SLONG(f+4*i);break;case 10:for(f=s.LONG(f)+c.tiffHeader,i=0;u>i;i++)m[i]=s.SLONG(f+4*i)/s.SLONG(f+4*i+4);break;default:continue}h=1==u?m[0]:m,g[o]=l.hasOwnProperty(o)&&"object"!=typeof h?l[o][h]:h}return g}function t(){var t=r,n=c.tiffHeader;return s.II(18761==s.SHORT(n)),42!==s.SHORT(n+=2)?!1:(c.IFD0=c.tiffHeader+s.LONG(n+=2),t=e(c.IFD0,a.tiff),c.exifIFD="ExifIFDPointer"in t?c.tiffHeader+t.ExifIFDPointer:r,c.gpsIFD="GPSInfoIFDPointer"in t?c.tiffHeader+t.GPSInfoIFDPointer:r,!0)}function o(e,t,n){var r,o,u,l=0;if("string"==typeof t){var d=a[e.toLowerCase()];for(hex in d)if(d[hex]===t){t=hex;break}}for(r=c[e.toLowerCase()+"IFD"],o=s.SHORT(r),i=0;o>i;i++)if(u=r+12*i+2,s.SHORT(u)==t){l=u+8;break}return l?(s.LONG(l,n),!0):!1}var s,a,l,c={};return s=new u,a={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return c={tiffHeader:10},e!==r&&e.length?(s.init(e),65505===s.SHORT(0)&&"EXIF\0"===s.STRING(4,5).toUpperCase()?t():!1):!1},EXIF:function(){var t;if(t=e(c.exifIFD,a.exif),t.ExifVersion&&"array"===n.typeOf(t.ExifVersion)){for(var i=0,r="";t.ExifVersion.length>i;i++)r+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=r}return t},GPS:function(){var t;return t=e(c.gpsIFD,a.gps),t.GPSVersionID&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:o("exif",e,t)},getBinary:function(){return s.SEGMENT()}}}var d,f={};n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,r,o,s,a,u;return r=o=a=u=!1,e.XMLHttpRequest&&(i=new XMLHttpRequest,o=!!i.upload,r=!(!i.sendAsBinary&&!i.upload)),r&&(s=!!(i.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),a=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!s),u=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),d=n.ua.safari&&n.ua.windows,{html5:r,dragdrop:function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),jpgresize:a,pngresize:a,multipart:a||!!e.FileReader||!!e.FormData,canSendBinary:s,cantSendBlobInFormData:!(!(n.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer)||n.ua.android,progress:o,chunks:u,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(i,r){function o(e){var t,r,o,s=[],a={};for(r=0;e.length>r;r++)t=e[r],a[t.name]||(a[t.name]=!0,o=n.guid(),f[o]=t,s.push(new n.File(o,t.fileName||t.name,t.fileSize||t.size)));s.length&&i.trigger("FilesAdded",s)}var u,l;return u=this.getFeatures(),u.html5?(i.bind("Init",function(e){var r,s,a,u,l,c,d,f=[],h=e.settings.filters,p=t.body;r=t.createElement("div"),r.id=e.id+"_html5_container",n.extend(r.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),r.className="plupload html5",i.settings.container&&(p=t.getElementById(i.settings.container),"static"===n.getStyle(p,"position")&&(p.style.position="relative")),p.appendChild(r);e:for(a=0;h.length>a;a++)for(l=h[a].extensions.split(/,/),u=0;l.length>u;u++){if("*"===l[u]){f=[];break e}c=n.mimeTypes[l[u]],c&&-1===n.inArray(c,f)&&f.push(c)}if(r.innerHTML='<input id="'+i.id+'_html5"  style="font-size:999px" type="file" accept="'+f.join(",")+'" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",r.scrollTop=100,d=t.getElementById(i.id+"_html5"),e.features.triggerDialog?n.extend(d.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(d.style,{cssFloat:"right",styleFloat:"right"}),d.onchange=function(){o(this.files),this.value=""},s=t.getElementById(e.settings.browse_button)){var m=e.settings.browse_button_hover,g=e.settings.browse_button_active,v=e.features.triggerDialog?s:r;m&&(n.addEvent(v,"mouseover",function(){n.addClass(s,m)},e.id),n.addEvent(v,"mouseout",function(){n.removeClass(s,m)},e.id)),g&&(n.addEvent(v,"mousedown",function(){n.addClass(s,g)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(s,g)},e.id)),e.features.triggerDialog&&n.addEvent(s,"click",function(n){var i=t.getElementById(e.id+"_html5");i&&!i.disabled&&i.click(),n.preventDefault()},e.id)}}),i.bind("PostInit",function(){var e=t.getElementById(i.settings.drop_element);if(e){if(d)return n.addEvent(e,"dragenter",function(){var r,s,a;r=t.getElementById(i.id+"_drop"),r||(r=t.createElement("input"),r.setAttribute("type","file"),r.setAttribute("id",i.id+"_drop"),r.setAttribute("multiple","multiple"),n.addEvent(r,"change",function(){o(this.files),n.removeEvent(r,"change",i.id),r.parentNode.removeChild(r)},i.id),n.addEvent(r,"dragover",function(e){e.stopPropagation()},i.id),e.appendChild(r)),s=n.getPos(e,t.getElementById(i.settings.container)),a=n.getSize(e),"static"===n.getStyle(e,"position")&&n.extend(e.style,{position:"relative"}),n.extend(r.style,{position:"absolute",display:"block",top:0,left:0,width:a.w+"px",height:a.h+"px",opacity:0})},i.id),void 0;n.addEvent(e,"dragover",function(e){e.preventDefault()},i.id),n.addEvent(e,"drop",function(e){var t=e.dataTransfer;t&&t.files&&o(t.files),e.preventDefault()},i.id)}}),i.bind("Refresh",function(e){var r,o,s,a,u;r=t.getElementById(i.settings.browse_button),r&&(o=n.getPos(r,t.getElementById(e.settings.container)),s=n.getSize(r),a=t.getElementById(i.id+"_html5_container"),n.extend(a.style,{top:o.y+"px",left:o.x+"px",width:s.w+"px",height:s.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(r,"position")&&n.extend(r.style,{position:"relative"}),u=parseInt(n.getStyle(r,"zIndex"),10),isNaN(u)&&(u=0),n.extend(r.style,{zIndex:u}),n.extend(a.style,{zIndex:u-1})))}),i.bind("DisableBrowse",function(e,n){var i=t.getElementById(e.id+"_html5");i&&(i.disabled=n)}),i.bind("CancelUpload",function(){l&&l.abort&&l.abort()}),i.bind("UploadFile",function(t,i){function r(e,t,n){var i;if(!File.prototype.slice)return(i=File.prototype.webkitSlice||File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(r){return e.slice(t,n-t)}}function o(o){function s(){function h(e){if(l.sendAsBinary)l.sendAsBinary(e);else if(t.features.canSendBinary){for(var n=new Uint8Array(e.length),i=0;e.length>i;i++)n[i]=255&e.charCodeAt(i);l.send(n.buffer)}}function p(r){var o,d=0,f="----pluploadboundary"+n.guid(),p="--",x="\r\n",k="";if(l=new XMLHttpRequest,l.upload&&(l.upload.onprogress=function(e){i.loaded=Math.min(i.size,c+e.loaded-d),t.trigger("UploadProgress",i)}),l.onreadystatechange=function(){var e,u;if(4==l.readyState&&t.state!==n.STOPPED){try{e=l.status}catch(d){e=0}if(e>=400)t.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:e});else{if(g){if(u={chunk:a,chunks:g,response:l.responseText,status:e},t.trigger("ChunkUploaded",i,u),c+=b,u.cancelled)return i.status=n.FAILED,void 0;i.loaded=Math.min(i.size,(a+1)*y)}else i.loaded=i.size;t.trigger("UploadProgress",i),r=m=o=k=null,!g||++a>=g?(i.status=n.DONE,t.trigger("FileUploaded",i,{response:l.responseText,status:e})):s()}}},t.settings.multipart&&u.multipart){if(v.name=i.target_name||i.name,l.open("post",w,!0),n.each(t.settings.headers,function(e,t){l.setRequestHeader(t,e)}),"string"!=typeof r&&e.FormData)return o=new FormData,n.each(n.extend(v,t.settings.multipart_params),function(e,t){o.append(t,e)}),o.append(t.settings.file_data_name,r),l.send(o),void 0;if("string"==typeof r)return l.setRequestHeader("Content-Type","multipart/form-data; boundary="+f),n.each(n.extend(v,t.settings.multipart_params),function(e,t){k+=p+f+x+'Content-Disposition: form-data; name="'+t+'"'+x+x,k+=unescape(encodeURIComponent(e))+x}),_=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",k+=p+f+x+'Content-Disposition: form-data; name="'+t.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+x+"Content-Type: "+_+x+x+r+x+p+f+p+x,d=k.length-r.length,r=k,h(r),void 0}w=n.buildUrl(t.settings.url,n.extend(v,t.settings.multipart_params)),l.open("post",w,!0),l.setRequestHeader("Content-Type","application/octet-stream"),n.each(t.settings.headers,function(e,t){l.setRequestHeader(t,e)}),"string"==typeof r?h(r):l.send(r)}var m,g,v,y,b,_,w=t.settings.url;i.status!=n.DONE&&i.status!=n.FAILED&&t.state!=n.STOPPED&&(v={name:i.target_name||i.name},d.chunk_size&&i.size>d.chunk_size&&(u.chunks||"string"==typeof o)?(y=d.chunk_size,g=Math.ceil(i.size/y),b=Math.min(y,i.size-a*y),m="string"==typeof o?o.substring(a*y,a*y+b):r(o,a*y,a*y+b),v.chunk=a,v.chunks=g):(b=i.size,m=o),t.settings.multipart&&u.multipart&&"string"!=typeof m&&f&&u.cantSendBlobInFormData&&u.chunks&&t.settings.chunk_size?(f.onload=function(){p(f.result)},f.readAsBinaryString(m)):p(m))}var a=0,c=0,f="FileReader"in e?new FileReader:null;s()}var c,d=t.settings;c=f[i.id],u.jpgresize&&t.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?a.call(t,i,t.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",function(e){e.success?(i.size=e.data.length,o(e.data)):u.chunks?o(c):s(c,o)}):!u.chunks&&u.jpgresize?s(c,o):o(c)}),i.bind("Destroy",function(e){var i,r,o=t.body,s={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(i in s)r=t.getElementById(s[i]),r&&n.removeAllEvents(r,e.id);n.removeAllEvents(t.body,e.id),e.settings.container&&(o=t.getElementById(e.settings.container)),o.removeChild(t.getElementById(s.inputContainer))}),r({success:!0}),void 0):(r({success:!1}),void 0)}})}(window,document,plupload),define("pluploadHtml5",function(){}),define("tools/upload-plugin",["jquery","cnamplify","tools/json-str-to-json-obj","plupload","pluploadFlash","pluploadHtml5"],function(e,t,n){var i=function(){var i=this;this.settings={runtimes:"gears,html5,flash,silverlight,browserplus",browseButtonId:"",wrapId:"",url:"/api/attachment/",fileSize:"200mb",autoUpload:!0,fileDataName:"upload_file",swfUrl:"/js/ui/plupload/plupload.flash.swf",silverlightXapUrl:"/js/ui/plupload/plupload.silverlight.xap",fileExts:"bmp,jpg,jpeg,png,gif,doc,docx,ppt,pptx,xls,xlsx,psd,pdf,mp3,ogg,mp4,txt,zip,rar,7z,gz,tar,BMP,JPG,JPEG,PNG,GIF",removeButtonId:"",normalStyle:!0,imgResize:{},extraParams:{},events:{beforeUpload:function(){},error:function(){},selectFile:function(){},removeFile:function(){},success:function(){},init:function(){},postInit:function(){},queueChange:function(){},refresh:function(){},stateChange:function(){},complete:function(){},progress:function(){}}},this.init=function(){i.pluploader=new plupload.Uploader({runtimes:i.settings.runtimes,browse_button:i.settings.browseButtonId,container:i.settings.wrapId,max_file_size:i.settings.fileSize,url:i.settings.url+"?TOKEN="+t.cookie.get("cn_token"),file_data_name:i.settings.fileDataName,resize:i.settings.imgResize,flash_swf_url:i.settings.swfUrl,silverlight_xap_url:i.settings.silverlightXapUrl,multipart_params:i.settings.extraParams,drop_element:i.settings.removeButtonId,filters:[{title:"file",extensions:i.settings.fileExts}]})},this.events=function(){i.pluploader.bind("Init",function(t,n){e("#"+i.settings.wrapId).append('<div class="plupload_list"></div>'),i.settings.events.init(t,n)}),i.pluploader.bind("BeforeUpload",function(e,t){i.settings.events.beforeUpload(e,t)}),i.pluploader.bind("Error",function(t,n){e("#"+i.settings.wrapId).find(".plupload_list").append("<div>Error: "+n.code+", Message: "+n.message+(n.file?", File: "+n.file.name:"")+"</div>"),i.settings.events.error(t,n),t.refresh()}),i.pluploader.bind("FilesAdded",function(t,n){var r=e("#"+i.settings.wrapId).closest("form");r.attr("locked")||(r.attr("locked","locked"),r.on("submit",function(){return e(this).attr("locked")?(alert("The file is uploading, please wait."),!1):void 0})),i.settings.normalStyle&&e.each(n,function(t,n){e("#"+i.settings.wrapId).find(".plupload_list").append('<div id="'+n.id+'">'+n.name+" ("+plupload.formatSize(n.size)+") <b></b>"+"</div>")}),i.settings.events.selectFile(t,n),i.settings.autoUpload&&setTimeout(function(){t.start()},500),t.refresh()}),i.pluploader.bind("UploadProgress",function(t,n){e("#"+i.settings.wrapId).find("#"+n.id+" b").html(n.percent+"%"),i.settings.events.progress(t,n)}),i.pluploader.bind("FileUploaded",function(t,r,o){var s=e("#"+i.settings.wrapId).find("#"+r.id);setTimeout(function(){s.remove()},1e3);var a=n(o.response);i.settings.events.success(t,r,a)}),i.pluploader.bind("UploadComplete",function(t,n){var r=e("#"+i.settings.wrapId).closest("form");r.removeAttr("locked"),i.settings.events.complete(t,n)});var t=0,r=function(){setTimeout(function(){e("#"+i.settings.wrapId).length>0&&e("#"+i.settings.browseButtonId).length>0?i.pluploader.init():100>t&&(++t,r())},100)};r()},this.run=function(){i.init(),i.events()},this.set=function(t){return"object"==typeof t&&(i.settings=e.extend(!0,{},i.settings,t)),i}};return{getInstance:function(){return new i},set:function(e){this.getInstance().set(e).run()},upload:function(){this.getInstance().pluploader.start()}}}),function(e,t,n,i){var r=n(e),o=n(t),s=n.fancybox=function(){s.open.apply(this,arguments)},a=navigator.userAgent.match(/msie/),u=null,l=t.createTouch!==i,c=function(e){return e&&e.hasOwnProperty&&e instanceof n},d=function(e){return e&&"string"===n.type(e)},f=function(e){return d(e)&&e.indexOf("%")>0},h=function(e){return e&&!(e.style.overflow&&"hidden"===e.style.overflow)&&(e.clientWidth&&e.scrollWidth>e.clientWidth||e.clientHeight&&e.scrollHeight>e.clientHeight)},p=function(e,t){var n=parseInt(e,10)||0;return t&&f(e)&&(n=s.getViewport()[t]/100*n),Math.ceil(n)},m=function(e,t){return p(e,t)+"px"};n.extend(s,{version:"2.1.4",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!l,fitToView:!0,aspectRatio:!1,topRatio:.5,leftRatio:.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(a?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:n.noop,beforeLoad:n.noop,afterLoad:n.noop,beforeShow:n.noop,afterShow:n.noop,beforeChange:n.noop,beforeClose:n.noop,afterClose:n.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(e,t){return e&&(n.isPlainObject(t)||(t={}),!1!==s.close(!0))?(n.isArray(e)||(e=c(e)?n(e).get():[e]),n.each(e,function(r,o){var a,u,l,f,h,p,m,g={};"object"===n.type(o)&&(o.nodeType&&(o=n(o)),c(o)?(g={href:o.data("fancybox-href")||o.attr("href"),title:o.data("fancybox-title")||o.attr("title"),isDom:!0,element:o},n.metadata&&n.extend(!0,g,o.metadata())):g=o),a=t.href||g.href||(d(o)?o:null),u=t.title!==i?t.title:g.title||"",l=t.content||g.content,f=l?"html":t.type||g.type,!f&&g.isDom&&(f=o.data("fancybox-type"),f||(h=o.prop("class").match(/fancybox\.(\w+)/),f=h?h[1]:null)),d(a)&&(f||(s.isImage(a)?f="image":s.isSWF(a)?f="swf":"#"===a.charAt(0)?f="inline":d(o)&&(f="html",l=o)),"ajax"===f&&(p=a.split(/\s+/,2),a=p.shift(),m=p.shift())),l||("inline"===f?a?l=n(d(a)?a.replace(/.*(?=#[^\s]+$)/,""):a):g.isDom&&(l=o):"html"===f?l=a:f||a||!g.isDom||(f="inline",l=o)),n.extend(g,{href:a,type:f,content:l,title:u,selector:m}),e[r]=g}),s.opts=n.extend(!0,{},s.defaults,t),t.keys!==i&&(s.opts.keys=t.keys?n.extend({},s.defaults.keys,t.keys):!1),s.group=e,s._start(s.opts.index)):i},cancel:function(){var e=s.coming;e&&!1!==s.trigger("onCancel")&&(s.hideLoading(),s.ajaxLoad&&s.ajaxLoad.abort(),s.ajaxLoad=null,s.imgPreload&&(s.imgPreload.onload=s.imgPreload.onerror=null),e.wrap&&e.wrap.stop(!0,!0).trigger("onReset").remove(),s.coming=null,s.current||s._afterZoomOut(e))},close:function(e){s.cancel(),!1!==s.trigger("beforeClose")&&(s.unbindEvents(),s.isActive&&(s.isOpen&&e!==!0?(s.isOpen=s.isOpened=!1,s.isClosing=!0,n(".fancybox-item, .fancybox-nav").remove(),s.wrap.stop(!0,!0).removeClass("fancybox-opened"),s.transitions[s.current.closeMethod]()):(n(".fancybox-wrap").stop(!0).trigger("onReset").remove(),s._afterZoomOut())))},play:function(e){var t=function(){clearTimeout(s.player.timer)},i=function(){t(),s.current&&s.player.isActive&&(s.player.timer=setTimeout(s.next,s.current.playSpeed))},r=function(){t(),n("body").unbind(".player"),s.player.isActive=!1,s.trigger("onPlayEnd")},o=function(){s.current&&(s.current.loop||s.current.index<s.group.length-1)&&(s.player.isActive=!0,n("body").bind({"afterShow.player onUpdate.player":i,"onCancel.player beforeClose.player":r,"beforeLoad.player":t}),i(),s.trigger("onPlayStart"))
};e===!0||!s.player.isActive&&e!==!1?o():r()},next:function(e){var t=s.current;t&&(d(e)||(e=t.direction.next),s.jumpto(t.index+1,e,"next"))},prev:function(e){var t=s.current;t&&(d(e)||(e=t.direction.prev),s.jumpto(t.index-1,e,"prev"))},jumpto:function(e,t,n){var r=s.current;r&&(e=p(e),s.direction=t||r.direction[e>=r.index?"next":"prev"],s.router=n||"jumpto",r.loop&&(0>e&&(e=r.group.length+e%r.group.length),e%=r.group.length),r.group[e]!==i&&(s.cancel(),s._start(e)))},reposition:function(e,t){var i,r=s.current,o=r?r.wrap:null;o&&(i=s._getPosition(t),e&&"scroll"===e.type?(delete i.position,o.stop(!0,!0).animate(i,200)):(o.css(i),r.pos=n.extend({},r.dim,i)))},update:function(e){var t=e&&e.type,n=!t||"orientationchange"===t;n&&(clearTimeout(u),u=null),s.isOpen&&!u&&(u=setTimeout(function(){var i=s.current;i&&!s.isClosing&&(s.wrap.removeClass("fancybox-tmp"),(n||"load"===t||"resize"===t&&i.autoResize)&&s._setDimension(),"scroll"===t&&i.canShrink||s.reposition(e),s.trigger("onUpdate"),u=null)},n&&!l?0:300))},toggle:function(e){s.isOpen&&(s.current.fitToView="boolean"===n.type(e)?e:!s.current.fitToView,l&&(s.wrap.removeAttr("style").addClass("fancybox-tmp"),s.trigger("onUpdate")),s.update())},hideLoading:function(){o.unbind(".loading"),n("#fancybox-loading").remove()},showLoading:function(){var e,t;s.hideLoading(),e=n('<div id="fancybox-loading"><div></div></div>').click(s.cancel).appendTo("body"),o.bind("keydown.loading",function(e){27===(e.which||e.keyCode)&&(e.preventDefault(),s.cancel())}),s.defaults.fixed||(t=s.getViewport(),e.css({position:"absolute",top:.5*t.h+t.y,left:.5*t.w+t.x}))},getViewport:function(){var t=s.current&&s.current.locked||!1,n={x:r.scrollLeft(),y:r.scrollTop()};return t?(n.w=t[0].clientWidth,n.h=t[0].clientHeight):(n.w=l&&e.innerWidth?e.innerWidth:r.width(),n.h=l&&e.innerHeight?e.innerHeight:r.height()),n},unbindEvents:function(){s.wrap&&c(s.wrap)&&s.wrap.unbind(".fb"),o.unbind(".fb"),r.unbind(".fb")},bindEvents:function(){var e,t=s.current;t&&(r.bind("orientationchange.fb"+(l?"":" resize.fb")+(t.autoCenter&&!t.locked?" scroll.fb":""),s.update),e=t.keys,e&&o.bind("keydown.fb",function(r){var o=r.which||r.keyCode,a=r.target||r.srcElement;return 27===o&&s.coming?!1:(r.ctrlKey||r.altKey||r.shiftKey||r.metaKey||a&&(a.type||n(a).is("[contenteditable]"))||n.each(e,function(e,a){return t.group.length>1&&a[o]!==i?(s[e](a[o]),r.preventDefault(),!1):n.inArray(o,a)>-1?(s[e](),r.preventDefault(),!1):i}),i)}),n.fn.mousewheel&&t.mouseWheel&&s.wrap.bind("mousewheel.fb",function(e,i,r,o){for(var a=e.target||null,u=n(a),l=!1;u.length&&!(l||u.is(".fancybox-skin")||u.is(".fancybox-wrap"));)l=h(u[0]),u=n(u).parent();0===i||l||s.group.length>1&&!t.canShrink&&(o>0||r>0?s.prev(o>0?"down":"left"):(0>o||0>r)&&s.next(0>o?"up":"right"),e.preventDefault())}))},trigger:function(e,t){var i,r=t||s.coming||s.current;if(r){if(n.isFunction(r[e])&&(i=r[e].apply(r,Array.prototype.slice.call(arguments,1))),i===!1)return!1;r.helpers&&n.each(r.helpers,function(t,i){i&&s.helpers[t]&&n.isFunction(s.helpers[t][e])&&(i=n.extend(!0,{},s.helpers[t].defaults,i),s.helpers[t][e](i,r))}),n.event.trigger(e+".fb")}},isImage:function(e){return d(e)&&e.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp)((\?|#).*)?$)/i)},isSWF:function(e){return d(e)&&e.match(/\.(swf)((\?|#).*)?$/i)},_start:function(e){var t,r,o,a,u,c={};if(e=p(e),t=s.group[e]||null,!t)return!1;if(c=n.extend(!0,{},s.opts,t),a=c.margin,u=c.padding,"number"===n.type(a)&&(c.margin=[a,a,a,a]),"number"===n.type(u)&&(c.padding=[u,u,u,u]),c.modal&&n.extend(!0,c,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}}),c.autoSize&&(c.autoWidth=c.autoHeight=!0),"auto"===c.width&&(c.autoWidth=!0),"auto"===c.height&&(c.autoHeight=!0),c.group=s.group,c.index=e,s.coming=c,!1===s.trigger("beforeLoad"))return s.coming=null,i;if(o=c.type,r=c.href,!o)return s.coming=null,s.current&&s.router&&"jumpto"!==s.router?(s.current.index=e,s[s.router](s.direction)):!1;if(s.isActive=!0,("image"===o||"swf"===o)&&(c.autoHeight=c.autoWidth=!1,c.scrolling="visible"),"image"===o&&(c.aspectRatio=!0),"iframe"===o&&l&&(c.scrolling="scroll"),c.wrap=n(c.tpl.wrap).addClass("fancybox-"+(l?"mobile":"desktop")+" fancybox-type-"+o+" fancybox-tmp "+c.wrapCSS).appendTo(c.parent||"body"),n.extend(c,{skin:n(".fancybox-skin",c.wrap),outer:n(".fancybox-outer",c.wrap),inner:n(".fancybox-inner",c.wrap)}),n.each(["Top","Right","Bottom","Left"],function(e,t){c.skin.css("padding"+t,m(c.padding[e]))}),s.trigger("onReady"),"inline"===o||"html"===o){if(!c.content||!c.content.length)return s._error("content")}else if(!r)return s._error("href");"image"===o?s._loadImage():"ajax"===o?s._loadAjax():"iframe"===o?s._loadIframe():s._afterLoad()},_error:function(e){n.extend(s.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:e,content:s.coming.tpl.error}),s._afterLoad()},_loadImage:function(){var e=s.imgPreload=new Image;e.onload=function(){this.onload=this.onerror=null,s.coming.width=this.width,s.coming.height=this.height,s._afterLoad()},e.onerror=function(){this.onload=this.onerror=null,s._error("image")},e.src=s.coming.href,e.complete!==!0&&s.showLoading()},_loadAjax:function(){var e=s.coming;s.showLoading(),s.ajaxLoad=n.ajax(n.extend({},e.ajax,{url:e.href,error:function(e,t){s.coming&&"abort"!==t?s._error("ajax",e):s.hideLoading()},success:function(t,n){"success"===n&&(e.content=t,s._afterLoad())}}))},_loadIframe:function(){var e=s.coming,t=n(e.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",l?"auto":e.iframe.scrolling).attr("src",e.href);n(e.wrap).bind("onReset",function(){try{n(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(e){}}),e.iframe.preload&&(s.showLoading(),t.one("load",function(){n(this).data("ready",1),l||n(this).bind("load.fb",s.update),n(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(),s._afterLoad()})),e.content=t.appendTo(e.inner),e.iframe.preload||s._afterLoad()},_preloadImages:function(){var e,t,n=s.group,i=s.current,r=n.length,o=i.preload?Math.min(i.preload,r-1):0;for(t=1;o>=t;t+=1)e=n[(i.index+t)%r],"image"===e.type&&e.href&&((new Image).src=e.href)},_afterLoad:function(){var e,t,r,o,a,u,l=s.coming,d=s.current,f="fancybox-placeholder";if(s.hideLoading(),l&&s.isActive!==!1){if(!1===s.trigger("afterLoad",l,d))return l.wrap.stop(!0).trigger("onReset").remove(),s.coming=null,i;switch(d&&(s.trigger("beforeChange",d),d.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()),s.unbindEvents(),e=l,t=l.content,r=l.type,o=l.scrolling,n.extend(s,{wrap:e.wrap,skin:e.skin,outer:e.outer,inner:e.inner,current:e,previous:d}),a=e.href,r){case"inline":case"ajax":case"html":e.selector?t=n("<div>").html(t).find(e.selector):c(t)&&(t.data(f)||t.data(f,n('<div class="'+f+'"></div>').insertAfter(t).hide()),t=t.show().detach(),e.wrap.bind("onReset",function(){n(this).find(t).length&&t.hide().replaceAll(t.data(f)).data(f,!1)}));break;case"image":t=e.tpl.image.replace("{href}",a);break;case"swf":t='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+a+'"></param>',u="",n.each(e.swf,function(e,n){t+='<param name="'+e+'" value="'+n+'"></param>',u+=" "+e+'="'+n+'"'}),t+='<embed src="'+a+'" type="application/x-shockwave-flash" width="100%" height="100%"'+u+"></embed></object>"}c(t)&&t.parent().is(e.inner)||e.inner.append(t),s.trigger("beforeShow"),e.inner.css("overflow","yes"===o?"scroll":"no"===o?"hidden":o),s._setDimension(),s.reposition(),s.isOpen=!1,s.coming=null,s.bindEvents(),s.isOpened?d.prevMethod&&s.transitions[d.prevMethod]():n(".fancybox-wrap").not(e.wrap).stop(!0).trigger("onReset").remove(),s.transitions[s.isOpened?e.nextMethod:e.openMethod](),s._preloadImages()}},_setDimension:function(){var e,t,i,r,o,a,u,l,c,d,h,g,v,y,b,_=s.getViewport(),w=0,x=!1,k=!1,C=s.wrap,T=s.skin,E=s.inner,S=s.current,D=S.width,N=S.height,A=S.minWidth,F=S.minHeight,j=S.maxWidth,M=S.maxHeight,O=S.scrolling,P=S.scrollOutside?S.scrollbarWidth:0,I=S.margin,R=p(I[1]+I[3]),q=p(I[0]+I[2]);if(C.add(T).add(E).width("auto").height("auto").removeClass("fancybox-tmp"),e=p(T.outerWidth(!0)-T.width()),t=p(T.outerHeight(!0)-T.height()),i=R+e,r=q+t,o=f(D)?(_.w-i)*p(D)/100:D,a=f(N)?(_.h-r)*p(N)/100:N,"iframe"===S.type){if(y=S.content,S.autoHeight&&1===y.data("ready"))try{y[0].contentWindow.document.location&&(E.width(o).height(9999),b=y.contents().find("body"),P&&b.css("overflow-x","hidden"),a=b.height())}catch(L){}}else(S.autoWidth||S.autoHeight)&&(E.addClass("fancybox-tmp"),S.autoWidth||E.width(o),S.autoHeight||E.height(a),S.autoWidth&&(o=E.width()),S.autoHeight&&(a=E.height()),E.removeClass("fancybox-tmp"));if(D=p(o),N=p(a),c=o/a,A=p(f(A)?p(A,"w")-i:A),j=p(f(j)?p(j,"w")-i:j),F=p(f(F)?p(F,"h")-r:F),M=p(f(M)?p(M,"h")-r:M),u=j,l=M,S.fitToView&&(j=Math.min(_.w-i,j),M=Math.min(_.h-r,M)),g=_.w-R,v=_.h-q,S.aspectRatio?(D>j&&(D=j,N=p(D/c)),N>M&&(N=M,D=p(N*c)),A>D&&(D=A,N=p(D/c)),F>N&&(N=F,D=p(N*c))):(D=Math.max(A,Math.min(D,j)),S.autoHeight&&"iframe"!==S.type&&(E.width(D),N=E.height()),N=Math.max(F,Math.min(N,M))),S.fitToView)if(E.width(D).height(N),C.width(D+e),d=C.width(),h=C.height(),S.aspectRatio)for(;(d>g||h>v)&&D>A&&N>F&&!(w++>19);)N=Math.max(F,Math.min(M,N-10)),D=p(N*c),A>D&&(D=A,N=p(D/c)),D>j&&(D=j,N=p(D/c)),E.width(D).height(N),C.width(D+e),d=C.width(),h=C.height();else D=Math.max(A,Math.min(D,D-(d-g))),N=Math.max(F,Math.min(N,N-(h-v)));P&&"auto"===O&&a>N&&g>D+e+P&&(D+=P),E.width(D).height(N),C.width(D+e),d=C.width(),h=C.height(),x=(d>g||h>v)&&D>A&&N>F,k=S.aspectRatio?u>D&&l>N&&o>D&&a>N:(u>D||l>N)&&(o>D||a>N),n.extend(S,{dim:{width:m(d),height:m(h)},origWidth:o,origHeight:a,canShrink:x,canExpand:k,wPadding:e,hPadding:t,wrapSpace:h-T.outerHeight(!0),skinSpace:T.height()-N}),!y&&S.autoHeight&&N>F&&M>N&&!k&&E.height("auto")},_getPosition:function(e){var t=s.current,n=s.getViewport(),i=t.margin,r=s.wrap.width()+i[1]+i[3],o=s.wrap.height()+i[0]+i[2],a={position:"absolute",top:i[0],left:i[3]};return t.autoCenter&&t.fixed&&!e&&n.h>=o&&n.w>=r?a.position="fixed":t.locked||(a.top+=n.y,a.left+=n.x),a.top=m(Math.max(a.top,a.top+(n.h-o)*t.topRatio)),a.left=m(Math.max(a.left,a.left+(n.w-r)*t.leftRatio)),a},_afterZoomIn:function(){var e=s.current;e&&(s.isOpen=s.isOpened=!0,s.wrap.css("overflow","visible").addClass("fancybox-opened"),s.update(),(e.closeClick||e.nextClick&&s.group.length>1)&&s.inner.css("cursor","pointer").bind("click.fb",function(t){n(t.target).is("a")||n(t.target).parent().is("a")||(t.preventDefault(),s[e.closeClick?"close":"next"]())}),e.closeBtn&&n(e.tpl.closeBtn).appendTo(s.skin).bind("click.fb",function(e){e.preventDefault(),s.close()}),e.arrows&&s.group.length>1&&((e.loop||e.index>0)&&n(e.tpl.prev).appendTo(s.outer).bind("click.fb",s.prev),(e.loop||e.index<s.group.length-1)&&n(e.tpl.next).appendTo(s.outer).bind("click.fb",s.next)),s.trigger("afterShow"),e.loop||e.index!==e.group.length-1?s.opts.autoPlay&&!s.player.isActive&&(s.opts.autoPlay=!1,s.play()):s.play(!1))},_afterZoomOut:function(e){e=e||s.current,n(".fancybox-wrap").trigger("onReset").remove(),n.extend(s,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null}),s.trigger("afterClose",e)}}),s.transitions={getOrigPosition:function(){var e=s.current,t=e.element,n=e.orig,i={},r=50,o=50,a=e.hPadding,u=e.wPadding,l=s.getViewport();return!n&&e.isDom&&t.is(":visible")&&(n=t.find("img:first"),n.length||(n=t)),c(n)?(i=n.offset(),n.is("img")&&(r=n.outerWidth(),o=n.outerHeight())):(i.top=l.y+(l.h-o)*e.topRatio,i.left=l.x+(l.w-r)*e.leftRatio),("fixed"===s.wrap.css("position")||e.locked)&&(i.top-=l.y,i.left-=l.x),i={top:m(i.top-a*e.topRatio),left:m(i.left-u*e.leftRatio),width:m(r+u),height:m(o+a)}},step:function(e,t){var n,i,r,o=t.prop,a=s.current,u=a.wrapSpace,l=a.skinSpace;("width"===o||"height"===o)&&(n=t.end===t.start?1:(e-t.start)/(t.end-t.start),s.isClosing&&(n=1-n),i="width"===o?a.wPadding:a.hPadding,r=e-i,s.skin[o](p("width"===o?r:r-u*n)),s.inner[o](p("width"===o?r:r-u*n-l*n)))},zoomIn:function(){var e=s.current,t=e.pos,i=e.openEffect,r="elastic"===i,o=n.extend({opacity:1},t);delete o.position,r?(t=this.getOrigPosition(),e.openOpacity&&(t.opacity=.1)):"fade"===i&&(t.opacity=.1),s.wrap.css(t).animate(o,{duration:"none"===i?0:e.openSpeed,easing:e.openEasing,step:r?this.step:null,complete:s._afterZoomIn})},zoomOut:function(){var e=s.current,t=e.closeEffect,n="elastic"===t,i={opacity:.1};n&&(i=this.getOrigPosition(),e.closeOpacity&&(i.opacity=.1)),s.wrap.animate(i,{duration:"none"===t?0:e.closeSpeed,easing:e.closeEasing,step:n?this.step:null,complete:s._afterZoomOut})},changeIn:function(){var e,t=s.current,n=t.nextEffect,i=t.pos,r={opacity:1},o=s.direction,a=200;i.opacity=.1,"elastic"===n&&(e="down"===o||"up"===o?"top":"left","down"===o||"right"===o?(i[e]=m(p(i[e])-a),r[e]="+="+a+"px"):(i[e]=m(p(i[e])+a),r[e]="-="+a+"px")),"none"===n?s._afterZoomIn():s.wrap.css(i).animate(r,{duration:t.nextSpeed,easing:t.nextEasing,complete:s._afterZoomIn})},changeOut:function(){var e=s.previous,t=e.prevEffect,i={opacity:.1},r=s.direction,o=200;"elastic"===t&&(i["down"===r||"up"===r?"top":"left"]=("up"===r||"left"===r?"-":"+")+"="+o+"px"),e.wrap.animate(i,{duration:"none"===t?0:e.prevSpeed,easing:e.prevEasing,complete:function(){n(this).trigger("onReset").remove()}})}},s.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!l,fixed:!0},overlay:null,fixed:!1,create:function(e){e=n.extend({},this.defaults,e),this.overlay&&this.close(),this.overlay=n('<div class="fancybox-overlay"></div>').appendTo("body"),this.fixed=!1,e.fixed&&s.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(e){var t=this;e=n.extend({},this.defaults,e),this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(e),this.fixed||(r.bind("resize.overlay",n.proxy(this.update,this)),this.update()),e.closeClick&&this.overlay.bind("click.overlay",function(e){n(e.target).hasClass("fancybox-overlay")&&(s.isActive?s.close():t.close())}),this.overlay.css(e.css).show()},close:function(){n(".fancybox-overlay").remove(),r.unbind("resize.overlay"),this.overlay=null,this.margin!==!1&&(n("body").css("margin-right",this.margin),this.margin=!1),this.el&&this.el.removeClass("fancybox-lock")},update:function(){var e,n="100%";this.overlay.width(n).height("100%"),a?(e=Math.max(t.documentElement.offsetWidth,t.body.offsetWidth),o.width()>e&&(n=o.width())):o.width()>r.width()&&(n=o.width()),this.overlay.width(n).height(o.height())},onReady:function(e,i){n(".fancybox-overlay").stop(!0,!0),this.overlay||(this.margin=o.height()>r.height()||"scroll"===n("body").css("overflow-y")?n("body").css("margin-right"):!1,this.el=t.all&&!t.querySelector?n("html"):n("body"),this.create(e)),e.locked&&this.fixed&&(i.locked=this.overlay.append(i.wrap),i.fixed=!1),e.showEarly===!0&&this.beforeShow.apply(this,arguments)},beforeShow:function(e,t){t.locked&&(this.el.addClass("fancybox-lock"),this.margin!==!1&&n("body").css("margin-right",p(this.margin)+t.scrollbarWidth)),this.open(e)},onUpdate:function(){this.fixed||this.update()},afterClose:function(e){this.overlay&&!s.isActive&&this.overlay.fadeOut(e.speedOut,n.proxy(this.close,this))}},s.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(e){var t,i,r=s.current,o=r.title,u=e.type;if(n.isFunction(o)&&(o=o.call(r.element,r)),d(o)&&""!==n.trim(o)){switch(t=n('<div class="fancybox-title fancybox-title-'+u+'-wrap">'+o+"</div>"),u){case"inside":i=s.skin;break;case"outside":i=s.wrap;break;case"over":i=s.inner;break;default:i=s.skin,t.appendTo("body"),a&&t.width(t.width()),t.wrapInner('<span class="child"></span>'),s.current.margin[2]+=Math.abs(p(t.css("margin-bottom")))}t["top"===e.position?"prependTo":"appendTo"](i)}}},n.fn.fancybox=function(e){var t,i=n(this),r=this.selector||"",a=function(o){var a,u,l=n(this).blur(),c=t;o.ctrlKey||o.altKey||o.shiftKey||o.metaKey||l.is(".fancybox-wrap")||(a=e.groupAttr||"data-fancybox-group",u=l.attr(a),u||(a="rel",u=l.get(0)[a]),u&&""!==u&&"nofollow"!==u&&(l=r.length?n(r):i,l=l.filter("["+a+'="'+u+'"]'),c=l.index(this)),e.index=c,s.open(l,e)!==!1&&o.preventDefault())};return e=e||{},t=e.index||0,r&&e.live!==!1?o.undelegate(r,"click.fb-start").delegate(r+":not('.fancybox-item, .fancybox-nav')","click.fb-start",a):i.unbind("click.fb-start").bind("click.fb-start",a),this.filter("[data-fancybox-start=1]").trigger("click"),this},o.ready(function(){n.scrollbarWidth===i&&(n.scrollbarWidth=function(){var e=n('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),t=e.children(),i=t.innerWidth()-t.height(99).innerWidth();return e.remove(),i}),n.support.fixedPosition===i&&(n.support.fixedPosition=function(){var e=n('<div style="position:fixed;top:20px;"></div>').appendTo("body"),t=20===e[0].offsetTop||15===e[0].offsetTop;return e.remove(),t}()),n.extend(s.defaults,{scrollbarWidth:n.scrollbarWidth(),fixed:n.support.fixedPosition,parent:n("body")})})}(window,document,jQuery),define("ui/fancybox/source/jquery.fancybox",function(){}),define("jqueryFancybox",["ui/fancybox/source/jquery.fancybox"],function(){(function(e,t,n){var i,r=e.getElementsByTagName(t)[0];e.getElementById(n)||(i=e.createElement(t),i.id=n,i.href=window.STATIC_FILE_HOST+"js/ui/fancybox/source/jquery.fancybox.css",i.rel="stylesheet",r.parentNode.insertBefore(i,r))})(document,"link","fancybox_style")}),function(e){var t=e.fancybox,n=function(t,n,i){return i=i||"","object"===e.type(i)&&(i=e.param(i,!0)),e.each(n,function(e,n){t=t.replace("$"+e,n||"")}),i.length&&(t+=(t.indexOf("?")>0?"&":"?")+i),t};t.helpers.media={defaults:{youtube:{matcher:/(youtube\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?(videoseries\?list=(.*)|[\w-]{11}|\?listType=(.*)&list=(.*)).*/i,params:{autoplay:1,autohide:1,fs:1,rel:0,hd:1,wmode:"opaque",enablejsapi:1},type:"iframe",url:"//www.youtube.com/embed/$3"},vimeo:{matcher:/(?:vimeo(?:pro)?.com)\/(?:[^\d]+)?(\d+)(?:.*)/,params:{autoplay:1,hd:1,show_title:1,show_byline:1,show_portrait:0,fullscreen:1},type:"iframe",url:"//player.vimeo.com/video/$1"},metacafe:{matcher:/metacafe.com\/(?:watch|fplayer)\/([\w\-]{1,10})/,params:{autoPlay:"yes"},type:"swf",url:function(t,n,i){return i.swf.flashVars="playerVars="+e.param(n,!0),"//www.metacafe.com/fplayer/"+t[1]+"/.swf"}},dailymotion:{matcher:/dailymotion.com\/video\/(.*)\/?(.*)/,params:{additionalInfos:0,autoStart:1},type:"swf",url:"//www.dailymotion.com/swf/video/$1"},twitvid:{matcher:/twitvid\.com\/([a-zA-Z0-9_\-\?\=]+)/i,params:{autoplay:0},type:"iframe",url:"//www.twitvid.com/embed.php?guid=$1"},twitpic:{matcher:/twitpic\.com\/(?!(?:place|photos|events)\/)([a-zA-Z0-9\?\=\-]+)/i,type:"image",url:"//twitpic.com/show/full/$1/"},instagram:{matcher:/(instagr\.am|instagram\.com)\/p\/([a-zA-Z0-9_\-]+)\/?/i,type:"image",url:"//$1/p/$2/media/"},google_maps:{matcher:/maps\.google\.([a-z]{2,3}(\.[a-z]{2})?)\/(\?ll=|maps\?)(.*)/i,type:"iframe",url:function(e){return"//maps.google."+e[1]+"/"+e[3]+e[4]+"&output="+(e[4].indexOf("layer=c")>0?"svembed":"embed")}}},beforeLoad:function(t,i){var r,o,s,a,u=i.href||"",l=!1;for(r in t)if(o=t[r],s=u.match(o.matcher)){l=o.type,a=e.extend(!0,{},o.params,i[r]||(e.isPlainObject(t[r])?t[r].params:null)),u="function"===e.type(o.url)?o.url.call(this,s,a,i):n(o.url,s,a);break}l&&(i.href=u,i.type=l,i.autoHeight=!1)}}}(jQuery),define("jqueryFancyMedia",function(){}),define("tools/pop-up-window",["jquery","underscore","backbone","text!templates/common/pop-up-window/master.html","text!templates/common/pop-up-window/confirm.html","text!templates/common/pop-up-window/upload.html","tools/upload-plugin","jqueryFancybox","jqueryFancyMedia"],function(e,t,n,i,r,o,s){var a=function(){var n={};return n.inlineDefaults={wrapCSS:"cn-pop-up-window-inline",padding:0},n.videoDefaults={wrapCSS:"cn-pop-up-window-inline",padding:0,helpers:{media:!0}},n.opts={},n.alert=function(e,i,r){var o=t.extend({autoClose:!0,autoCloseDownTime:3e3,callback:function(){}},i);n.open(new(u())({data:{title:o.title?o.title:"Message",content:e,closeButton:o.closeButton?o.closeButton:!1}}).render().view.el,t.extend({helpers:{overlay:{closeClick:!1,css:{"z-index":"8012"}}}},r)),o.autoClose?setTimeout(function(){n.close(),o.callback()},o.autoCloseDownTime):o.callback()},n.confirm=function(e,i){var r=t.extend({title:"Confirmation",content:"Are you sure?",button:{string:{yes:"YES",no:"NO"}},yesCallBack:function(){},noCallBack:function(){}},e);n.open(new(l())({data:r}).render().view.el,t.extend({helpers:{overlay:{closeClick:!1,css:{"z-index":"8012"}}}},i))},n.upload=function(e,i){var r=t.extend({title:"Upload",content:"",button:{string:{upload:"UPLOAD",cancel:"CANCEL"}},autoClose:-1,success:function(){},cancelCallBack:function(){},beforeUpload:function(){},complete:function(){}},e);n.open(new(c())({data:r}).render().view.el,t.extend({helpers:{overlay:{closeClick:!1,css:{"z-index":"8012"}}}},i))},n.open=function(t,i){n.opts=e.extend(!0,{},n.inlineDefaults,i),e.fancybox(t,n.opts),setTimeout(n.update,1e3),setTimeout(n.update,5e3),setTimeout(n.update,1e4)},n.close=function(t){e.fancybox.close(),"function"==typeof t&&t()},n.update=function(t){e.fancybox.update(t)},n.next=function(){e.fancybox.next()},n.prev=function(){e.fancybox.prev()},n.bindGalleryNormal=function(t){n.opts=e.extend(!0,{},n.inlineDefaults,t),e(t.element).fancybox(n.opts)},n.bindVideo=function(t){n.opts=e.extend(!0,{},n.videoDefaults,t),e(t.element).fancybox(n.opts)},n},u=function(){return n.View.extend({className:"pop-up-window",template:i,initialize:function(e){t.bindAll(this,"initialize_","beforeRender_","afterRender_"),this.data=e?e.data?e.data:{}:{},this.initialize_(e)},initialize_:function(){},events:{"click .cancel":"deleted"},serialize:function(){return t.isEmpty(this.data)?this.model?this.model.toJSON():{}:this.data},beforeRender:function(){this.beforeRender_()},beforeRender_:function(){},afterRender:function(){this.afterRender_(),a().update()},afterRender_:function(){},deleted:function(){a().close(),this.remove()}})},l=function(){return u().extend({className:"block-window-confirm pop-up-window",template:r,events:{"click .cancel":"deleted","click .sure":"sure"},sure:function(){this.data.yesCallBack(),a().close(),this.remove()},deleted:function(){this.data.noCallBack(),a().close(),this.remove()}})},c=function(){return u().extend({className:"block-window-upload pop-up-window",template:o,events:{"click .cancel":"close"},beforeRender_:function(){this.data&&"object"==typeof this.data.content&&this.setViews({".text":this.data.content})},getContent:function(){return this.$("#pop_up_upload_content")},getTitle:function(){return this.$("#pop_up_upload_title")},afterRender_:function(){var t=this;s.set({browseButtonId:"pop_up_upload",wrapId:"pop_up_upload_wrapper",normalStyle:!1,events:{beforeUpload:function(e,n){t.data.beforeUpload.call(t,e,n),a().update()},selectFile:function(n,i){e.each(i,function(e,n){t.$(".pop_up_upload_status").append('<div id="'+n.id+'">'+n.name+" ("+plupload.formatSize(n.size)+") <b></b>"+"</div>")})},progress:function(){t.$("#pop_up_upload").prop("disabled",!0),t.$("#pop_up_upload").html("UPLOADING"),a().update()},success:function(n,i,r){r.result&&"object"===e.type(r.data)&&(t.data.success.call(t,r.data),setTimeout(function(){t.$("#pop_up_upload").html("UPLOADED"),t.$("#pop_up_upload").prop("disabled",!1)},2e3),a().update(),parseInt(t.data.autoClose)>0&&setTimeout(function(){t.close()},1e3*parseInt(t.data.autoClose)))},complete:function(e,n){t.data.complete.call(t,e,n),a().update()}}})},close:function(){this.data.cancelCallBack.call(this),a().close(),this.remove()}})},d={view:u,"function":a};return{get:function(e){return d[e]()}}}),function(e){var t,n=e.Backbone,i=e._,r=e.$,o=n.View.prototype._configure;n.View.prototype.render;var s=Array.prototype.push,a=Array.prototype.concat,u=Array.prototype.splice,l=n.View.extend({constructor:function(e){e=e||{},l.setupView(this,e),n.View.call(this,e)},insertView:function(e,t){return t?this.setView(e,t,!0):this.setView(e,!0)},insertViews:function(e){return i.isArray(e)?this.setViews({"":e}):(i.each(e,function(t,n){e[n]=i.isArray(t)?t:[t]}),this.setViews(e))},getView:function(e){return this.getViews(e).first().value()},getViews:function(e){var t=i.chain(this.views).map(function(e){return i.isArray(e)?e:[e]},this).flatten().value();return"string"==typeof e?i.chain([this.views[e]]).flatten():i.chain("function"==typeof e?i.filter(t,e):t)},setView:function(e,t,n){var r,o,s,u=this;if("string"!=typeof e&&(n=t,t=e,e=""),this.views=this.views||{},r=t.__manager__,o=this.views[e],!r)throw Error("Please set `View#manage` property with selector '"+e+"' to `true`.");return s=t._options(),r.parent=u,r.selector=e,n?(this.views[e]=a.call([],o||[],t),r.append=!0,t):(r.hasRendered&&s.partial(u.el,r.selector,t.el,r.append),o&&i.each(a.call([],o),function(e){e.remove()}),this.views[e]=t)},setViews:function(e){return i.each(e,function(e,t){return i.isArray(e)?i.each(e,function(e){this.insertView(t,e)},this):(this.setView(t,e),void 0)},this),this},render:function(){function e(){function e(){var e=r.afterRender;e&&e.call(n,n),n.trigger("afterRender",n)}var t;return a&&(r.contains(a.el,n.el)||r.partial(a.el,o.selector,n.el,o.append)),n.delegateEvents(),o.hasRendered=!0,c.resolveWith(n,[n]),(t=o.queue.shift())?t():delete o.queue,u&&!u.hasRendered?a.on("afterRender",function(){a.off("afterRender",null,this),e()},n):(e(),void 0)}function t(){var t=n._options(),r=n.__manager__,o=r.parent;o&&o.__manager__,n._render(l._viewRender,t).done(function(){if(!i.keys(n.views).length)return e();var r=i.map(n.views,function(e){var n=i.isArray(e);return n&&e.length?e[0].render().pipe(function(){return t.when(i.map(e.slice(1),function(e){return e.render()}))}):n?e:e.render()});t.when(r).done(function(){e()})})}var n=this,r=n._options(),o=n.__manager__,a=o.parent,u=a&&a.__manager__,c=r.deferred();return o.queue?s.call(o.queue,function(){t()}):(o.queue=[],t(n,c)),c.view=n,c},remove:function(){return l._removeView(this,!0),this._remove.apply(this,arguments)},_options:function(){return i.extend({},this,this.constructor.prototype,l.prototype.options,this.options)}},{_cache:{},_makeAsync:function(e,t){var n=e.deferred();return n.async=function(){return n._isAsync=!0,t},n},_viewRender:function(e,t){function n(n){n&&t.html(e.el,n),a.resolveWith(e,[e])}function r(e,i){var r,s=l._makeAsync(t,function(e){n(e)});l.cache(o,i),i&&(r=t.render.call(s,i,e)),s._isAsync||n(r)}var o,s,a;return e.__manager__,{render:function(){var n=t.serialize||t.data,u=e.template||t.template;return i.isFunction(n)&&(n=n.call(e)),a=l._makeAsync(t,function(e){r(n,e)}),"string"==typeof u&&(o=t.prefix+u),(s=l.cache(o))?(r(n,s,o),a):("string"==typeof u?s=t.fetch.call(a,t.prefix+u):null!=u&&(s=t.fetch.call(a,u)),a._isAsync||r(n,s),a)}}},_removeViews:function(e,t){"boolean"==typeof e&&(t=e,e=this),e=e||this,e.getViews().each(function(e){(e.__manager__.hasRendered||t)&&l._removeView(e,t)})},_removeView:function(e,t){var n,r=e.__manager__,o="boolean"==typeof e.keep?e.keep:e.options.keep;if(!o&&(r.append===!0||t)){if(l.cleanViews(e),e._removeViews(!0),e.$el.remove(),!r.parent)return;if(n=r.parent.views[r.selector],i.isArray(n))return i.each(i.clone(n),function(e,t){e&&e.__manager__===r&&u.call(n,t,1)});delete r.parent.views[r.selector]}},cleanViews:function(e){i.each(a.call([],e),function(e){e.unbind(),e.model instanceof n.Model&&e.model.off(null,null,e),e.collection instanceof n.Collection&&e.collection.off(null,null,e),e.cleanup&&e.cleanup.call(e)})},cache:function(e,t){return e in this._cache?this._cache[e]:null!=e&&null!=t?this._cache[e]=t:void 0},configure:function(e){i.extend(l.prototype.options,e),e.manage&&(n.View.prototype.manage=!0)},setupView:function(e,r){if(!e.__manager__){var o,s,u,c=n.LayoutManager.prototype,d=i.pick(e,t);i.defaults(e,{views:{},__manager__:{},_removeViews:l._removeViews,_removeView:l._removeView},l.prototype),r=e.options=i.defaults(r||{},e.options,c.options),u=i.pick(r,a.call(["events"],i.values(r.events))),i.extend(e,u),(d.render===l.prototype.render||d.render===n.View.prototype.render)&&delete d.render,i.extend(r,d),e._remove=n.View.prototype.remove,e._render=function(e,t){var n=this,i=n.__manager__,r=t.beforeRender;return i.hasRendered&&this._removeViews(),r&&r.call(this,this),this.trigger("beforeRender",this),e(this,t).render()},e.render=l.prototype.render,e.remove!==c.remove&&(e._remove=e.remove,e.remove=c.remove),o=r.views||e.views,i.keys(o).length&&(s=o,e.views={},e.setViews(s)),e.options.template?e.options.template=r.template:e.template&&(r.template=e.template,delete e.template)}}});n.Layout=n.LayoutView=n.LayoutManager=l,l.VERSION="0.7.1",n.View.prototype._configure=function(){var e=o.apply(this,arguments);return this.manage&&l.setupView(this),e},l.prototype.options={prefix:"",deferred:function(){return r.Deferred()},fetch:function(e){return i.template(r(e).html())},partial:function(e,t,n,i){var o=t?r(e).find(t):r(e);this[i?"append":"html"](o,n)},html:function(e,t){r(e).html(t)},append:function(e,t){r(e).append(t)},when:function(e){return r.when.apply(null,e)},render:function(e,t){return e(t)},contains:function(e,t){return r.contains(e,t)}},t=i.keys(l.prototype.options)}(this),define("backboneLayoutManager",function(){});var dateFormat=function(){var e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,i=function(e,t){for(e+="",t=t||2;t>e.length;)e="0"+e;return e};return function(r,o,s){var a=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(r)||/\d/.test(r)||(o=r,r=void 0),r=r?new Date(r):new Date,isNaN(r))throw SyntaxError("invalid date");o=(a.masks[o]||o||a.masks["default"])+"","UTC:"==o.slice(0,4)&&(o=o.slice(4),s=!0);var u=s?"getUTC":"get",l=r[u+"Date"](),c=r[u+"Day"](),d=r[u+"Month"](),f=r[u+"FullYear"](),h=r[u+"Hours"](),p=r[u+"Minutes"](),m=r[u+"Seconds"](),g=r[u+"Milliseconds"](),v=s?0:r.getTimezoneOffset(),y={d:l,dd:i(l),ddd:a.i18n.dayNames[c],dddd:a.i18n.dayNames[c+7],m:d+1,mm:i(d+1),mmm:a.i18n.monthNames[d],mmmm:a.i18n.monthNames[d+12],yy:(f+"").slice(2),yyyy:f,h:h%12||12,hh:i(h%12||12),H:h,HH:i(h),M:p,MM:i(p),s:m,ss:i(m),l:i(g,3),L:i(g>99?Math.round(g/10):g),t:12>h?"a":"p",tt:12>h?"am":"pm",T:12>h?"A":"P",TT:12>h?"AM":"PM",Z:s?"UTC":((r+"").match(t)||[""]).pop().replace(n,""),o:(v>0?"-":"+")+i(100*Math.floor(Math.abs(v)/60)+Math.abs(v)%60,4),S:["th","st","nd","rd"][l%10>3?0:(10!=l%100-l%10)*l%10]};return o.replace(e,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)};var strtotime=function(e,t){function n(e,t,n){var i=u[t];if(i!==void 0){var r=i-a.getDay();0===r?r=7*n:r>0&&"last"===e?r-=7:0>r&&"next"===e&&(r+=7),a.setDate(a.getDate()+r)}}function i(e){var t=e.split(" "),i=t[0],r=t[1].substring(0,3),o=/\d+/.test(i),s="ago"===t[2],u=("last"===i?-1:1)*(s?-1:1);if(o&&(u*=parseInt(i,10)),l.hasOwnProperty(r))return a["set"+l[r]](a["get"+l[r]]()+u);if("wee"===r)return a.setDate(a.getDate()+7*u);
if("next"===i||"last"===i)n(i,r,u);else if(!o)return!1;return!0}if(!e)return null;e=e.trim().replace(/\s{2,}/g," ").replace(/[\t\r\n]/g,"").toLowerCase();var r;if("now"===e)return null===t||isNaN(t)?0|(new Date).getTime()/1e3:0|t;if(!isNaN(parse=Date.parse(e)))return 0|parse/1e3;if("now"==e)return(new Date).getTime()/1e3;if(!isNaN(r=Date.parse(e)))return r/1e3;var o=e.match(/^(\d{2,4})-(\d{2})-(\d{2})(?:\s(\d{1,2}):(\d{2})(?::\d{2})?)?(?:\.(\d+)?)?$/);if(o){var s=o[1]>=0&&69>=o[1]?+o[1]+2e3:o[1];return new Date(s,parseInt(o[2],10)-1,o[3],o[4]||0,o[5]||0,o[6]||0,o[7]||0)/1e3}var a=t?new Date(1e3*t):new Date,u={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},l={yea:"FullYear",mon:"Month",day:"Date",hou:"Hours",min:"Minutes",sec:"Seconds"},c="([+-]?\\d+\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday)|(last|next)\\s(years?|months?|weeks?|days?|hours?|min|minutes?|sec|seconds?|sun\\.?|sunday|mon\\.?|monday|tue\\.?|tuesday|wed\\.?|wednesday|thu\\.?|thursday|fri\\.?|friday|sat\\.?|saturday))(\\sago)?";if(o=e.match(RegExp(c,"gi")),!o)return!1;for(var d=0,f=o.length;f>d;d++)if(!i(o[d]))return!1;return a.getTime()/1e3};Date.prototype.strtotime=function(e,t){return strtotime(e,t)},define("dateFormat",function(){}),function(e){var t,n={className:"autosizejs",append:"",callback:!1},i="hidden",r="border-box",o="lineHeight",s='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden;"/>',a=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],u="oninput",l="onpropertychange",c=e(s).data("autosize",!0)[0];c.style.lineHeight="99px","99px"===e(c).css(o)&&a.push(o),c.style.lineHeight="",e.fn.autosize=function(o){return o=e.extend({},n,o||{}),c.parentNode!==document.body&&e(document.body).append(c),this.each(function(){function n(){t=p,c.className=o.className,e.each(a,function(e,t){c.style[t]=m.css(t)})}function s(){var e,r,s;if(t!==p&&n(),!f){f=!0,c.value=p.value+o.append,c.style.overflowY=p.style.overflowY,s=parseInt(p.style.height,10),c.style.width=Math.max(m.width(),0)+"px",c.scrollTop=0,c.scrollTop=9e4,e=c.scrollTop;var a=parseInt(m.css("maxHeight"),10);a=a&&a>0?a:9e4,e>a?(e=a,r="scroll"):d>e&&(e=d),e+=g,p.style.overflowY=r||i,s!==e&&(p.style.height=e+"px",v&&o.callback.call(p)),setTimeout(function(){f=!1},1)}}var d,f,h,p=this,m=e(p),g=0,v=e.isFunction(o.callback);m.data("autosize")||((m.css("box-sizing")===r||m.css("-moz-box-sizing")===r||m.css("-webkit-box-sizing")===r)&&(g=m.outerHeight()-m.height()),d=Math.max(parseInt(m.css("minHeight"),10)-g,m.height()),h="none"===m.css("resize")||"vertical"===m.css("resize")?"none":"horizontal",m.css({overflow:i,overflowY:i,wordWrap:"break-word",resize:h}).data("autosize",!0),l in p?u in p?p[u]=p.onkeyup=s:p[l]=s:p[u]=s,e(window).on("resize",function(){f=!1,s()}),m.on("autosize",function(){f=!1,s()}),s())})}}(window.jQuery||window.Zepto),define("jqueryAutoTextArea",function(){}),define("app",["jquery","underscore","backbone","mustache","cnamplify","tools/pop-up-window","backboneLayoutManager","dateFormat","jqueryAutoTextArea"],function(e,t,n,i,r,o){var s=o.get("function"),a={root:"/",tempPrefix:"../templates/"},u=function(){throw Error('A "url" property or function must be specified')},l=function(e){for(var n in e)(""===e[n]||t.isUndefined(e[n]))&&delete e[n];return e},c=n.sync;return n.sync=function(i,o,a){var u=a.errorCallback;a=e.extend(!0,{},{beforeSend:function(e){e.setRequestHeader("token",r.cookie.get("cn_token"))},error:function(e){var n=[];switch(e.status){case 401:r.cookie.empty(),r.remove("Me"),n.push("Authorization Required.");break;case 403:n.push('403 Forbidden. You don\'t have permission to access the page on this server<br/> <a href="mailto:help@thecn.com" target="_blank">help@thecn.com</a>.');break;case 500:n.push('Please close this window and refresh the page. <br/> <a href="mailto:help@thecn.com" target="_blank">help@thecn.com</a>');break;default:n.push('Please close this window and refresh the page. <br/> <a href="mailto:help@thecn.com" target="_blank">help@thecn.com</a>')}if(u)u(n,o,e,a);else{var i="";t.each(n,function(e){i+=e+"<br />"}),s.alert(i,{autoClose:!1})}o.trigger("error",o,e,a)},complete:function(e,n){t.isFunction(a.completeCallback)&&a.completeCallback(e,n)}},a);var l=c.call(n,i,o,a);return l},n.Collection.prototype.fetch=function(e){e=e?t.clone(e):{},void 0===e.parse&&(e.parse=!0);var i=this,r=e.resultTrue,o=e.resultFalse;return e.success=function(t,n,s){t.result&&t.data.length>0?(i[e.add?"add":"reset"](i.parse(t,s),e),e.add||e.silent||i.trigger("fetch"),r&&r(i,t)):o&&(t.errors.length||(t.result?t.errors.push(["No Results"]):t.errors.push(["Loading failed, please refresh the page."])),o(t.errors,t))},(this.sync||n.sync).call(this,"read",this,e)},n.Collection.prototype.setUrlParam=function(e){this.urlParam=l(e)},n.Collection.prototype.addUrlParam=function(e){this.setUrlParam(t.extend({},this.urlParam,e))},n.Collection.prototype.url=function(){var n=t.result(this,"urlRoot")||u(),i=function(){return"/"===n.charAt(n.length-1)?"":"/"},r=e.param(e.isPlainObject(this.urlParam)?this.urlParam:{});return window.CN_API_HOST+n+i()+(r.length>0?"?"+r:"")},n.Collection.prototype.parse=function(e){return e.data},n.Model.prototype.initialize=function(){this.setDefaults(),this.init()},n.Model.prototype.init=function(){},n.Model.prototype.setDefaults=function(){this.set(t.result(this,"initDefaults"),{silent:!0}),this.set(t.result(this,"initDefaults_"),{silent:!0})},n.Model.prototype.initDefaults=function(){return{}},n.Model.prototype.save=function(e,i,r){var o,a;if(t.isObject(e)||null==e?(o=e,r=i):(o={},o[e]=i),r=r?t.clone(r):{},r.wait){if(!this._validate(o,r))return!1;a=t.clone(this.attributes)}var u=t.extend({},r,{silent:!0});if(o&&!this.set(this.parse(o),r.wait?u:r))return!1;var l=this,c=r.resultTrue,d=t.isFunction(r.resultFalse)?r.resultFalse:function(e){var n="";t.each(e,function(e){n+=e+"<br />"}),n.length||(n='Please close this window and refresh the page. <br/> <a href="mailto:help@thecn.com" target="_blank">help@thecn.com</a>'),s.alert(n)};r.success=function(e,n,i){if(e.result){var s=l.parse(e.data,i);r.wait&&(delete r.wait,s=t.extend(o||{},s)),l.set(s,r)&&((t.isUndefined(r.passSet)||!r.passSet)&&l.setDefaults(),c?c(l,e):l.trigger("sync",l,e,r))}else d&&d(e.errors,e)};var f=r.action?r.action:this.isNew()?"create":"update",h=(this.sync||n.sync).call(this,f,this,r);return r.wait&&this.set(a,u),h},n.Model.prototype.addUrlParam=function(e){this.setUrlParam(t.extend({},this.urlParam,e))},n.Model.prototype.setUrlParam=function(e){this.urlParam=l(e)},n.Model.prototype.fetch=function(e){e=e?t.clone(e):{};var i=this,r=e.resultTrue,o=e.resultFalse;return e.success=function(t,n,s){t&&t.result?i.set(i.parse(t.data,s),e)&&(i.setDefaults(),r&&r(i,t)):o&&o(t.errors,t)},(this.sync||n.sync).call(this,"read",this,e)},n.Model.prototype.url=function(){var n=t.result(this,"urlRoot")||t.result(this.collection,"url")||u(),i=function(){return"/"===n.charAt(n.length-1)?"":"/"},r=e.param(e.isPlainObject(this.urlParam)?this.urlParam:{});return window.CN_API_HOST+(this.isNew()?n:n+i()+encodeURIComponent(this.id))+(r.length>0?"?"+r:"")},n.Model.prototype.destroy=function(e){e=e?t.clone(e):{};var i=this,r=e.resultTrue,o=t.isFunction(e.resultFalse)?e.resultFalse:function(e){var n="";t.each(e,function(e){n+=e+"<br />"}),n.length||(n='Please close this window and refresh the page. <br/> <a href="mailto:help@thecn.com" target="_blank">help@thecn.com</a>'),s.alert(n)},a=function(){i.trigger("destroy",i,i.collection,e)};if(this.isNew())return a(),!1;e.success=function(t){t.result?(e.wait&&a(),r?r(i,t):i.trigger("sync",i,t,e)):o&&o(t.errors,t)};var u=(this.sync||n.sync).call(this,"delete",this,e);return e.wait||a(),u},n.Model.prototype.parse=function(t){return e.extend(!0,{},this.toJSON(),t)},String.prototype.ucfirst=function(){return"string"===e.type(this)?this.replace(/\b\w+\b/g,function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}):this},n.LayoutManager.configure({manage:!0,render:function(e,t){return t=t||{},i.to_html(e,t)},fetch:function(e){this.async()(e)}}),t.extend(a,{useLayout:function(e){if(this.layout&&this.layout.options.template===e.template)return this.layout;this.layout&&this.layout.$el.empty();var i=new n.Layout(t.extend({el:"#wrapper"},e));return this.layout=i,i}},n.Events)}),define("tools/back-to-top",["jquery"],function(e){var t={id:"back_to_top",btnIcon:"&uarr; Top",position:{right:10,bottom:10},limitTop:1e3},n={init:function(){var n=this;e(document||window).scroll(function(){n.insert(function(){t.limitTop<e(this).scrollTop()?e("#"+t.id).fadeIn("normal"):0==e(this).scrollTop()&&e("#"+t.id).fadeOut("normal")})}),e(document).on("click","#"+t.id,function(){n.run(function(){e(this).hide()})})},insert:function(n){e("#"+t.id).length||(e("#wrapper").append(this.getTpl()),this.setPosition()),_.isFunction(n)&&n()},getTpl:function(){return'<a onclick="" href="javascript:;" id="'+t.id+'" style="font-size:14px;">'+t.btnIcon+"</a>"},setPosition:function(){e("#"+t.id).css({right:t.position.right,bottom:t.position.bottom,position:"fixed","z-index":99})},run:function(t){if(5>e(window).scrollTop()){if(_.isFunction(t))return t()}else e("html, body").animate({scrollTop:0},1e3,function(){return _.isFunction(t)?t():void 0})}};return{init:function(e){return"object"==typeof e&&(t.position.right=e.right,t.position.bottom=e.bottom,t.limitTop=e.limitTop),n.init(),this},run:n.run}}),define("router",["underscore","backbone","tools/back-to-top"],function(e,t,n){return t.Router.extend({routes:{"":"siteView",site:"siteView","site/register/email/:email/invited_by_user_id/:id":"inviteFriendsRegisterView","site/password/reset/email_id/:emailId/code/:code":"resetPasswordView","site/register/course_id/:courseId/email_id/:emailId/email/:email":"inviteFriendsRegisterWithCourseView","site/register/conexus_id/:conexusId/email_id/:emailId/email/:email":"inviteFriendsRegisterWithConexusView",user:"userHomeView","user/courses":"userCourses","user/conexus":"userConexus","user/social/:type":"userSocial","user/socail/personal-list/:id":"userPersonalList","user/settings":"userEmailSettingsView","user/edit":"userEditView","user/password":"userUpdatePassword","user/logout":"userLogout","user/email":"userEmailListView","user/email/:id":"userEmailView","user/notification":"userNotificationListView","user/notification/:id":"userNotificationView","user/verify/:code":"verifyView","user/auto_login/:userId/:loginKey":"userAutoLoginView","user/auto_login/:userId/:loginKey/redirect_to/:redirectTo":"userAutoLoginView","user/auto_login/:userId/:loginKey/redirect_to/":"userAutoLoginView","user/contents/:id":"userGroupContent","user/chat":"userChatView",search:"search","search/:type":"search","search/:type/keyword/":"search","search/:type/keyword/:keyword":"search","course/create":"courseCreateView","course/syllabus/:number":"courseSyllabusView","course/about/:number":"courseAboutView","course/about/edit/:number":"courseAboutEditView","course/roster/:number":"courseRosterView","course/dropbox/:number":"courseDropBoxView","course/gradebook/:number":"courseGradesView","course/content/:type/:number":"courseContentsView","course/page/:number":"courseIntroduceView","conexus/create":"conexusCreateView","conexus/about/:number":"conexusAboutView","conexus/about/edit/:number":"conexusAboutEditView","conexus/edit/:number":"conexusUpdateView","conexus/roster/:number":"conexusRosterView","conexus/content/:type/:number":"conexusContentsView","content/remember":"contentRememberView","content/remember/:number":"contentRememberView","content/view/:id":"contentView","err/:number":"errorView","*actions":"defaultView"},initialize:function(){this.route(/^(\w{1,5}\d+)$/,"userView"),this.route(/^(\d[1-9]\d+)$/,"courseView"),this.route(/^(00\d+)$/,"conexusView"),this.route(/^(MOOC\d+)$/i,"courseCustomUrlView"),this.route(/^course\/edit\/([0-9]+)(?:\?\w+=)*(.+)*/,"courseUpdateView")},go:function(){var i=this,r=e.toArray(arguments).join("/");t.history.getFragment()===r&&(t.history.fragment=null);var o=function(){return i.setDocumentTitle(),$("#wrapper").append('<img src="'+window.STATIC_FILE_HOST+'img/com/frontend/loading/circle.gif" style="position: fixed; z-index: 9; bottom: 15px; left: 15px;" />'),i.navigate(r,{trigger:!0})};n.run(o)},setDocumentTitle:function(e){document.title=(e?e+" - ":"")+"CourseNetworking"}})}),define("tools/string-help",[],function(){return{addCommas:function(e){e+="",x=e.split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var t=/(\d+)(\d{3})/;t.test(x1);)x1=x1.replace(t,"$1,$2");return x1+x2}}}),define("tools/regs",[],function(){return{rules:function(e){var t={url:/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,youtubeUrl:/(youtube\.com|youtu\.be)\/(watch\?v=|v\/|u\/|embed\/?)?(videoseries\?list=(.*)|[\w-]{11}|\?listType=(.*)&list=(.*)).*/i,youkuUrl:/(v.youku.com)\/(v_show)\/(id\_(\w+)[=.])/,courseId:/^(\d[1-9]\d+)$/,conexusId:/^(00\d+)$/,facebook:/^www.facebook.com\/(\w)+/,twitter:/^@(\w)+/};return t[e]!==void 0?t[e]:(cn.error("Type is undefined."),!1)},check:function(e,t){return this.rules(e)?this.rules(e).test(t):!1}}}),define("modules/user/user",["jquery","underscore","backbone","tools/string-help","tools/regs"],function(e,t,n,i,r){return n.Model.extend({urlRoot:"api/user/",defaults:function(){return t.extend({avatar:{id:"",view_url:""},country:{id:"",name:"",flag_url:"",short_name:""},auth_group_ids:[],cn_number:"",fullname:"",first_name:"",last_name:"",password:"",count:{colleague:0,following:0,follower:0,course:0,conexus:0},profile:{current_work:{company:"",position:""},interests:[],about:"",birthday:"",country_id:"",current_city_id:"",fackbook_address:"",gender:"",home_town:"",origin_country_id:"",other_fullname:"",other_languages:{},position:{position:"",school_name:"",type:"",web_address:""},primary_email:"",secondary_email:"",schools:[],tag_line:[],time_zone_id:"",twitter_name:"",website:"",works:[],zip_code:"",type:"",school_name:"",web_address:""},courses:[],conexuses:[],auth_groups:[],score:{total_seeds:0,total:0},relations:{is_my_colleague_user:!1,is_my_follower_user:!1,is_my_following_user:!1,is_my_pending_colleague_user:!1,is_myself:!0},visible_settings:{}},this.defaults_())},defaults_:function(){},init:function(){this.init_()},init_:function(){},initDefaults:function(){var n=this,r=n.getAuthGroupIds(),o=n.get("score");o=t.extend(o,{display_total:i.addCommas(o.total)});var s={score:o},a=n.get("visible_settings");t.isEmpty(a)&&(a={about:"public",birthday:"only_me",country_id:"public",current_city_id:"public",current_work:"public",facebook_address:"public",gender:"public",interests:"public",origin_country_id:"public",other_languages:"public",position:"public",primary_email:"only_me",primary_language:"public",schools:"public",secondary_email:"only_me",tag_line:"public",time_zone_id:"public",twitter_name:"public",website:"public",works:"public",zip_code:"public"});var u=this.get("relations"),l=this.get("count");return t.extend({position_string:n.displayPosition(n.get("profile").position),count_groups:n.get("auth_groups").length,display_interests:n.arr2Str(n.get("profile").interests),display_tag_line:n.arr2Str(n.get("profile").tag_line),display_first_schools:n.getDisplayFirstSchool(),display_first_works:n.getDisplayFirstWork(),display_birthday_month:n.getBirthdayDate().format("m"),display_birthday_date:n.getBirthdayDate().format("d"),display_birthday_year:n.getBirthdayDate().format("yyyy"),display_gender:n.getDisplayGender(),display_other_lang:n.getDisplayOtherLang(),is_more_other_lang:n.getOtherLangCount()>1,auth_group_ids:r,display_is_my_colleague_user:u.is_my_colleague_user,display_is_my_follower_user:u.is_my_follower_user,display_is_my_following_user:u.is_my_following_user,display_is_my_pending_colleague_user:u.is_my_pending_colleague_user,display_is_myself:u.is_myself,display_follower_count:l.follower,display_colleague_count:l.colleague,has_schools:e(n.getDisplaySchools()).length>0,display_schools:n.getDisplaySchools(),has_works:e(n.getDisplayWorks()).length>0,display_works:n.getDisplayWorks(),display_position:n.getDisplayPosition(),display_current_work:n.getDisplayCurrentWork(),display_format_birthday:n.getDisplayFormatBirthday(),visible_settings:a},s)},getDisplayFormatBirthday:function(){return this.get("profile").birthday?this.getBirthdayDate().format("mmm dd, yyyy"):""},getBirthdayDate:function(){return new Date(1e3*parseInt(this.get("profile").birthday?this.get("profile").birthday:(new Date).getTime()/1e3))},getDisplayPosition:function(){var t={};return this.get("profile").position&&this.get("profile").position.position&&e.trim(this.get("profile").position.position).length&&this.get("profile").position.school_name&&e.trim(this.get("profile").position.school_name).length&&(t=e.extend({},this.get("profile").position),t.position=t.position.ucfirst(),t.school_name=t.school_name.ucfirst()),e.isEmptyObject(t)?!1:t},getDisplayCurrentWork:function(){var t={};return this.get("profile").current_work&&this.get("profile").current_work.position&&e.trim(this.get("profile").current_work.position).length&&this.get("profile").current_work.company&&e.trim(this.get("profile").current_work.company).length&&(t=e.extend({},this.get("profile").current_work),t.position=t.position.ucfirst(),t.company=t.company.ucfirst()),e.isEmptyObject(t)?!1:t},getDisplaySchools:function(){var t=[];if(this.get("profile").schools.length>0){var n=this.get("profile").schools;for(var i in n){var r=e.extend({},this.get("profile").schools[i]);r.type=r.type&&r.type.length>0?r.type.ucfirst():"",r.name=r.name&&r.name.length>0?r.name.ucfirst():"",e.trim(r.type).length&&e.trim(r.name).length&&t.push(r)}}return t},getDisplayWorks:function(){var t=[];if(this.get("profile").works.length>0){var n=this.get("profile").works;for(var i in n){var r=e.extend({},this.get("profile").works[i]);r.company=r.company&&r.company.length>0?r.company.ucfirst():"",r.position=r.position&&r.position.length>0?r.position.ucfirst():"",e.trim(r.company).length&&e.trim(r.position).length&&t.push(r)}}return t},getOtherLangCount:function(){var e=0;if(this.get("profile").other_languages){var t=this.get("profile").other_languages;for(var n in t)e++}return e},getDisplayOtherLang:function(){var e="";if(this.get("profile").other_languages){var t=this.get("profile").other_languages;for(var n in t)e+=t[n]+", "}return e.substr(0,e.lastIndexOf(","))},getDisplayFirstSchool:function(){var e={name:"",type:"",web_address:""};return this.getSchools().length?this.getSchools().slice(0,1)[0]:e},getDisplayFirstWork:function(){var e={company:"",position:""};return this.getWorks().length?this.getWorks().slice(0,1)[0]:e},getDisplayGender:function(){var e=this.get("profile").gender;return t.isString(e)&&"prefer"!==e?e.ucfirst():""},getAuthGroupIds:function(){var e=this.get("auth_groups"),n=[];return e.length>0&&t.each(e,function(e){n.push(e.id)}),n},getSchools:function(){var n=this.get("profile").schools;return"object"===e.type(n)&&(n=t.values(n)),n?n:[]},getWorks:function(){var n=this.get("profile").works;return"object"===e.type(n)&&(n=t.values(n)),n?n:[]},deleted:function(){var e=this;this.destroy({resultTrue:function(){e.view.remove()}})},arr2Str:function(t){return"array"===e.type(t)&&t.length>0?t.join(", "):""},displayPosition:function(e){return t.isObject(e)&&t.has(e,"position")?"student"===e.position||"instructor"===e.position?e.position.ucfirst()+(t.isString(e.school_name)&&e.school_name>0?" at "+e.school_name:""):t.isString(e.type)&&e.type.length>0?e.type:"":""},getCountByType:function(e){var t=this.get("count");return t?t[e]?t[e]:0:0},validateRegister:function(){this.attributes;var e=[],t=this.validateFullName();t&&e.push(t);var n=this.validateEmail();n&&e.push(n);var i=this.validatePassword();return i&&e.push(i),{errors:e,result:!e.length}},validateFullName:function(){var t=e.trim(this.get("fullname")),n=t.split(" ");if(2>n.length)return"Please enter your first and last name.";for(var i in n)if(3>n.length){if(1>=n[i].length)return"Full name requires two characters for both first and last name.";if(!/^[A-Za-z]+$/.test(n[i]))return"Only English letters are accepted, please remove invalid characters."}else if(1===i){if(!/^[A-Za-z]+$/.test(n[i])&&!/^[A-Za-z]+\.$/.test(n[i]))return"Only English letters are accepted, please remove invalid characters.(Allow abbreviation of the second word."}else{if(1>=n[i].length)return"Full name requires two characters for both first and last name.";if(!/^[A-Za-z]+$/.test(n[i]))return"Only English letters are accepted, please remove invalid characters."}},validateEmail:function(){var e=this.get("email");return r.check("email",e)?void 0:"Please enter a valid email address."},validatePassword:function(){var e=this.get("password");return t.isUndefined(e)||6>e.length?"Passwords must be at least 6 characters long.":void 0}})}),define("modules/message-system/message-count",["jquery","underscore","backbone"],function(e,t,n){return n.Model.extend({defaults:function(){return t.extend({type:"",number:0})},add:function(e){var t=this.get("number");this.set({number:t+e})},sub:function(e){var t=this.get("number"),n=parseInt(t,10)-parseInt(e,10);n>=0?this.set({number:n}):cn.error("Number is invalid.")}})}),define("modules/message-system/message-count-chat",["jquery","underscore","modules/message-system/message-count"],function(e,t,n){var i=n.extend({initialize:function(){this.set({type:"chat"})}});return new i}),define("modules/message-system/message-count-email",["jquery","underscore","modules/message-system/message-count"],function(e,t,n){var i=n.extend({initialize:function(){this.set({type:"email"})}});return new i}),define("modules/message-system/message-count-notification",["jquery","underscore","modules/message-system/message-count"],function(e,t,n){var i=n.extend({initialize:function(){this.set({type:"notification"})}});return new i}),define("modules/message-system/message-count-request",["jquery","underscore","modules/message-system/message-count"],function(e,t,n){var i=n.extend({initialize:function(){this.set({type:"request"})}});return new i}),define("modules/user-verification-email",["jquery","underscore","backbone"],function(e,t,n){var i=n.Model.extend({urlRoot:"api/user_verification_email/"});return i}),define("text!templates/common/pop-up-window/user-not-verify.html",[],function(){return'<div class="head">\r\n    <h4>Message</h4>\r\n</div>\r\n<div class="main">\r\n    <div class="anar-explanation-box-body block_resend_verify_email_message">\r\n        {{^resend}}\r\n        <p>\r\n            You must activate your account before you continue. Please check your email and click on the activation link.\r\n        </p>\r\n        <p>\r\n            <a class="resend_verify_email always_allow" href="javascript:;">Click here</a> to resend activation email.\r\n        </p>\r\n        <p>\r\n            If you have questions, send email to <a href="mailto:help@thecn.com">help@thecn.com</a>.\r\n        </p>\r\n        {{/resend}}\r\n        {{#resend}}\r\n        <p>\r\n            Your verification email has been sent. Please check.\r\n        </p>\r\n        {{/resend}}\r\n    </div>\r\n</div>'}),define("views/common/pop-up-window/user-not-verify",["jquery","underscore","backbone","tools/pop-up-window","modules/user-verification-email","text!templates/common/pop-up-window/user-not-verify.html"],function(e,t,n,i,r,o){var s=!1;return i.get("view").extend({className:"pop-up-window block-window-user-not-verify",template:o,events:{"click .resend_verify_email":"resendVerifyEmail"},initialize:function(){this.model=new r},serialize:function(){return{resend:s}},resendVerifyEmail:function(){this.model.save({},{resultTrue:function(){s=!0,i.get("function").alert("Your verification email has been sent. Please check.")}})}})}),define("modules/me",["jquery","underscore","backbone","modules/user/user","tools/pop-up-window","modules/message-system/message-count-chat","modules/message-system/message-count-email","modules/message-system/message-count-notification","modules/message-system/message-count-request","views/common/pop-up-window/user-not-verify"],function(e,t,n,i,r,o,s,a,u,l){cn.log(" -- load me module -- ");var c=r.get("function"),d=!1,f={},h=!1,p={request:u,email:s,notification:a,chat:o},m={request:"new_colleague_request",email:"new_email",notification:"new_notification",chat:"new_chat"};return i.extend({urlRoot:"api/me/",urlParam:{with_user_score:1,with_user_profile:1,with_user_auth_groups:1,with_user_count:1,with_user_country:1},init_:function(){this.set(f)},sync:function(i,r,o){var s=this;return s.has("id")&&s.unset("id"),o.complete=function(n){if(n&&200===n.status&&4===n.readyState){var i=e.parseJSON(n.responseText);if(i&&i.data&&i.result){if(f.id!=i.data.id&&(f={}),f=e.extend(!0,{},f,i.data),i.data.profile&&(f.profile=i.data.profile),r.set(f),r.setDefaults(),99==f.status&&!d){d=!0;var s=setInterval(function(){t.isObject(f)&&99==f.status?e('button:not(#delete, .delete, .cancel, .always_allow), input:not(.always_allow), a[href="javascript:;"]:not(.fancybox-close, .close_box, .always_allow)').click(function(t){return d?(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e(".block_float_profile_card").remove(),c.open((new l).render().view.el),!1):void 0}):(d=!1,clearInterval(s))},1e3)}if(window.CN_CONFIG.nodeApps.enable&&!h&&require(["views/node-apps/init"],function(e){cn.log("-- me nowjs require --"),h=!0,cn.log("-- me nowjs run --"),e.run()}),f){var a=f.count?f.count:{};for(var s in p){var u=m[s];p.hasOwnProperty(s)&&a[u]&&p[s].set({number:a[u]})}}}else cn.error("fetch me error")}t.isFunction(o.completeCallback)&&o.completeCallback()},n.sync(i,r,o)},clearMeMemory:function(){f={},h=!1,window.CN_CONFIG.nodeApps.enable&&require(["views/node-apps/init"],function(e){cn.log("-- clear cache --"),e.clearCache()})}})}),define("tools/auth-tool",["jquery","underscore","cnamplify","modules/me"],function(e,t,n,i){return{url:"api/auth/",create:function(i,r,o){var s=this;t.has(i,"remember")||(i=e.extend({},{remember:1},i)),this.clearLocalStorage(function(){e.ajax({type:"GET",url:window.CN_API_HOST+s.url+"?v="+(new Date).getTime(),data:{action:"login"},dataType:"json",beforeSend:function(e){e.setRequestHeader("username",i.username),e.setRequestHeader("password",i.password),e.setRequestHeader("remember",i.remember)},success:function(e){if(e.result)if(t.has(e.data,"token")){1==i.remember?n.cookie.set("cn_token",e.data.token,{expires:30,path:"/"}):n.cookie.set("cn_token",e.data.token,{path:"/"});var s=i.remember?"on":"off";n.cookie.set("cn_remember",s,{expires:30,path:"/"}),r&&r()}else o(),cn.error("Token is not available.");else o(e.errors)},error:function(e,t){cn.error(t),o()}})})},deleted:function(r){var o=this,s=n.cookie.get("cn_token");t.isUndefined(s)||e.ajax({type:"GET",url:window.CN_API_HOST+o.url+"?v="+(new Date).getTime(),data:{action:"logout"},dataType:"json",beforeSend:function(e){e.setRequestHeader("token",s)},complete:function(){}}),n.cookie.set("cn_token","",{path:"/"}),n.cookie.remove("cn_token"),(new i).clearMeMemory();var a=1,u=function(){if(a>10)return!1;var e=n.cookie.get("cn_token");"string"==typeof e&&e.length>10?(a++,setTimeout(function(){o.clearLocalStorage(u)},500)):(r(),setTimeout(function(){window.location.reload()},100))};u()},autoLogin:function(i,r,o){var s=this;this.clearLocalStorage(function(){e.ajax({type:"GET",url:window.CN_API_HOST+s.url+"?v="+(new Date).getTime(),data:{action:"login_by_login_key"},dataType:"json",beforeSend:function(e){e.setRequestHeader("user-id",i.user_id),e.setRequestHeader("login-key",i.login_key),e.setRequestHeader("remember",0)},success:function(e){e.result?t.has(e.data,"token")?(n.cookie.set("cn_token",e.data.token,{path:"/"}),r()):o():o(e.errors)},error:function(){o()}})})},hasToken:function(e,r,o){r=t.isFunction(r)?r:function(){};var s=n.cookie.get("cn_token");if(t.isString(s)&&s.length>20){var a=new i;"object"==typeof o&&a.addUrlParam(o),a.fetch({resultTrue:function(){e()},resultFalse:function(){r()}})}else r()},clearLocalStorage:function(e){n.cookie.empty(),(new i).clearMeMemory(),"function"==typeof e&&e()}}}),define("controller",["jquery","router","tools/auth-tool"],function(e,t,n){var i=new t,r={with_course_instructors:1,with_course_instructional_users:1,with_course_school:1,with_course_country:1,with_course_user_content_count:1,with_course_content_count:1,with_course_user_score:1,with_course_count:1},o={with_conexus_country:1,with_conexus_moderators:1,with_conexus_user_score:1,with_conexus_content_count:1,with_conexus_user_content_count:1,with_conexus_count:1},s=function(e){require(["views/conexus/home/controller"],function(t){t(i,e,o)})},a=function(e){require(["views/site/conexus/controller"],function(t){t(i,e)})},u=function(e,t){require(["views/course/home/controller"],function(n){n(i,e,t,r)})},l=function(e,t){require(["views/site/course/controller"],function(n){n(i,e,t)})},c=function(){i.setErrorView(401)};return i.setDefaultView=function(t){var r=/^([a-z])+((\.|\-)?([a-z])+)*$/i;r.test(t)?e.ajax({url:window.CN_API_HOST+"api/conexus_custom_url/"+t,dataType:"json",success:function(e){if(e.result){var t=e.data.conexus_id;n.hasToken(function(){s(t)},function(){a(t)})}else i.setErrorView(404)},error:function(){i.setErrorView(404)}}):i.setErrorView(404)},i.setErrorView=function(t,n){var r=["404","401","403",404,401,403];-1===e.inArray(t,r)&&(t=404),i.setDocumentTitle(t),require(["views/error/index"],function(e){e({number:t,url:Backbone.history.fragment,string:n||""})})},i.on("route:siteView",function(){n.hasToken(function(){i.go("user")},function(){require(["views/site/index/home"],function(e){i.setDocumentTitle("Site"),e()
})})}),i.on("route:inviteFriendsRegisterWithCourseView",function(e,t,r){n.hasToken(function(){i.go("user")},function(){require(["views/site/index/home"],function(n){i.setDocumentTitle("Register"),n({data:{course_id:e,email_id:t,email:r},viewController:{showClubFileds:!1}})})})}),i.on("route:inviteFriendsRegisterWithConexusView",function(e,t,r){n.hasToken(function(){i.go("user")},function(){require(["views/site/index/home"],function(n){i.setDocumentTitle("Register"),n({data:{conexus_id:e,email_id:t,email:r},viewController:{showClubFileds:!1}})})})}),i.on("route:inviteFriendsRegisterView",function(e,t){n.hasToken(function(){i.go("user")},function(){require(["views/site/index/home"],function(n){i.setDocumentTitle("Register"),n({data:{email:e,invited_by_user_id:t}})})})}),i.on("route:resetPasswordView",function(e,t){n.hasToken(function(){i.go("user")},function(){require(["views/site/reset-password/index"],function(n){i.setDocumentTitle("Reset Password"),n({data:{email_id:e,email_verification_code:t}})})})}),i.on("route:search",function(e,t){n.hasToken(function(){var n={type:e,keyword:t};require(["views/search/controller"],function(e){e(i,n)})},c)}),i.on("route:courseAboutView",function(e){n.hasToken(function(){require(["views/course/about/controller"],function(t){t(i,e,r)})},c)}),i.on("route:courseAboutEditView",function(e){n.hasToken(function(){require(["views/course/about/update/controller"],function(t){t(i,e,r)})},c)}),i.on("route:courseCreateView",function(){n.hasToken(function(){require(["views/course/create/index"],function(e){i.setDocumentTitle("Create Course"),e()})},c)}),i.on("route:courseUpdateView",function(e,t){n.hasToken(function(){require(["views/course/update/controller"],function(n){n(i,e,t)})},c)}),i.on("route:courseSyllabusView",function(e){n.hasToken(function(){require(["views/course/syllabus/controller"],function(t){t(i,e,r)})},c)}),i.on("route:courseRosterView",function(e){n.hasToken(function(){require(["views/course/roster/controller"],function(t){t(i,e,r)})},c)}),i.on("route:courseView",function(e){n.hasToken(function(){u("CourseNumber",e)},function(){l("CourseNumber",e)})}),i.on("route:courseCustomUrlView",function(e){n.hasToken(function(){u("CourseCustomUrl",e)},function(){l("CourseCustomUrl",e)})}),i.on("route:courseDropBoxView",function(e){n.hasToken(function(){require(["views/course/dropbox/controller"],function(t){t(i,e,r)})},c)}),i.on("route:courseGradesView",function(e){n.hasToken(function(){require(["views/course/grades/controller"],function(t){t(i,e,r)})},c)}),i.on("route:courseContentsView",function(e,t){var o=function(){require(["views/course/content/controller"],function(n){n(i,e,t,r)})};n.hasToken(o,c)}),i.on("route:courseIntroduceView",function(e){var t=function(){require(["views/course/introduce/controller"],function(t){t(i,e)})};n.hasToken(t,c)}),i.on("route:conexusAboutView",function(e){n.hasToken(function(){require(["views/conexus/about/controller"],function(t){t(i,e,o)})},c)}),i.on("route:conexusAboutEditView",function(e){n.hasToken(function(){require(["views/conexus/about/update/controller"],function(t){t(i,e,o)})},c)}),i.on("route:conexusCreateView",function(){n.hasToken(function(){require(["views/conexus/create/index"],function(e){i.setDocumentTitle("Create Conexus"),e()})},c)}),i.on("route:conexusUpdateView",function(e){n.hasToken(function(){require(["views/conexus/update/controller"],function(t){t(i,e)})},c)}),i.on("route:conexusView",function(e){n.hasToken(function(){s(e)},function(){a(e)})}),i.on("route:conexusRosterView",function(e){n.hasToken(function(){require(["views/conexus/roster/controller"],function(t){t(i,e,o)})},c)}),i.on("route:conexusContentsView",function(e,t){var r=function(){require(["views/conexus/content/controller"],function(n){n(i,e,t,o)})};n.hasToken(r,c)}),i.on("route:userView",function(e){n.hasToken(function(){require(["views/user/profile/controller"],function(t){t(i,e)})},function(){require(["views/site/user/controller"],function(t){t(i,e)})})}),i.on("route:userHomeView",function(){n.hasToken(function(){require(["views/user/home/index"],function(e){i.setDocumentTitle("Home"),e()})},c)}),i.on("route:userGroupContent",function(e){n.hasToken(function(){require(["views/user/group-content/controller"],function(t){t(i,e)})},c)}),i.on("route:userAutoLoginView",function(t,r,o){i.setDocumentTitle("Auto login"),n.autoLogin({user_id:t,login_key:r},function(){"undefined"!==e.type(o)?i.go(o):i.go("user")},c)}),i.on("route:userEmailListView",function(){n.hasToken(function(){require(["views/user/email/index"],function(e){i.setDocumentTitle("My Emails"),e()})},c)}),i.on("route:userEmailView",function(e){n.hasToken(function(){require(["views/user/email/single/controller"],function(t){t(i,e)})},c)}),i.on("route:userNotificationListView",function(){n.hasToken(function(){require(["views/user/notification/controller"],function(e){e(i)})},c)}),i.on("route:userNotificationView",function(e){n.hasToken(function(){require(["views/user/notification/single/controller"],function(t){t(i,e)})},c)}),i.on("route:userSocial",function(e){n.hasToken(function(){require(["views/user/social/controller"],function(t){t(i,e)})},c)}),i.on("route:userPersonalList",function(e){n.hasToken(function(){require(["views/user/social/personal-list/index"],function(t){i.setDocumentTitle("My Personal Network"),t({data:{auth_group_id:e}})})},c)}),i.on("route:userEditView",function(){n.hasToken(function(){require(["views/user/edit-profile/index"],function(e){i.setDocumentTitle("Edit Profile"),e()})},c)}),i.on("route:userEmailSettingsView",function(){n.hasToken(function(){require(["views/user/email-settings/controller"],function(e){e(i)})},c)}),i.on("route:userUpdatePassword",function(){n.hasToken(function(){require(["views/user/update-password/index"],function(e){i.setDocumentTitle("Update Password"),e()})},c)}),i.on("route:userCourses",function(){n.hasToken(function(){require(["views/user/club/courses/controller"],function(e){e(i)})},c)}),i.on("route:userConexus",function(){n.hasToken(function(){require(["views/user/club/conexus/controller"],function(e){e(i)})},c)}),i.on("route:userLogout",function(){i.setDocumentTitle("Logout"),n.deleted(function(){i.go("site")})}),i.on("route:verifyView",function(e){require(["views/user/verify/controller"],function(t){t(i,e)})}),i.on("route:contentRememberView",function(e){n.hasToken(function(){require(["views/user/remember-content/controller"],function(t){t(i,e)})},c)}),i.on("route:contentView",function(e){n.hasToken(function(){require(["views/user/content/controller"],function(t){t(i,e)})},c)}),i.on("route:userChatView",function(){n.hasToken(function(){require(["views/user/chat/controller"],function(e){e(i)})},c)}),i.on("route:errorView",i.setErrorView),i.on("route:defaultView",i.setDefaultView),i}),define("tools/url-helper",["jquery"],function(){var e={};return e.getUrl=function(e){return e?e:window.location.href},e.getHashes=function(e){var t=this.getUrl(e);return t.slice(t.indexOf("?")+1).split("&")},e.removeUrlVars=function(e,t){var n=this.getUrl(t);for(var i in e)n=this.removeUrlVar(e[i],n);return n},e.removeUrlVar=function(e,t){var n=this.getUrl(t);if(n.indexOf("?")>0){for(var i=n.slice(0,n.indexOf("?")),r=this.getHashes(t),o="",s=0;r.length>s;s++){var a=r[s].split("=");e!=a[0]&&e!=r[s]&&0!=r[s].length&&(o+=r[s]+"&")}return o.length>0?i+"?"+o:i}return n},e.getUrlVars=function(e){for(var t,n={},i=this.getHashes(e),r=0;i.length>r;r++)t=i[r].split("="),n[t[0]]=t[1];return n},e.getUrlVar=function(e,t){var n=this.getUrlVars(t)[e];return n?n:""},e}),define("modules/user/user-following",["jquery","underscore","modules/user/user"],function(e,t,n){return n.extend({urlRoot:"api/user_following/"})}),define("modules/user/user-colleague",["jquery","underscore","modules/user/user"],function(e,t,n){return n.extend({urlRoot:"api/user_colleague/"})}),define("tools/view/user-relation-manager",["jquery","underscore","modules/user/user-following","modules/user/user-colleague"],function(e,t,n,i){return function(){return{addColleague:function(e){var t=new i;t.save({colleague_user_id:e.get("id")},{resultTrue:function(){e.set({display_is_my_pending_colleague_user:!0})}})},removeColleague:function(e){var t=new i({id:e.get("id")});t.destroy({resultTrue:function(){e.set({display_is_my_colleague_user:!1,display_colleague_count:e.get("display_colleague_count")-1})}})},addFollowing:function(e){var t=new n;t.save({follow_user_id:e.get("id")},{resultTrue:function(){e.set({display_is_my_following_user:!0,display_follower_count:e.get("display_follower_count")+1})}})},removeFollowing:function(e){var t=new n({id:e.get("id")});t.destroy({resultTrue:function(){e.set({display_is_my_following_user:!1,display_follower_count:e.get("display_follower_count")-1})}})}}}()}),define("tools/auto-close-element-window",["jquery"],function(e){return function(t,n,i){var r="data-autoclose-status";e(n).hover(function(){e(this).attr(r,"in")},function(){e(this).attr(r,"out")});var o=function(){setTimeout(function(){e(document).one("click",function(){"in"!=e(n).attr(r)&&("function"==typeof i?i.call(e(n)):e(n).remove())})},100)};o(),e(n).click(function(){o()}),t&&t.stopPropagation()}}),define("text!templates/common/float-box/_master.html",[],function(){return'<span class="text-hide arrow icon-float-tip-arrow">Arrow</span>\n<a class="text-hide bt-close-17 hide_float_box always_allow" href="javascript:;" title="close">Close</a>\n<div class="main">\n    <div class="center">\n\n    </div>\n</div>'}),define("views/common/float-box/_master",["jquery","underscore","backbone","tools/auto-close-element-window","text!templates/common/float-box/_master.html"],function(e,t,n,i,r){return n.View.extend({className:"block float-box",template:r,initialize:function(n){t.bindAll(this,"initialize_","beforeRender_","afterRender_");var i={arrow:{direction:"top",width:16},delay:"",display:{style:"show",afterShow:function(){},afterClose:function(){},showSpeed:1,closeSpeed:1},extraCss:{},isBindButtonElement:!1},n=n||{};this.options=e.extend(!0,i,n),this.initialize_(this.options)},initialize_:function(){},serialize:function(){},events:{"click .hide_float_box":"close"},beforeRender:function(){this.options.view&&"string"!=typeof this.options.view&&(this.setViews({".center":this.options.view}),this.beforeRender_())},beforeRender_:function(){},afterRender:function(){var t=this;this.options.view&&"string"==typeof this.options.view&&this.$(".center").html(this.options.view),t.setWrapPosition();var n=0,i=function(){setTimeout(function(){this.$(".arrow").length>0?t.setArrowPosition():100>n&&(++n,i())},10)};i(),e(window).resize(function(){t.setWrapPosition()}),e(window).keydown(function(e){27===e.keyCode&&t.close()}),this.options.delay&&setTimeout(function(){t.setWrapPosition()},this.options.delay),this.afterRender_()},afterRender_:function(){},getArrowPosition:function(){var e=this.options.arrow.direction,t=this.$(".arrow"),n=t.position(),i=this.options.arrow||{};return"top"===e?{top:i.top===void 0?n.top:n.top+i.top,left:i.offset===void 0?n.left:n.left+i.offset}:"left"===e?{top:i.offset===void 0?n.top:n.top+i.offset,left:i.left===void 0?n.left:n.left+i.left}:"right"===e?{top:i.offset===void 0?n.top:n.top+i.offset,right:i.left===void 0?n.left:n.left+i.left}:void 0},setArrowPosition:function(){this.$(".arrow").css(this.getArrowPosition())},getWrapPosition:function(){var t=this.options.arrow.width,n=this.options.arrow.height,i=this.options.arrow.direction,r=e(this.options.target),o=r.width(),s=r.height(),a=r.offset(),u=this.options.arrow||{};if("top"===i)return{top:u.top===void 0?a.top+s:a.top+s+u.top,left:u.offset===void 0?a.left+o/2-t/2:a.left+o/2-t/2-u.offset};if("left"===i){t=8,n=16;var l=8;return{top:u.offset===void 0?a.top-l:a.top-l-u.offset,left:u.left===void 0?a.left+o+t:a.left+o+t+u.left}}if("right"===i){t=8,n=16;var l=8,c=e(window).width();return{top:u.offset===void 0?a.top-l:a.top-l-u.offset,right:u.left===void 0?c-a.left+t-8:c-a.left+t-8+u.left}}},setWrapPosition:function(){this.$el.css(e.extend(!0,{},this.getWrapPosition(),this.options.extraCss))},initShow:function(t){var n=this;"show"===n.options.display.style?e(t).show(n.options.display.showSpeed,function(){"function"==typeof n.options.display.afterShow&&n.options.display.afterShow()}):"fade"===n.options.display.style?e(t).fadeIn(n.options.display.showSpeed,function(){"function"==typeof n.options.display.afterShow&&n.options.display.afterShow()}):"slide"===n.options.display.style&&e(t).slideDown(n.options.display.showSpeed,function(){"function"==typeof n.options.display.afterShow&&n.options.display.afterShow()})},initClose:function(t){var n=this;"show"===n.options.display.style?e(t).hide(n.options.display.closeSpeed,function(){"function"==typeof n.options.display.afterClose&&n.options.display.afterClose()}):"fade"===n.options.display.style?e(t).fadeOut(n.options.display.closeSpeed,function(){"function"==typeof n.options.display.afterClose&&n.options.display.afterClose()}):"slide"===n.options.display.style&&e(t).slideUp(n.options.display.closeSpeed,function(){"function"==typeof n.options.display.afterClose&&n.options.display.afterClose()})},show:function(t){var n=this;if(e(n.options.target).length>0&&!e(n.options.target).attr("locked")){var r=n.options.isBindButtonElement?t:"",o=this.render().view;n.viewElement=o.$el,e(n.options.target).attr("locked","locked"),e(n.viewElement).hide(),e("#wrapper").append(e(n.viewElement)),n.initShow(n.viewElement),i(r,o.$el,function(){n.close()})}},close:function(){var t=this;this.initClose(t.viewElement),e(t.options.target).removeAttr("locked"),setTimeout(function(){t.remove()},300)}})}),define("text!templates/common/float-box/float-box-top.html",[],function(){return'<span class="text-hide arrow icon-float-tip-arrow-2">Arrow</span>\n<a class="text-hide bt-close-17 hide_float_box always_allow" href="javascript:;" title="close">Close</a>\n<div class="main">\n    <div class="center">\n\n    </div>\n</div>'}),define("views/common/float-box/float-box-top",["jquery","underscore","backbone","views/common/float-box/_master","text!templates/common/float-box/float-box-top.html"],function(e,t,n,i,r){return i.extend({className:"block block-float-down-box float-box",template:r})}),define("text!templates/common/autocomplete-box/menu-item/normal.html",[],function(){return'{{#email_address}}\n<span>\n    <b>{{email_address}}</b>\n</span>\n{{/email_address}}\n{{^email_address}}\n    {{#avatar}}\n    <div class="left l-float">\n        <img src="{{view_url}}" alt="" />\n    </div>\n    {{/avatar}}\n    <div class="right l-float">\n        <div class="title">{{cn_number}}</div>\n        <div class="body">{{display_name}}</div>\n    </div>\n    <div class="clear"></div>\n{{/email_address}}'}),define("views/common/autocomplete-box/menu-item/normal",["jquery","underscore","backbone","modules/user/user","text!templates/common/autocomplete-box/menu-item/normal.html"],function(e,t,n,i,r){return n.View.extend({template:r,className:"block-search-menu-item",initialize:function(e){this.model=!t.isUndefined(e)&&t.has(e,"model")?e.model:new i},serialize:function(){return this.model.toJSON()}})}),define("modules/user/email-receiver",["jquery","underscore","modules/user/user"],function(e,t,n){return n.extend({defaults_:function(){return{type:"user",id:"",receive_type:"normal"}}})}),define("text!templates/common/autocomplete-box/result-item/email-search-result-item.html",[],function(){return'<input type="hidden" name="receivers[{{receivers_len}}][type]" value="{{type}}"/>\n<input type="hidden" name="receivers[{{receivers_len}}][id]" value="{{id}}" />\n{{#email_address}}\n    <b>{{email_address}}</b>\n{{/email_address}}\n{{^email_address}}\n    <b>{{display_name}}{{#cn_number}}({{cn_number}}){{/cn_number}}</b>\n{{/email_address}}\n<a href="javascript:;" class="search_result_remove">X</a>'}),define("views/common/autocomplete-box/result-item/email-search-result-item",["jquery","underscore","backbone","modules/user/email-receiver","text!templates/common/autocomplete-box/result-item/email-search-result-item.html"],function(e,t,n,i,r){return n.View.extend({template:r,tagName:"span",className:"block-email-search-result email_search_result_item",events:{"click .search_result_remove":"deleted"},initialize:function(e){var n=this;n.model=!t.isUndefined(e)&&t.has(e,"model")?e.model:new i},serialize:function(){return this.model.toJSON()},deleted:function(){this.remove()}})}),define("text!templates/common/autocomplete-box/autocomplete.html",[],function(){return'<input class="receiver_search_box input-box" type="text" value="" placeholder="{{placeholder}}" title="{{placeholder}}"/>'}),function(e,t){function n(t,n){var r,o,s,a=t.nodeName.toLowerCase();return"area"===a?(r=t.parentNode,o=r.name,t.href&&o&&"map"===r.nodeName.toLowerCase()?(s=e("img[usemap=#"+o+"]")[0],!!s&&i(s)):!1):(/input|select|textarea|button|object/.test(a)?!t.disabled:"a"===a?t.href||n:n)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().andSelf().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var r=0,o=/^ui-id-\d+$/;e.ui=e.ui||{},e.ui.version||(e.extend(e.ui,{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({_focus:e.fn.focus,focus:function(t,n){return"number"==typeof t?this.each(function(){var i=this;setTimeout(function(){e(i).focus(),n&&n.call(i)},t)}):this._focus.apply(this,arguments)},scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(n){if(n!==t)return this.css("zIndex",n);if(this.length)for(var i,r,o=e(this[0]);o.length&&o[0]!==document;){if(i=o.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(r=parseInt(o.css("zIndex"),10),!isNaN(r)&&0!==r))return r;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,i){return!!e.data(t,i[3])},focusable:function(t){return n(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var i=e.attr(t,"tabindex"),r=isNaN(i);return(r||i>=0)&&n(t,!r)}}),e(function(){var t=document.body,n=t.appendChild(n=document.createElement("div"));n.offsetHeight,e.extend(n.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),e.support.minHeight=100===n.offsetHeight,e.support.selectstart="onselectstart"in n,t.removeChild(n).style.display="none"}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(n,i){function r(t,n,i,r){return e.each(o,function(){n-=parseFloat(e.css(t,"padding"+this))||0,i&&(n-=parseFloat(e.css(t,"border"+this+"Width"))||0),r&&(n-=parseFloat(e.css(t,"margin"+this))||0)}),n}var o="Width"===i?["Left","Right"]:["Top","Bottom"],s=i.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(n){return n===t?a["inner"+i].call(this):this.each(function(){e(this).css(s,r(this,n)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?a["outer"+i].call(this,t):this.each(function(){e(this).css(s,r(this,t,!0,n)+"px")})}}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(n){return arguments.length?t.call(this,e.camelCase(n)):t.call(this)}}(e.fn.removeData)),function(){var t=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];e.ui.ie=t.length?!0:!1,e.ui.ie6=6===parseFloat(t[1],10)}(),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,n,i){var r,o=e.ui[t].prototype;for(r in i)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([n,i[r]])},call:function(e,t,n){var i,r=e.plugins[t];if(r&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(i=0;r.length>i;i++)e.options[r[i][0]]&&r[i][1].apply(e.element,n)}},contains:e.contains,hasScroll:function(t,n){if("hidden"===e(t).css("overflow"))return!1;var i=n&&"left"===n?"scrollLeft":"scrollTop",r=!1;return t[i]>0?!0:(t[i]=1,r=t[i]>0,t[i]=0,r)},isOverAxis:function(e,t,n){return e>t&&t+n>e},isOver:function(t,n,i,r,o,s){return e.ui.isOverAxis(t,i,o)&&e.ui.isOverAxis(n,r,s)}}))}(jQuery),function(e,t){var n=0,i=Array.prototype.slice,r=e.cleanData;e.cleanData=function(t){for(var n,i=0;null!=(n=t[i]);i++)try{e(n).triggerHandler("remove")}catch(o){}r(t)},e.widget=function(t,n,i){var r,o,s,a,u=t.split(".")[0];t=t.split(".")[1],r=u+"-"+t,i||(i=n,n=e.Widget),e.expr[":"][r.toLowerCase()]=function(t){return!!e.data(t,r)},e[u]=e[u]||{},o=e[u][t],s=e[u][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new s(e,t)},e.extend(s,o,{version:i.version,_proto:e.extend({},i),_childConstructors:[]}),a=new n,a.options=e.widget.extend({},a.options),e.each(i,function(t,r){e.isFunction(r)&&(i[t]=function(){var e=function(){return n.prototype[t].apply(this,arguments)},i=function(e){return n.prototype[t].apply(this,e)};return function(){var t,n=this._super,o=this._superApply;return this._super=e,this._superApply=i,t=r.apply(this,arguments),this._super=n,this._superApply=o,t}}())}),s.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix:t},i,{constructor:s,namespace:u,widgetName:t,widgetBaseClass:r,widgetFullName:r}),o?(e.each(o._childConstructors,function(t,n){var i=n.prototype;e.widget(i.namespace+"."+i.widgetName,s,n._proto)}),delete o._childConstructors):n._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(n){for(var r,o,s=i.call(arguments,1),a=0,u=s.length;u>a;a++)for(r in s[a])o=s[a][r],s[a].hasOwnProperty(r)&&o!==t&&(n[r]=e.isPlainObject(o)?e.isPlainObject(n[r])?e.widget.extend({},n[r],o):e.widget.extend({},o):o);return n},e.widget.bridge=function(n,r){var o=r.prototype.widgetFullName||n;e.fn[n]=function(s){var a="string"==typeof s,u=i.call(arguments,1),l=this;return s=!a&&u.length?e.widget.extend.apply(null,[s].concat(u)):s,a?this.each(function(){var i,r=e.data(this,o);return r?e.isFunction(r[s])&&"_"!==s.charAt(0)?(i=r[s].apply(r,u),i!==r&&i!==t?(l=i&&i.jquery?l.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+s+"' for "+n+" widget instance"):e.error("cannot call methods on "+n+" prior to initialization; "+"attempted to call method '"+s+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(s||{})._init():e.data(this,o,new r(s,this))}),l}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=n++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetName,this),e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(n,i){var r,o,s,a=n;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof n)if(a={},r=n.split("."),n=r.shift(),r.length){for(o=a[n]=e.widget.extend({},this.options[n]),s=0;r.length-1>s;s++)o[r[s]]=o[r[s]]||{},o=o[r[s]];if(n=r.pop(),i===t)return o[n]===t?null:o[n];o[n]=i}else{if(i===t)return this.options[n]===t?null:this.options[n];a[n]=i}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,n,i){var r,o=this;"boolean"!=typeof t&&(i=n,n=t,t=!1),i?(n=r=e(n),this.bindings=this.bindings.add(n)):(i=n,n=this.element,r=this.widget()),e.each(i,function(i,s){function a(){return t||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var u=i.match(/^(\w+)\s*(.*)$/),l=u[1]+o.eventNamespace,c=u[2];c?r.delegate(c,l,a):n.bind(l,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function n(){return("string"==typeof e?i[e]:e).apply(i,arguments)}var i=this;return setTimeout(n,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,n,i){var r,o,s=this.options[t];if(i=i||{},n=e.Event(n),n.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),n.target=this.element[0],o=n.originalEvent,o)for(r in o)r in n||(n[r]=o[r]);return this.element.trigger(n,i),!(e.isFunction(s)&&s.apply(this.element[0],[n].concat(i))===!1||n.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,n){e.Widget.prototype["_"+t]=function(i,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?r===!0||"number"==typeof r?n:r.effect||n:t;r=r||{},"number"==typeof r&&(r={duration:r}),s=!e.isEmptyObject(r),r.complete=o,r.delay&&i.delay(r.delay),s&&e.effects&&(e.effects.effect[a]||e.uiBackCompat!==!1&&e.effects[a])?i[t](r):a!==t&&i[a]?i[a](r.duration,r.easing,o):i.queue(function(n){e(this)[t](),o&&o.call(i[0]),n()})}}),e.uiBackCompat!==!1&&(e.Widget.prototype._getCreateOptions=function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.9.2",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(n){return!0===e.data(n.target,t.widgetName+".preventClickEvent")?(e.removeData(n.target,t.widgetName+".preventClickEvent"),n.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(n){if(!t){this._mouseStarted&&this._mouseUp(n),this._mouseDownEvent=n;var i=this,r=1===n.which,o="string"==typeof this.options.cancel&&n.target.nodeName?e(n.target).closest(this.options.cancel).length:!1;return r&&!o&&this._mouseCapture(n)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(n)&&this._mouseDelayMet(n)&&(this._mouseStarted=this._mouseStart(n)!==!1,!this._mouseStarted)?(n.preventDefault(),!0):(!0===e.data(n.target,this.widgetName+".preventClickEvent")&&e.removeData(n.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),n.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return!e.ui.ie||document.documentMode>=9||t.button?this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted):this._mouseUp(t)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e,t){function n(e,t,n){return[parseInt(e[0],10)*(f.test(e[0])?t/100:1),parseInt(e[1],10)*(f.test(e[1])?n/100:1)]}function i(t,n){return parseInt(e.css(t,n),10)||0}e.ui=e.ui||{};var r,o=Math.max,s=Math.abs,a=Math.round,u=/left|center|right/,l=/top|center|bottom/,c=/[\+\-]\d+%?/,d=/^\w+/,f=/%$/,h=e.fn.position;e.position={scrollbarWidth:function(){if(r!==t)return r;var n,i,o=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=o.children()[0];return e("body").append(o),n=s.offsetWidth,o.css("overflow","scroll"),i=s.offsetWidth,n===i&&(i=o[0].clientWidth),o.remove(),r=n-i},getScrollInfo:function(t){var n=t.isWindow?"":t.element.css("overflow-x"),i=t.isWindow?"":t.element.css("overflow-y"),r="scroll"===n||"auto"===n&&t.width<t.element[0].scrollWidth,o="scroll"===i||"auto"===i&&t.height<t.element[0].scrollHeight;return{width:r?e.position.scrollbarWidth():0,height:o?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var n=e(t||window),i=e.isWindow(n[0]);return{element:n,isWindow:i,offset:n.offset()||{left:0,top:0},scrollLeft:n.scrollLeft(),scrollTop:n.scrollTop(),width:i?n.width():n.outerWidth(),height:i?n.height():n.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return h.apply(this,arguments);t=e.extend({},t);var r,f,p,m,g,v=e(t.of),y=e.position.getWithinInfo(t.within),b=e.position.getScrollInfo(y),_=v[0],w=(t.collision||"flip").split(" "),x={};return 9===_.nodeType?(f=v.width(),p=v.height(),m={top:0,left:0}):e.isWindow(_)?(f=v.width(),p=v.height(),m={top:v.scrollTop(),left:v.scrollLeft()}):_.preventDefault?(t.at="left top",f=p=0,m={top:_.pageY,left:_.pageX}):(f=v.outerWidth(),p=v.outerHeight(),m=v.offset()),g=e.extend({},m),e.each(["my","at"],function(){var e,n,i=(t[this]||"").split(" ");
1===i.length&&(i=u.test(i[0])?i.concat(["center"]):l.test(i[0])?["center"].concat(i):["center","center"]),i[0]=u.test(i[0])?i[0]:"center",i[1]=l.test(i[1])?i[1]:"center",e=c.exec(i[0]),n=c.exec(i[1]),x[this]=[e?e[0]:0,n?n[0]:0],t[this]=[d.exec(i[0])[0],d.exec(i[1])[0]]}),1===w.length&&(w[1]=w[0]),"right"===t.at[0]?g.left+=f:"center"===t.at[0]&&(g.left+=f/2),"bottom"===t.at[1]?g.top+=p:"center"===t.at[1]&&(g.top+=p/2),r=n(x.at,f,p),g.left+=r[0],g.top+=r[1],this.each(function(){var u,l,c=e(this),d=c.outerWidth(),h=c.outerHeight(),_=i(this,"marginLeft"),k=i(this,"marginTop"),C=d+_+i(this,"marginRight")+b.width,T=h+k+i(this,"marginBottom")+b.height,E=e.extend({},g),S=n(x.my,c.outerWidth(),c.outerHeight());"right"===t.my[0]?E.left-=d:"center"===t.my[0]&&(E.left-=d/2),"bottom"===t.my[1]?E.top-=h:"center"===t.my[1]&&(E.top-=h/2),E.left+=S[0],E.top+=S[1],e.support.offsetFractions||(E.left=a(E.left),E.top=a(E.top)),u={marginLeft:_,marginTop:k},e.each(["left","top"],function(n,i){e.ui.position[w[n]]&&e.ui.position[w[n]][i](E,{targetWidth:f,targetHeight:p,elemWidth:d,elemHeight:h,collisionPosition:u,collisionWidth:C,collisionHeight:T,offset:[r[0]+S[0],r[1]+S[1]],my:t.my,at:t.at,within:y,elem:c})}),e.fn.bgiframe&&c.bgiframe(),t.using&&(l=function(e){var n=m.left-E.left,i=n+f-d,r=m.top-E.top,a=r+p-h,u={target:{element:v,left:m.left,top:m.top,width:f,height:p},element:{element:c,left:E.left,top:E.top,width:d,height:h},horizontal:0>i?"left":n>0?"right":"center",vertical:0>a?"top":r>0?"bottom":"middle"};d>f&&f>s(n+i)&&(u.horizontal="center"),h>p&&p>s(r+a)&&(u.vertical="middle"),u.important=o(s(n),s(i))>o(s(r),s(a))?"horizontal":"vertical",t.using.call(this,e,u)}),c.offset(e.extend(E,{using:l}))})},e.ui.position={fit:{left:function(e,t){var n,i=t.within,r=i.isWindow?i.scrollLeft:i.offset.left,s=i.width,a=e.left-t.collisionPosition.marginLeft,u=r-a,l=a+t.collisionWidth-s-r;t.collisionWidth>s?u>0&&0>=l?(n=e.left+u+t.collisionWidth-s-r,e.left+=u-n):e.left=l>0&&0>=u?r:u>l?r+s-t.collisionWidth:r:u>0?e.left+=u:l>0?e.left-=l:e.left=o(e.left-a,e.left)},top:function(e,t){var n,i=t.within,r=i.isWindow?i.scrollTop:i.offset.top,s=t.within.height,a=e.top-t.collisionPosition.marginTop,u=r-a,l=a+t.collisionHeight-s-r;t.collisionHeight>s?u>0&&0>=l?(n=e.top+u+t.collisionHeight-s-r,e.top+=u-n):e.top=l>0&&0>=u?r:u>l?r+s-t.collisionHeight:r:u>0?e.top+=u:l>0?e.top-=l:e.top=o(e.top-a,e.top)}},flip:{left:function(e,t){var n,i,r=t.within,o=r.offset.left+r.scrollLeft,a=r.width,u=r.isWindow?r.scrollLeft:r.offset.left,l=e.left-t.collisionPosition.marginLeft,c=l-u,d=l+t.collisionWidth-a-u,f="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,h="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,p=-2*t.offset[0];0>c?(n=e.left+f+h+p+t.collisionWidth-a-o,(0>n||s(c)>n)&&(e.left+=f+h+p)):d>0&&(i=e.left-t.collisionPosition.marginLeft+f+h+p-u,(i>0||d>s(i))&&(e.left+=f+h+p))},top:function(e,t){var n,i,r=t.within,o=r.offset.top+r.scrollTop,a=r.height,u=r.isWindow?r.scrollTop:r.offset.top,l=e.top-t.collisionPosition.marginTop,c=l-u,d=l+t.collisionHeight-a-u,f="top"===t.my[1],h=f?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,p="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>c?(i=e.top+h+p+m+t.collisionHeight-a-o,e.top+h+p+m>c&&(0>i||s(c)>i)&&(e.top+=h+p+m)):d>0&&(n=e.top-t.collisionPosition.marginTop+h+p+m-u,e.top+h+p+m>d&&(n>0||d>s(n))&&(e.top+=h+p+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,n,i,r,o,s=document.getElementsByTagName("body")[0],a=document.createElement("div");t=document.createElement(s?"div":"body"),i={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(i,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in i)t.style[o]=i[o];t.appendChild(a),n=s||document.documentElement,n.insertBefore(t,n.firstChild),a.style.cssText="position: absolute; left: 10.7432222px;",r=e(a).offset().left,e.support.offsetFractions=r>10&&11>r,t.innerHTML="",n.removeChild(t)}(),e.uiBackCompat!==!1&&function(e){var n=e.fn.position;e.fn.position=function(i){if(!i||!i.offset)return n.call(this,i);var r=i.offset.split(" "),o=i.at.split(" ");return 1===r.length&&(r[1]=r[0]),/^\d/.test(r[0])&&(r[0]="+"+r[0]),/^\d/.test(r[1])&&(r[1]="+"+r[1]),1===o.length&&(/left|center|right/.test(o[0])?o[1]="center":(o[1]=o[0],o[0]="center")),n.call(this,e.extend(i,{at:o[0]+r[0]+" "+o[1]+r[1],offset:t}))}}(jQuery)}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.9.2",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"==this.options.helper&&!/^(?:r|a|f)/.test(this.element.css("position"))&&(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var n=this.options;return this.helper||n.disabled||e(t.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(t),this.handle?(e(n.iframeFix===!0?"iframe":n.iframeFix).each(function(){e('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var n=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,n.cursorAt&&this._adjustOffsetFromHelper(n.cursorAt),n.containment&&this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,n){if(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!n){var i=this._uiHash();if(this._trigger("drag",t,i)===!1)return this._mouseUp({}),!1;this.position=i.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var n=!1;e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1);for(var i=this.element[0],r=!1;i&&(i=i.parentNode);)i==document&&(r=!0);if(!r&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!n||"valid"==this.options.revert&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)){var o=this;e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){o._trigger("stop",t)!==!1&&o._clear()})}else this._trigger("stop",t)!==!1&&this._clear();return!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){var n=this.options.handle&&e(this.options.handle,this.element).length?!1:!0;return e(this.options.handle,this.element).find("*").andSelf().each(function(){this==t.target&&(n=!0)}),n},_createHelper:function(t){var n=this.options,i=e.isFunction(n.helper)?e(n.helper.apply(this.element[0],[t])):"clone"==n.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"==n.appendTo?this.element[0].parentNode:n.appendTo),i[0]!=this.element[0]&&!/(fixed|absolute)/.test(i.css("position"))&&i.css("position","absolute"),i},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t=this.options;if("parent"==t.containment&&(t.containment=this.helper[0].parentNode),("document"==t.containment||"window"==t.containment)&&(this.containment=["document"==t.containment?0:e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==t.containment?0:e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==t.containment?0:e(window).scrollLeft())+e("document"==t.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==t.containment?0:e(window).scrollTop())+(e("document"==t.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(t.containment)||t.containment.constructor==Array)t.containment.constructor==Array&&(this.containment=t.containment);else{var n=e(t.containment),i=n[0];if(!i)return;var r=(n.offset(),"hidden"!=e(i).css("overflow"));this.containment=[(parseInt(e(i).css("borderLeftWidth"),10)||0)+(parseInt(e(i).css("paddingLeft"),10)||0),(parseInt(e(i).css("borderTopWidth"),10)||0)+(parseInt(e(i).css("paddingTop"),10)||0),(r?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(e(i).css("borderLeftWidth"),10)||0)-(parseInt(e(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(r?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(e(i).css("borderTopWidth"),10)||0)-(parseInt(e(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=n}},_convertPositionTo:function(t,n){n||(n=this.position);var i="absolute"==t?1:-1,r=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),o=/(html|body)/i.test(r[0].tagName);return{top:n.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*i,left:n.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*i}},_generatePosition:function(t){var n=this.options,i="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,r=/(html|body)/i.test(i[0].tagName),o=t.pageX,s=t.pageY;if(this.originalPosition){var a;if(this.containment){if(this.relative_container){var u=this.relative_container.offset();a=[this.containment[0]+u.left,this.containment[1]+u.top,this.containment[2]+u.left,this.containment[3]+u.top]}else a=this.containment;t.pageX-this.offset.click.left<a[0]&&(o=a[0]+this.offset.click.left),t.pageY-this.offset.click.top<a[1]&&(s=a[1]+this.offset.click.top),t.pageX-this.offset.click.left>a[2]&&(o=a[2]+this.offset.click.left),t.pageY-this.offset.click.top>a[3]&&(s=a[3]+this.offset.click.top)}if(n.grid){var l=n.grid[1]?this.originalPageY+Math.round((s-this.originalPageY)/n.grid[1])*n.grid[1]:this.originalPageY;s=a?l-this.offset.click.top<a[1]||l-this.offset.click.top>a[3]?l-this.offset.click.top<a[1]?l+n.grid[1]:l-n.grid[1]:l:l;var c=n.grid[0]?this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0]:this.originalPageX;o=a?c-this.offset.click.left<a[0]||c-this.offset.click.left>a[2]?c-this.offset.click.left<a[0]?c+n.grid[0]:c-n.grid[0]:c:c}}return{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():r?0:i.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():r?0:i.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]!=this.element[0]&&!this.cancelHelperRemoval&&this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,n,i){return i=i||this._uiHash(),e.ui.plugin.call(this,t,[n,i]),"drag"==t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,n,i)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,n){var i=e(this).data("draggable"),r=i.options,o=e.extend({},n,{item:i.element});i.sortables=[],e(r.connectToSortable).each(function(){var n=e.data(this,"sortable");n&&!n.options.disabled&&(i.sortables.push({instance:n,shouldRevert:n.options.revert}),n.refreshPositions(),n._trigger("activate",t,o))})},stop:function(t,n){var i=e(this).data("draggable"),r=e.extend({},n,{item:i.element});e.each(i.sortables,function(){this.instance.isOver?(this.instance.isOver=0,i.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"==i.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,r))})},drag:function(t,n){var i=e(this).data("draggable"),r=this;e.each(i.sortables,function(){var o=!1,s=this;this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(i.sortables,function(){return this.instance.positionAbs=i.positionAbs,this.instance.helperProportions=i.helperProportions,this.instance.offset.click=i.offset.click,this!=s&&this.instance._intersectsWith(this.instance.containerCache)&&e.ui.contains(s.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(r).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return n.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=i.offset.click.top,this.instance.offset.click.left=i.offset.click.left,this.instance.offset.parent.left-=i.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=i.offset.parent.top-this.instance.offset.parent.top,i._trigger("toSortable",t),i.dropped=this.instance.element,i.currentItem=i.element,this.instance.fromOutside=i),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),i._trigger("fromSortable",t),i.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),n=e(this).data("draggable").options;t.css("cursor")&&(n._cursor=t.css("cursor")),t.css("cursor",n.cursor)},stop:function(){var t=e(this).data("draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,n){var i=e(n.helper),r=e(this).data("draggable").options;i.css("opacity")&&(r._opacity=i.css("opacity")),i.css("opacity",r.opacity)},stop:function(t,n){var i=e(this).data("draggable").options;i._opacity&&e(n.helper).css("opacity",i._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("draggable");t.scrollParent[0]!=document&&"HTML"!=t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var n=e(this).data("draggable"),i=n.options,r=!1;n.scrollParent[0]!=document&&"HTML"!=n.scrollParent[0].tagName?(i.axis&&"x"==i.axis||(n.overflowOffset.top+n.scrollParent[0].offsetHeight-t.pageY<i.scrollSensitivity?n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop+i.scrollSpeed:t.pageY-n.overflowOffset.top<i.scrollSensitivity&&(n.scrollParent[0].scrollTop=r=n.scrollParent[0].scrollTop-i.scrollSpeed)),i.axis&&"y"==i.axis||(n.overflowOffset.left+n.scrollParent[0].offsetWidth-t.pageX<i.scrollSensitivity?n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft+i.scrollSpeed:t.pageX-n.overflowOffset.left<i.scrollSensitivity&&(n.scrollParent[0].scrollLeft=r=n.scrollParent[0].scrollLeft-i.scrollSpeed))):(i.axis&&"x"==i.axis||(t.pageY-e(document).scrollTop()<i.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<i.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+i.scrollSpeed))),i.axis&&"y"==i.axis||(t.pageX-e(document).scrollLeft()<i.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<i.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+i.scrollSpeed)))),r!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(n,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("draggable"),n=t.options;t.snapElements=[],e(n.snap.constructor!=String?n.snap.items||":data(draggable)":n.snap).each(function(){var n=e(this),i=n.offset();this!=t.element[0]&&t.snapElements.push({item:this,width:n.outerWidth(),height:n.outerHeight(),top:i.top,left:i.left})})},drag:function(t,n){for(var i=e(this).data("draggable"),r=i.options,o=r.snapTolerance,s=n.offset.left,a=s+i.helperProportions.width,u=n.offset.top,l=u+i.helperProportions.height,c=i.snapElements.length-1;c>=0;c--){var d=i.snapElements[c].left,f=d+i.snapElements[c].width,h=i.snapElements[c].top,p=h+i.snapElements[c].height;if(s>d-o&&f+o>s&&u>h-o&&p+o>u||s>d-o&&f+o>s&&l>h-o&&p+o>l||a>d-o&&f+o>a&&u>h-o&&p+o>u||a>d-o&&f+o>a&&l>h-o&&p+o>l){if("inner"!=r.snapMode){var m=o>=Math.abs(h-l),g=o>=Math.abs(p-u),v=o>=Math.abs(d-a),y=o>=Math.abs(f-s);m&&(n.position.top=i._convertPositionTo("relative",{top:h-i.helperProportions.height,left:0}).top-i.margins.top),g&&(n.position.top=i._convertPositionTo("relative",{top:p,left:0}).top-i.margins.top),v&&(n.position.left=i._convertPositionTo("relative",{top:0,left:d-i.helperProportions.width}).left-i.margins.left),y&&(n.position.left=i._convertPositionTo("relative",{top:0,left:f}).left-i.margins.left)}var b=m||g||v||y;if("outer"!=r.snapMode){var m=o>=Math.abs(h-u),g=o>=Math.abs(p-l),v=o>=Math.abs(d-s),y=o>=Math.abs(f-a);m&&(n.position.top=i._convertPositionTo("relative",{top:h,left:0}).top-i.margins.top),g&&(n.position.top=i._convertPositionTo("relative",{top:p-i.helperProportions.height,left:0}).top-i.margins.top),v&&(n.position.left=i._convertPositionTo("relative",{top:0,left:d}).left-i.margins.left),y&&(n.position.left=i._convertPositionTo("relative",{top:0,left:f-i.helperProportions.width}).left-i.margins.left)}!i.snapElements[c].snapping&&(m||g||v||y||b)&&i.options.snap.snap&&i.options.snap.snap.call(i.element,t,e.extend(i._uiHash(),{snapItem:i.snapElements[c].item})),i.snapElements[c].snapping=m||g||v||y||b}else i.snapElements[c].snapping&&i.options.snap.release&&i.options.snap.release.call(i.element,t,e.extend(i._uiHash(),{snapItem:i.snapElements[c].item})),i.snapElements[c].snapping=!1}}}),e.ui.plugin.add("draggable","stack",{start:function(){var t=e(this).data("draggable").options,n=e.makeArray(e(t.stack)).sort(function(t,n){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(n).css("zIndex"),10)||0)});if(n.length){var i=parseInt(n[0].style.zIndex)||0;e(n).each(function(e){this.style.zIndex=i+e}),this[0].style.zIndex=i+n.length}}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,n){var i=e(n.helper),r=e(this).data("draggable").options;i.css("zIndex")&&(r._zIndex=i.css("zIndex")),i.css("zIndex",r.zIndex)},stop:function(t,n){var i=e(this).data("draggable").options;i._zIndex&&e(n.helper).css("zIndex",i._zIndex)}})}(jQuery),function(e){var t=0;e.widget("ui.autocomplete",{version:"1.9.2",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,n,i;this.isMultiLine=this._isMultiLine(),this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(r){if(this.element.prop("readOnly"))return t=!0,i=!0,n=!0,void 0;t=!1,i=!1,n=!1;var o=e.ui.keyCode;switch(r.keyCode){case o.PAGE_UP:t=!0,this._move("previousPage",r);break;case o.PAGE_DOWN:t=!0,this._move("nextPage",r);break;case o.UP:t=!0,this._keyEvent("previous",r);break;case o.DOWN:t=!0,this._keyEvent("next",r);break;case o.ENTER:case o.NUMPAD_ENTER:this.menu.active&&(t=!0,r.preventDefault(),this.menu.select(r));break;case o.TAB:this.menu.active&&this.menu.select(r);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(r),r.preventDefault());break;default:n=!0,this._searchTimeout(r)}},keypress:function(i){if(t)return t=!1,i.preventDefault(),void 0;if(!n){var r=e.ui.keyCode;switch(i.keyCode){case r.PAGE_UP:this._move("previousPage",i);break;case r.PAGE_DOWN:this._move("nextPage",i);break;case r.UP:this._keyEvent("previous",i);break;case r.DOWN:this._keyEvent("next",i)}}},input:function(e){return i?(i=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:e(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var n=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(i){i.target!==t.element[0]&&i.target!==n&&!e.contains(n,i.target)&&t.close()})})},menufocus:function(t,n){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),void 0;var i=n.item.data("ui-autocomplete-item")||n.item.data("item.autocomplete");!1!==this._trigger("focus",t,{item:i})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(i.value):this.liveRegion.text(i.value)},menuselect:function(e,t){var n=t.item.data("ui-autocomplete-item")||t.item.data("item.autocomplete"),i=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=i,this._delay(function(){this.previous=i,this.selectedItem=n})),!1!==this._trigger("select",e,{item:n})&&this._value(n.value),this.term=this._value(),this.close(e),this.selectedItem=n}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),e.fn.bgiframe&&this.menu.element.bgiframe(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this.document.find(t||"body")[0]),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable")},_initSource:function(){var t,n,i=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(n,i){i(e.ui.autocomplete.filter(t,n.term))}):"string"==typeof this.options.source?(n=this.options.source,this.source=function(t,r){i.xhr&&i.xhr.abort(),i.xhr=e.ajax({url:n,data:t,dataType:"json",success:function(e){r(e)},error:function(){r([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var e=this,n=++t;return function(i){n===t&&e.__response(i),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var n=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(n,t),this.menu.refresh(),n.show(),this._resizeMenu(),n.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,n){var i=this;e.each(n,function(e,n){i._renderItemData(t,n)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,n){return e("<li>").append(e("<a>").text(n.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,n){var i=RegExp(e.ui.autocomplete.escapeRegex(n),"i");return e.grep(t,function(e){return i.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function($,undefined){function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))
}function bindHover(e){var t="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(t,"mouseout",function(){$(this).removeClass("ui-state-hover"),-1!=this.className.indexOf("ui-datepicker-prev")&&$(this).removeClass("ui-datepicker-prev-hover"),-1!=this.className.indexOf("ui-datepicker-next")&&$(this).removeClass("ui-datepicker-next-hover")}).delegate(t,"mouseover",function(){$.datepicker._isDisabledDatepicker(instActive.inline?e.parent()[0]:instActive.input[0])||($(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),$(this).addClass("ui-state-hover"),-1!=this.className.indexOf("ui-datepicker-prev")&&$(this).addClass("ui-datepicker-prev-hover"),-1!=this.className.indexOf("ui-datepicker-next")&&$(this).addClass("ui-datepicker-next-hover"))})}function extendRemove(e,t){$.extend(e,t);for(var n in t)(null==t[n]||t[n]==undefined)&&(e[n]=t[n]);return e}$.extend($.ui,{datepicker:{version:"1.9.2"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline="div"==nodeName||"span"==nodeName;target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),"input"==nodeName?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(e,t){var n=e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:t,dpDiv:t?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(e,t){var n=$(e);t.append=$([]),t.trigger=$([]),n.hasClass(this.markerClassName)||(this._attachments(n,t),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(e,n,i){t.settings[n]=i}).bind("getData.datepicker",function(e,n){return this._get(t,n)}),this._autoSize(t),$.data(e,PROP_NAME,t),t.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,t){var n=this._get(t,"appendText"),i=this._get(t,"isRTL");t.append&&t.append.remove(),n&&(t.append=$('<span class="'+this._appendClass+'">'+n+"</span>"),e[i?"before":"after"](t.append)),e.unbind("focus",this._showDatepicker),t.trigger&&t.trigger.remove();var r=this._get(t,"showOn");if(("focus"==r||"both"==r)&&e.focus(this._showDatepicker),"button"==r||"both"==r){var o=this._get(t,"buttonText"),s=this._get(t,"buttonImage");t.trigger=$(this._get(t,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:s,alt:o,title:o}):$('<button type="button"></button>').addClass(this._triggerClass).html(""==s?o:$("<img/>").attr({src:s,alt:o,title:o}))),e[i?"before":"after"](t.trigger),t.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==e[0]?$.datepicker._hideDatepicker():$.datepicker._datepickerShowing&&$.datepicker._lastInput!=e[0]?($.datepicker._hideDatepicker(),$.datepicker._showDatepicker(e[0])):$.datepicker._showDatepicker(e[0]),!1})}},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t=new Date(2009,11,20),n=this._get(e,"dateFormat");if(n.match(/[DM]/)){var i=function(e){for(var t=0,n=0,i=0;e.length>i;i++)e[i].length>t&&(t=e[i].length,n=i);return n};t.setMonth(i(this._get(e,n.match(/MM/)?"monthNames":"monthNamesShort"))),t.setDate(i(this._get(e,n.match(/DD/)?"dayNames":"dayNamesShort"))+20-t.getDay())}e.input.attr("size",this._formatDate(e,t).length)}},_inlineDatepicker:function(e,t){var n=$(e);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(t.dpDiv).bind("setData.datepicker",function(e,n,i){t.settings[n]=i}).bind("getData.datepicker",function(e,n){return this._get(t,n)}),$.data(e,PROP_NAME,t),this._setDate(t,this._getDefaultDate(t),!0),this._updateDatepicker(t),this._updateAlternate(t),t.settings.disabled&&this._disableDatepicker(e),t.dpDiv.css("display","block"))},_dialogDatepicker:function(e,t,n,i,r){var o=this._dialogInst;if(!o){this.uuid+=1;var s="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+s+'" style="position: absolute; top: -100px; width: 0px;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),o=this._dialogInst=this._newInst(this._dialogInput,!1),o.settings={},$.data(this._dialogInput[0],PROP_NAME,o)}if(extendRemove(o.settings,i||{}),t=t&&t.constructor==Date?this._formatDate(o,t):t,this._dialogInput.val(t),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,!this._pos){var a=document.documentElement.clientWidth,u=document.documentElement.clientHeight,l=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[a/2-100+l,u/2-150+c]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),o.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,o),this},_destroyDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var i=e.nodeName.toLowerCase();$.removeData(e,PROP_NAME),"input"==i?(n.append.remove(),n.trigger.remove(),t.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==i||"span"==i)&&t.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var i=e.nodeName.toLowerCase();if("input"==i)e.disabled=!1,n.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if("div"==i||"span"==i){var r=t.children("."+this._inlineClass);r.children().removeClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t})}},_disableDatepicker:function(e){var t=$(e),n=$.data(e,PROP_NAME);if(t.hasClass(this.markerClassName)){var i=e.nodeName.toLowerCase();if("input"==i)e.disabled=!0,n.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if("div"==i||"span"==i){var r=t.children("."+this._inlineClass);r.children().addClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)}this._disabledInputs=$.map(this._disabledInputs,function(t){return t==e?null:t}),this._disabledInputs[this._disabledInputs.length]=e}},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]==e)return!0;return!1},_getInst:function(e){try{return $.data(e,PROP_NAME)}catch(t){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(e,t,n){var i=this._getInst(e);if(2==arguments.length&&"string"==typeof t)return"defaults"==t?$.extend({},$.datepicker._defaults):i?"all"==t?$.extend({},i.settings):this._get(i,t):null;var r=t||{};if("string"==typeof t&&(r={},r[t]=n),i){this._curInst==i&&this._hideDatepicker();var o=this._getDateDatepicker(e,!0),s=this._getMinMaxDate(i,"min"),a=this._getMinMaxDate(i,"max");extendRemove(i.settings,r),null!==s&&r.dateFormat!==undefined&&r.minDate===undefined&&(i.settings.minDate=this._formatDate(i,s)),null!==a&&r.dateFormat!==undefined&&r.maxDate===undefined&&(i.settings.maxDate=this._formatDate(i,a)),this._attachments($(e),i),this._autoSize(i),this._setDate(i,o),this._updateAlternate(i),this._updateDatepicker(i)}},_changeDatepicker:function(e,t,n){this._optionDatepicker(e,t,n)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var n=this._getInst(e);n&&(this._setDate(n,t),this._updateDatepicker(n),this._updateAlternate(n))},_getDateDatepicker:function(e,t){var n=this._getInst(e);return n&&!n.inline&&this._setDateFromField(n,t),n?this._getDate(n):null},_doKeyDown:function(e){var t=$.datepicker._getInst(e.target),n=!0,i=t.dpDiv.is(".ui-datepicker-rtl");if(t._keyEvent=!0,$.datepicker._datepickerShowing)switch(e.keyCode){case 9:$.datepicker._hideDatepicker(),n=!1;break;case 13:var r=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",t.dpDiv);r[0]&&$.datepicker._selectDay(e.target,t.selectedMonth,t.selectedYear,r[0]);var o=$.datepicker._get(t,"onSelect");if(o){var s=$.datepicker._formatDate(t);o.apply(t.input?t.input[0]:null,[s,t])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&$.datepicker._clearDate(e.target),n=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&$.datepicker._gotoToday(e.target),n=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,i?1:-1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?-$.datepicker._get(t,"stepBigMonths"):-$.datepicker._get(t,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,-7,"D"),n=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,i?-1:1,"D"),n=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&$.datepicker._adjustDate(e.target,e.ctrlKey?+$.datepicker._get(t,"stepBigMonths"):+$.datepicker._get(t,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&$.datepicker._adjustDate(e.target,7,"D"),n=e.ctrlKey||e.metaKey;break;default:n=!1}else 36==e.keyCode&&e.ctrlKey?$.datepicker._showDatepicker(this):n=!1;n&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(e){var t=$.datepicker._getInst(e.target);if($.datepicker._get(t,"constrainInput")){var n=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),i=String.fromCharCode(e.charCode==undefined?e.keyCode:e.charCode);return e.ctrlKey||e.metaKey||" ">i||!n||n.indexOf(i)>-1}},_doKeyUp:function(e){var t=$.datepicker._getInst(e.target);if(t.input.val()!=t.lastVal)try{var n=$.datepicker.parseDate($.datepicker._get(t,"dateFormat"),t.input?t.input.val():null,$.datepicker._getFormatConfig(t));n&&($.datepicker._setDateFromField(t),$.datepicker._updateAlternate(t),$.datepicker._updateDatepicker(t))}catch(i){$.datepicker.log(i)}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!=e.nodeName.toLowerCase()&&(e=$("input",e.parentNode)[0]),!$.datepicker._isDisabledDatepicker(e)&&$.datepicker._lastInput!=e){var t=$.datepicker._getInst(e);$.datepicker._curInst&&$.datepicker._curInst!=t&&($.datepicker._curInst.dpDiv.stop(!0,!0),t&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var n=$.datepicker._get(t,"beforeShow"),i=n?n.apply(e,[e,t]):{};if(i!==!1){extendRemove(t.settings,i),t.lastVal=null,$.datepicker._lastInput=e,$.datepicker._setDateFromField(t),$.datepicker._inDialog&&(e.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(e),$.datepicker._pos[1]+=e.offsetHeight);var r=!1;$(e).parents().each(function(){return r|="fixed"==$(this).css("position"),!r});var o={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};if($.datepicker._pos=null,t.dpDiv.empty(),t.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(t),o=$.datepicker._checkOffset(t,o,r),t.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":r?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),!t.inline){var s=$.datepicker._get(t,"showAnim"),a=$.datepicker._get(t,"duration"),u=function(){var e=t.dpDiv.find("iframe.ui-datepicker-cover");if(e.length){var n=$.datepicker._getBorders(t.dpDiv);e.css({left:-n[0],top:-n[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()})}};t.dpDiv.zIndex($(e).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&($.effects.effect[s]||$.effects[s])?t.dpDiv.show(s,$.datepicker._get(t,"showOptions"),a,u):t.dpDiv[s||"show"](s?a:null,u),(!s||!a)&&u(),t.input.is(":visible")&&!t.input.is(":disabled")&&t.input.focus(),$.datepicker._curInst=t}}}},_updateDatepicker:function(e){this.maxRows=4;var t=$.datepicker._getBorders(e.dpDiv);instActive=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e);var n=e.dpDiv.find("iframe.ui-datepicker-cover");!n.length||n.css({left:-t[0],top:-t[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()}),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i=this._getNumberOfMonths(e),r=i[1],o=17;if(e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),r>1&&e.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",o*r+"em"),e.dpDiv[(1!=i[0]||1!=i[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e==$.datepicker._curInst&&$.datepicker._datepickerShowing&&e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&e.input[0]!=document.activeElement&&e.input.focus(),e.yearshtml){var s=e.yearshtml;setTimeout(function(){s===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),s=e.yearshtml=null},0)}},_getBorders:function(e){var t=function(e){return{thin:1,medium:2,thick:3}[e]||e};return[parseFloat(t(e.css("border-left-width"))),parseFloat(t(e.css("border-top-width")))]},_checkOffset:function(e,t,n){var i=e.dpDiv.outerWidth(),r=e.dpDiv.outerHeight(),o=e.input?e.input.outerWidth():0,s=e.input?e.input.outerHeight():0,a=document.documentElement.clientWidth+(n?0:$(document).scrollLeft()),u=document.documentElement.clientHeight+(n?0:$(document).scrollTop());return t.left-=this._get(e,"isRTL")?i-o:0,t.left-=n&&t.left==e.input.offset().left?$(document).scrollLeft():0,t.top-=n&&t.top==e.input.offset().top+s?$(document).scrollTop():0,t.left-=Math.min(t.left,t.left+i>a&&a>i?Math.abs(t.left+i-a):0),t.top-=Math.min(t.top,t.top+r>u&&u>r?Math.abs(r+s):0),t},_findPos:function(e){for(var t=this._getInst(e),n=this._get(t,"isRTL");e&&("hidden"==e.type||1!=e.nodeType||$.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];var i=$(e).offset();return[i.left,i.top]},_hideDatepicker:function(e){var t=this._curInst;if(t&&(!e||t==$.data(e,PROP_NAME))&&this._datepickerShowing){var n=this._get(t,"showAnim"),i=this._get(t,"duration"),r=function(){$.datepicker._tidyDialog(t)};$.effects&&($.effects.effect[n]||$.effects[n])?t.dpDiv.hide(n,$.datepicker._get(t,"showOptions"),i,r):t.dpDiv["slideDown"==n?"slideUp":"fadeIn"==n?"fadeOut":"hide"](n?i:null,r),n||r(),this._datepickerShowing=!1;var o=this._get(t,"onClose");o&&o.apply(t.input?t.input[0]:null,[t.input?t.input.val():"",t]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if($.datepicker._curInst){var t=$(e.target),n=$.datepicker._getInst(t[0]);(t[0].id!=$.datepicker._mainDivId&&0==t.parents("#"+$.datepicker._mainDivId).length&&!t.hasClass($.datepicker.markerClassName)&&!t.closest("."+$.datepicker._triggerClass).length&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||t.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=n)&&$.datepicker._hideDatepicker()}},_adjustDate:function(e,t,n){var i=$(e),r=this._getInst(i[0]);this._isDisabledDatepicker(i[0])||(this._adjustInstDate(r,t+("M"==n?this._get(r,"showCurrentAtPos"):0),n),this._updateDatepicker(r))},_gotoToday:function(e){var t=$(e),n=this._getInst(t[0]);if(this._get(n,"gotoCurrent")&&n.currentDay)n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear;else{var i=new Date;n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()}this._notifyChange(n),this._adjustDate(t)},_selectMonthYear:function(e,t,n){var i=$(e),r=this._getInst(i[0]);r["selected"+("M"==n?"Month":"Year")]=r["draw"+("M"==n?"Month":"Year")]=parseInt(t.options[t.selectedIndex].value,10),this._notifyChange(r),this._adjustDate(i)},_selectDay:function(e,t,n,i){var r=$(e);if(!$(i).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(r[0])){var o=this._getInst(r[0]);o.selectedDay=o.currentDay=$("a",i).html(),o.selectedMonth=o.currentMonth=t,o.selectedYear=o.currentYear=n,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear))}},_clearDate:function(e){var t=$(e);this._getInst(t[0]),this._selectDate(t,"")},_selectDate:function(e,t){var n=$(e),i=this._getInst(n[0]);t=null!=t?t:this._formatDate(i),i.input&&i.input.val(t),this._updateAlternate(i);var r=this._get(i,"onSelect");r?r.apply(i.input?i.input[0]:null,[t,i]):i.input&&i.input.trigger("change"),i.inline?this._updateDatepicker(i):(this._hideDatepicker(),this._lastInput=i.input[0],"object"!=typeof i.input[0]&&i.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var t=this._get(e,"altField");if(t){var n=this._get(e,"altFormat")||this._get(e,"dateFormat"),i=this._getDate(e),r=this.formatDate(n,i,this._getFormatConfig(e));$(t).each(function(){$(this).val(r)})}},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t=new Date(e.getTime());t.setDate(t.getDate()+4-(t.getDay()||7));var n=t.getTime();return t.setMonth(0),t.setDate(1),Math.floor(Math.round((n-t)/864e5)/7)+1},parseDate:function(e,t,n){if(null==e||null==t)throw"Invalid arguments";if(t="object"==typeof t?""+t:t+"",""==t)return null;var i=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff;i="string"!=typeof i?i:(new Date).getFullYear()%100+parseInt(i,10);for(var r=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,o=(n?n.dayNames:null)||this._defaults.dayNames,s=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,a=(n?n.monthNames:null)||this._defaults.monthNames,u=-1,l=-1,c=-1,d=-1,f=!1,h=function(t){var n=e.length>y+1&&e.charAt(y+1)==t;return n&&y++,n},p=function(e){var n=h(e),i="@"==e?14:"!"==e?20:"y"==e&&n?4:"o"==e?3:2,r=RegExp("^\\d{1,"+i+"}"),o=t.substring(v).match(r);if(!o)throw"Missing number at position "+v;return v+=o[0].length,parseInt(o[0],10)},m=function(e,n,i){var r=$.map(h(e)?i:n,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)}),o=-1;if($.each(r,function(e,n){var i=n[1];return t.substr(v,i.length).toLowerCase()==i.toLowerCase()?(o=n[0],v+=i.length,!1):undefined}),-1!=o)return o+1;throw"Unknown name at position "+v},g=function(){if(t.charAt(v)!=e.charAt(y))throw"Unexpected literal at position "+v;v++},v=0,y=0;e.length>y;y++)if(f)"'"!=e.charAt(y)||h("'")?g():f=!1;else switch(e.charAt(y)){case"d":c=p("d");break;case"D":m("D",r,o);break;case"o":d=p("o");break;case"m":l=p("m");break;case"M":l=m("M",s,a);break;case"y":u=p("y");break;case"@":var b=new Date(p("@"));u=b.getFullYear(),l=b.getMonth()+1,c=b.getDate();break;case"!":var b=new Date((p("!")-this._ticksTo1970)/1e4);u=b.getFullYear(),l=b.getMonth()+1,c=b.getDate();break;case"'":h("'")?g():f=!0;break;default:g()}if(t.length>v){var _=t.substr(v);if(!/^\s+/.test(_))throw"Extra/unparsed characters found in date: "+_}if(-1==u?u=(new Date).getFullYear():100>u&&(u+=(new Date).getFullYear()-(new Date).getFullYear()%100+(i>=u?0:-100)),d>-1)for(l=1,c=d;;){var w=this._getDaysInMonth(u,l-1);if(w>=c)break;l++,c-=w}var b=this._daylightSavingAdjust(new Date(u,l-1,c));if(b.getFullYear()!=u||b.getMonth()+1!=l||b.getDate()!=c)throw"Invalid date";return b},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,n){if(!t)return"";var i=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,r=(n?n.dayNames:null)||this._defaults.dayNames,o=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,s=(n?n.monthNames:null)||this._defaults.monthNames,a=function(t){var n=e.length>f+1&&e.charAt(f+1)==t;return n&&f++,n},u=function(e,t,n){var i=""+t;if(a(e))for(;n>i.length;)i="0"+i;return i},l=function(e,t,n,i){return a(e)?i[t]:n[t]},c="",d=!1;if(t)for(var f=0;e.length>f;f++)if(d)"'"!=e.charAt(f)||a("'")?c+=e.charAt(f):d=!1;else switch(e.charAt(f)){case"d":c+=u("d",t.getDate(),2);break;case"D":c+=l("D",t.getDay(),i,r);break;case"o":c+=u("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":c+=u("m",t.getMonth()+1,2);break;case"M":c+=l("M",t.getMonth(),o,s);break;case"y":c+=a("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":c+=t.getTime();break;case"!":c+=1e4*t.getTime()+this._ticksTo1970;break;case"'":a("'")?c+="'":d=!0;break;default:c+=e.charAt(f)}return c},_possibleChars:function(e){for(var t="",n=!1,i=function(t){var n=e.length>r+1&&e.charAt(r+1)==t;return n&&r++,n},r=0;e.length>r;r++)if(n)"'"!=e.charAt(r)||i("'")?t+=e.charAt(r):n=!1;else switch(e.charAt(r)){case"d":case"m":case"y":case"@":t+="0123456789";break;case"D":case"M":return null;case"'":i("'")?t+="'":n=!0;break;default:t+=e.charAt(r)}return t},_get:function(e,t){return e.settings[t]!==undefined?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!=e.lastVal){var n,i,r=this._get(e,"dateFormat"),o=e.lastVal=e.input?e.input.val():null;n=i=this._getDefaultDate(e);var s=this._getFormatConfig(e);try{n=this.parseDate(r,o,s)||i}catch(a){this.log(a),o=t?"":o}e.selectedDay=n.getDate(),e.drawMonth=e.selectedMonth=n.getMonth(),e.drawYear=e.selectedYear=n.getFullYear(),e.currentDay=o?n.getDate():0,e.currentMonth=o?n.getMonth():0,e.currentYear=o?n.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(e,t,n){var i=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},r=function(t){try{return $.datepicker.parseDate($.datepicker._get(e,"dateFormat"),t,$.datepicker._getFormatConfig(e))}catch(n){}for(var i=(t.toLowerCase().match(/^c/)?$.datepicker._getDate(e):null)||new Date,r=i.getFullYear(),o=i.getMonth(),s=i.getDate(),a=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,u=a.exec(t);u;){switch(u[2]||"d"){case"d":case"D":s+=parseInt(u[1],10);break;case"w":case"W":s+=7*parseInt(u[1],10);break;case"m":case"M":o+=parseInt(u[1],10),s=Math.min(s,$.datepicker._getDaysInMonth(r,o));break;case"y":case"Y":r+=parseInt(u[1],10),s=Math.min(s,$.datepicker._getDaysInMonth(r,o))}u=a.exec(t)}return new Date(r,o,s)},o=null==t||""===t?n:"string"==typeof t?r(t):"number"==typeof t?isNaN(t)?n:i(t):new Date(t.getTime());return o=o&&"Invalid Date"==""+o?n:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,n){var i=!t,r=e.selectedMonth,o=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),(r!=e.selectedMonth||o!=e.selectedYear)&&!n&&this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(i?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""==e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(e){var t=this._get(e,"stepMonths"),n="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(n,-t,"M")},next:function(){window["DP_jQuery_"+dpuuid].datepicker._adjustDate(n,+t,"M")},hide:function(){window["DP_jQuery_"+dpuuid].datepicker._hideDatepicker()},today:function(){window["DP_jQuery_"+dpuuid].datepicker._gotoToday(n)},selectDay:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(n,this,"M"),!1},selectYear:function(){return window["DP_jQuery_"+dpuuid].datepicker._selectMonthYear(n,this,"Y"),!1}};$(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t=new Date;t=this._daylightSavingAdjust(new Date(t.getFullYear(),t.getMonth(),t.getDate()));var n=this._get(e,"isRTL"),i=this._get(e,"showButtonPanel"),r=this._get(e,"hideIfNoPrevNext"),o=this._get(e,"navigationAsDateFormat"),s=this._getNumberOfMonths(e),a=this._get(e,"showCurrentAtPos"),u=this._get(e,"stepMonths"),l=1!=s[0]||1!=s[1],c=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),d=this._getMinMaxDate(e,"min"),f=this._getMinMaxDate(e,"max"),h=e.drawMonth-a,p=e.drawYear;if(0>h&&(h+=12,p--),f){var m=this._daylightSavingAdjust(new Date(f.getFullYear(),f.getMonth()-s[0]*s[1]+1,f.getDate()));for(m=d&&d>m?d:m;this._daylightSavingAdjust(new Date(p,h,1))>m;)h--,0>h&&(h=11,p--)}e.drawMonth=h,e.drawYear=p;var g=this._get(e,"prevText");g=o?this.formatDate(g,this._daylightSavingAdjust(new Date(p,h-u,1)),this._getFormatConfig(e)):g;var v=this._canAdjustMonth(e,-1,p,h)?'<a class="ui-datepicker-prev ui-corner-all" data-handler="prev" data-event="click" title="'+g+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+g+"</span></a>":r?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+g+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"e":"w")+'">'+g+"</span></a>",y=this._get(e,"nextText");y=o?this.formatDate(y,this._daylightSavingAdjust(new Date(p,h+u,1)),this._getFormatConfig(e)):y;var b=this._canAdjustMonth(e,1,p,h)?'<a class="ui-datepicker-next ui-corner-all" data-handler="next" data-event="click" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>":r?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+y+'"><span class="ui-icon ui-icon-circle-triangle-'+(n?"w":"e")+'">'+y+"</span></a>",_=this._get(e,"currentText"),w=this._get(e,"gotoCurrent")&&e.currentDay?c:t;_=o?this.formatDate(_,w,this._getFormatConfig(e)):_;var x=e.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" data-handler="hide" data-event="click">'+this._get(e,"closeText")+"</button>",k=i?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(n?x:"")+(this._isInRange(e,w)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" data-handler="today" data-event="click">'+_+"</button>":"")+(n?"":x)+"</div>":"",C=parseInt(this._get(e,"firstDay"),10);C=isNaN(C)?0:C;for(var T=this._get(e,"showWeek"),E=this._get(e,"dayNames"),S=(this._get(e,"dayNamesShort"),this._get(e,"dayNamesMin")),D=this._get(e,"monthNames"),N=this._get(e,"monthNamesShort"),A=this._get(e,"beforeShowDay"),F=this._get(e,"showOtherMonths"),j=this._get(e,"selectOtherMonths"),M=(this._get(e,"calculateWeek")||this.iso8601Week,this._getDefaultDate(e)),O="",P=0;s[0]>P;P++){var I="";this.maxRows=4;for(var R=0;s[1]>R;R++){var q=this._daylightSavingAdjust(new Date(p,h,e.selectedDay)),L=" ui-corner-all",H="";if(l){if(H+='<div class="ui-datepicker-group',s[1]>1)switch(R){case 0:H+=" ui-datepicker-group-first",L=" ui-corner-"+(n?"right":"left");break;case s[1]-1:H+=" ui-datepicker-group-last",L=" ui-corner-"+(n?"left":"right");break;default:H+=" ui-datepicker-group-middle",L=""}H+='">'}H+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+L+'">'+(/all|left/.test(L)&&0==P?n?b:v:"")+(/all|right/.test(L)&&0==P?n?v:b:"")+this._generateMonthYearHeader(e,h,p,d,f,P>0||R>0,D,N)+'</div><table class="ui-datepicker-calendar"><thead>'+"<tr>";for(var z=T?'<th class="ui-datepicker-week-col">'+this._get(e,"weekHeader")+"</th>":"",B=0;7>B;B++){var U=(B+C)%7;z+="<th"+((B+C+6)%7>=5?' class="ui-datepicker-week-end"':"")+">"+'<span title="'+E[U]+'">'+S[U]+"</span></th>"}H+=z+"</tr></thead><tbody>";var W=this._getDaysInMonth(p,h);p==e.selectedYear&&h==e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,W));var V=(this._getFirstDayOfMonth(p,h)-C+7)%7,Y=Math.ceil((V+W)/7),X=l?this.maxRows>Y?this.maxRows:Y:Y;this.maxRows=X;for(var G=this._daylightSavingAdjust(new Date(p,h,1-V)),J=0;X>J;J++){H+="<tr>";for(var K=T?'<td class="ui-datepicker-week-col">'+this._get(e,"calculateWeek")(G)+"</td>":"",B=0;7>B;B++){var Q=A?A.apply(e.input?e.input[0]:null,[G]):[!0,""],Z=G.getMonth()!=h,et=Z&&!j||!Q[0]||d&&d>G||f&&G>f;K+='<td class="'+((B+C+6)%7>=5?" ui-datepicker-week-end":"")+(Z?" ui-datepicker-other-month":"")+(G.getTime()==q.getTime()&&h==e.selectedMonth&&e._keyEvent||M.getTime()==G.getTime()&&M.getTime()==q.getTime()?" "+this._dayOverClass:"")+(et?" "+this._unselectableClass+" ui-state-disabled":"")+(Z&&!F?"":" "+Q[1]+(G.getTime()==c.getTime()?" "+this._currentClass:"")+(G.getTime()==t.getTime()?" ui-datepicker-today":""))+'"'+(Z&&!F||!Q[2]?"":' title="'+Q[2]+'"')+(et?"":' data-handler="selectDay" data-event="click" data-month="'+G.getMonth()+'" data-year="'+G.getFullYear()+'"')+">"+(Z&&!F?"&#xa0;":et?'<span class="ui-state-default">'+G.getDate()+"</span>":'<a class="ui-state-default'+(G.getTime()==t.getTime()?" ui-state-highlight":"")+(G.getTime()==c.getTime()?" ui-state-active":"")+(Z?" ui-priority-secondary":"")+'" href="#">'+G.getDate()+"</a>")+"</td>",G.setDate(G.getDate()+1),G=this._daylightSavingAdjust(G)}H+=K+"</tr>"}h++,h>11&&(h=0,p++),H+="</tbody></table>"+(l?"</div>"+(s[0]>0&&R==s[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),I+=H}O+=I}return O+=k+($.ui.ie6&&!e.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),e._keyEvent=!1,O},_generateMonthYearHeader:function(e,t,n,i,r,o,s,a){var u=this._get(e,"changeMonth"),l=this._get(e,"changeYear"),c=this._get(e,"showMonthAfterYear"),d='<div class="ui-datepicker-title">',f="";if(o||!u)f+='<span class="ui-datepicker-month">'+s[t]+"</span>";else{var h=i&&i.getFullYear()==n,p=r&&r.getFullYear()==n;f+='<select class="ui-datepicker-month" data-handler="selectMonth" data-event="change">';for(var m=0;12>m;m++)(!h||m>=i.getMonth())&&(!p||r.getMonth()>=m)&&(f+='<option value="'+m+'"'+(m==t?' selected="selected"':"")+">"+a[m]+"</option>");f+="</select>"}if(c||(d+=f+(!o&&u&&l?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",o||!l)d+='<span class="ui-datepicker-year">'+n+"</span>";else{var g=this._get(e,"yearRange").split(":"),v=(new Date).getFullYear(),y=function(e){var t=e.match(/c[+-].*/)?n+parseInt(e.substring(1),10):e.match(/[+-].*/)?v+parseInt(e,10):parseInt(e,10);return isNaN(t)?v:t},b=y(g[0]),_=Math.max(b,y(g[1]||""));for(b=i?Math.max(b,i.getFullYear()):b,_=r?Math.min(_,r.getFullYear()):_,e.yearshtml+='<select class="ui-datepicker-year" data-handler="selectYear" data-event="change">';_>=b;b++)e.yearshtml+='<option value="'+b+'"'+(b==n?' selected="selected"':"")+">"+b+"</option>";
e.yearshtml+="</select>",d+=e.yearshtml,e.yearshtml=null}return d+=this._get(e,"yearSuffix"),c&&(d+=(!o&&u&&l?"":"&#xa0;")+f),d+="</div>"},_adjustInstDate:function(e,t,n){var i=e.drawYear+("Y"==n?t:0),r=e.drawMonth+("M"==n?t:0),o=Math.min(e.selectedDay,this._getDaysInMonth(i,r))+("D"==n?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(i,r,o)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),("M"==n||"Y"==n)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var n=this._getMinMaxDate(e,"min"),i=this._getMinMaxDate(e,"max"),r=n&&n>t?n:t;return r=i&&r>i?i:r},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,n,i){var r=this._getNumberOfMonths(e),o=this._daylightSavingAdjust(new Date(n,i+(0>t?t:r[0]*r[1]),1));return 0>t&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(e,o)},_isInRange:function(e,t){var n=this._getMinMaxDate(e,"min"),i=this._getMinMaxDate(e,"max");return(!n||t.getTime()>=n.getTime())&&(!i||t.getTime()<=i.getTime())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,n,i){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var r=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(i,n,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),r,this._getFormatConfig(e))}}),$.fn.datepicker=function(e){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find(document.body).append($.datepicker.dpDiv),$.datepicker.initialized=!0);var t=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!=e&&"getDate"!=e&&"widget"!=e?"option"==e&&2==arguments.length&&"string"==typeof arguments[1]?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t)):this.each(function(){"string"==typeof e?$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this].concat(t)):$.datepicker._attachDatepicker(this,e)}):$.datepicker["_"+e+"Datepicker"].apply($.datepicker,[this[0]].concat(t))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="1.9.2",window["DP_jQuery_"+dpuuid]=$}(jQuery),function(e){var t=!1;e.widget("ui.menu",{version:"1.9.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(n){var i=e(n.target).closest(".ui-menu-item");!t&&i.not(".ui-state-disabled").length&&(t=!0,this.select(n),i.has(".ui-menu").length?this.expand(n):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var n=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,n)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(n){e(n.target).closest(".ui-menu").length||this.collapseAll(n),t=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function n(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var i,r,o,s,a,u=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:u=!1,r=this.previousFilter||"",o=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),o===r?s=!0:o=r+o,a=RegExp("^"+n(o),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return a.test(e(this).children("a").text())}),i=s&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i,i.length||(o=String.fromCharCode(t.keyCode),a=RegExp("^"+n(o),"i"),i=this.activeMenu.children(".ui-menu-item").filter(function(){return a.test(e(this).children("a").text())})),i.length?(this.focus(t,i),i.length>1?(this.previousFilter=o,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}u&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,n=this.options.icons.submenu,i=this.element.find(this.options.menus);i.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.prev("a"),r=e("<span>").addClass("ui-menu-icon ui-icon "+n).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(r),t.attr("aria-labelledby",i.attr("id"))}),t=i.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(e,t){var n,i;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),i=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",i.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),n=t.children(".ui-menu"),n.length&&/^mouse/.test(e.type)&&this._startOpening(n),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var n,i,r,o,s,a;this._hasScroll()&&(n=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,i=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,r=t.offset().top-this.activeMenu.offset().top-n-i,o=this.activeMenu.scrollTop(),s=this.activeMenu.height(),a=t.height(),0>r?this.activeMenu.scrollTop(o+r):r+a>s&&this.activeMenu.scrollTop(o+r-s+a))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var n=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var i=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));i.length||(i=this.element),this._close(i),this.blur(t),this.activeMenu=i},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var i;this.active&&(i="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),i&&i.length&&this.active||(i=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(n,i)},nextPage:function(t){var n,i,r;return this.active?(this.isLastItem()||(this._hasScroll()?(i=this.active.offset().top,r=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return n=e(this),0>n.offset().top-i-r}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())),void 0):(this.next(t),void 0)},previousPage:function(t){var n,i,r;return this.active?(this.isFirstItem()||(this._hasScroll()?(i=this.active.offset().top,r=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return n=e(this),n.offset().top-i+r>0}),this.focus(t,n)):this.focus(t,this.activeMenu.children(".ui-menu-item").first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var n={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,n)}})}(jQuery),define("plugins/jquery.ui/jquery-ui-1.9.2.custom.min",function(){}),define("jqueryUi",["plugins/jquery.ui/jquery-ui-1.9.2.custom.min"],function(){(function(e,t,n){var i,r=e.getElementsByTagName(t)[0];e.getElementById(n)||(i=e.createElement(t),i.id=n,i.href=window.STATIC_FILE_HOST+"js/plugins/jquery.ui/jquery-ui-1.9.2.custom.min.css",i.rel="stylesheet",r.parentNode.insertBefore(i,r))})(document,"link","jqueryUi_style")}),define("views/common/autocomplete-box/autocomplete",["jquery","underscore","backbone","views/common/autocomplete-box/menu-item/normal","views/common/autocomplete-box/result-item/email-search-result-item","modules/user/email-receiver","text!templates/common/autocomplete-box/autocomplete.html","jqueryUi"],function(e,t,n,i,r,o,s){var a=1;return function(u){var l=s;t.isObject(u)&&t.isString(u.template)&&(l=u.template);var c={email:function(t,n){var i=RegExp(/[_a-zA-Z\d\-\.]+@[_a-zA-Z\d\-]+(\.[_a-zA-Z\d\-]+)+$/);if(i.test(t.term))if("function"==typeof afterSource){var r={email:e.trim(t.term)};afterSource(r,function(){n([{model:{type:"email",id:e.trim(t.term),email_address:e.trim(t.term)}}])})}else n([{model:{type:"email",id:e.trim(t.term),email_address:e.trim(t.term)}}])},user:function(t,n){var i=this,r=i.options.settings.afterSource.user;e.get("api/search_user/",{keyword:t.term,limit:5},function(e){e.result&&e.data.length>0&&("function"==typeof r?r(e,function(){n(e.data)}):n(e.data))})}};return n.View.extend({events:{"keydown .receiver_search_box":"keyDownHandler"},template:l,initialize:function(t){var n={tagName:"div",className:"block-autocomplete-box",target:".receiver_search_box",placeholder:"Enter email address or CN number then CLICK on the correct option",clearTarget:!0,autoFocus:!0,delay:500,searchTypes:["user","email"],sources:c,beforeSource:{},afterSource:{},afterSelect:{},menuItem:{model:o,view:i},resultItem:{model:o,view:r,afterSelect:function(e,t){this.$(".receiver_search_box").before(t)}}};this.options.settings=e.extend(!0,n,t),c=e.extend(!0,{},this.options.settings.sources,c),this.el.className=this.options.settings.className,this.$el.tagName=this.options.settings.tagName},serialize:function(){return{placeholder:this.options.settings.placeholder}},afterRender:function(){var n=this,i=this.options.settings,r=i.target;n.$(r).autocomplete({autoFocus:i.autoFocus,select:function(r,o){var s=i.resultItem,u=function(n,i,r){var o=this;t.isFunction(n)?n.call(o,i,r):t.isObject(n)&&t.has(n,"view")&&t.has(n,"model")&&(e.extend(r.item.model,{receivers_len:a++}),o.insertView(new n.view({model:new n.model(r.item.model),append:function(e,t){n.afterSelect.call(o,e,t)}})).render())};return"function"==typeof i.afterSelect?i.afterSelect(r,o,function(){u.call(n,s,r,o)}):u.call(n,s,r,o),i.clearTarget&&e(r.target).val(""),!1},source:function(r,o){if(0!=e.trim(r.term).length){var s=n.getSources();for(var a in s)t.isFunction(i.beforeSource[a])?i.beforeSource[a].call(n,s[a],r,o):s[a].call(n,r,o)}},change:function(){e("#"+i.menuId).find("li:first").click().empty()}}).each(function(){var r=i.menuItem;t.isFunction(r)?e(this).data("autocomplete")._renderItem=function(t,o){return i.menuId=e(t).attr("id"),r.call(n,t,o)}:t.isObject(r)&&(e(this).data("autocomplete")._renderItem=function(t,n){return i.menuId=e(t).attr("id"),e("<li>").append(e("<a>").html(new r.view({model:new r.model(n.model)}).render().view.el)).appendTo(t)})}),this.$el.on("click",function(){return n.$(r).focus(),!1}),this.$(r).on("blur",function(){var t=this;setTimeout(function(){0==n.$(".email_search_result_item").length&&(e(t).attr("placeholder",e(t).attr("title")),e(t).addClass("input-box"))},100)})},keyDownHandler:function(t){this.options.settings;var n=e.ui.keyCode;return t.keyCode==n.BACKSPACE&&""==e(t.currentTarget).val()?(this.$(".email_search_result_item:last").remove(),!1):(e(t.currentTarget).attr("placeholder",""),e(t.currentTarget).removeClass("input-box"),!0)},getSources:function(){var e={},t=this.options.settings,n=t.searchTypes;for(var i in n)e[n[i]]=c[n[i]];return e}})}}),define("modules/email",["jquery","underscore","backbone","modules/me"],function(e,t,n,i){var r=n.Model.extend({urlRoot:"api/email/",defaults:function(){var e=new i;return{type:"normal",sender:{type:"user",id:e.get("id")},receivers:{}}},initDefaults:function(){var e=this.get("receivers"),n=this.get("sender"),i=!1,r=!1;for(var o in e)if(e.hasOwnProperty(o)&&e[o].model){var s=!1;"cc"==e[o].model.receive_type&&(s=!0,i=!0),e[o].model.is_cc=s;var a=!1;("user"==e[o].type||"group"==e[o].type)&&(a=!0),e[o].model.is_user=a,n.id==e[o].model.id&&(r=!0),o==e.length-1&&(e[o].model.is_last=!0)}return t.extend({receivers:e,has_cc:i,is_send_to_me:r})}});return r}),define("modules/user-detection",["jquery","underscore","backbone"],function(e,t,n){return n.Model.extend({urlRoot:"api/user_detection/"})}),define("modules/course/course-user-position",["jquery","underscore","backbone"],function(e,t,n){return n.Model.extend({urlRoot:"api/course_user_position/"})}),define("text!templates/common/pop-up-window/invite-friend-join-club.html",[],function(){return'<div class="head">\r\n	<h4>Invite friends</h4>\r\n</div>\r\n<div class="main">\r\n    <form>\r\n        <input type="hidden" name="type" value="course_invite"/>\r\n        <input type="hidden" name="sender[type]" value="user"/>\r\n        <input type="hidden" name="sender[id]" value="{{sender_id}}"/>\r\n        <input type="hidden" name="data[course_id]" value="{{course_id}}"/>\r\n        <input type="hidden" name="data[id]" value="{{course_id}}"/>\r\n        <input type="hidden" name="data[type]" value="course"/>\r\n		<table>\r\n			<tbody>\r\n				<tr>\r\n					<td>\r\n						<label for="">\r\n							To:\r\n						</label>\r\n					</td>\r\n					<td class="input-wrap cn_number_input receivers_input">\r\n						\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td></td>\r\n					<td>\r\n                        <div class="l-float radio-wrap">\r\n							<input class="raido_tag" id="other" type="radio" name="option" value="email" checked="checked" />\r\n							<label for="other">Not CN Member</label>\r\n							<div class="clear"></div>\r\n						</div>\r\n						<div class="l-float radio-wrap">\r\n                            <input class="raido_tag" id="cn_number" type="radio" name="option" value="user" />\r\n							<label for="cn_number">CN Member</label>\r\n							<div class="clear"></div>\r\n						</div>\r\n						<div class="clear"></div>\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td></td>\r\n					<td>\r\n						<div class="block-invite-email-body">\r\n							<textarea class="user display-none" name="content">{{current_name}} at {{school_name}} would like to invite you to join {{name}}. Please sign in to your CN account and click on the request alert icon locate on the top of your screen to accept the invitation.\r\n\r\nIf you have any questions about the Course, please reply to this email. As always, we welcome your questions and comments. Please contact us at help@thecn.com.</textarea>\r\n							<textarea class="email"  _name="content">{{current_name}} at {{school_name}} would like to invite you to join {{name}}. Please click on the link below and proceed to registration. \r\n\r\n[http://www.thecn.com/site/register/course_id/xxxxxx/email_id/xxxxxx/email/xxx@xxx.com/code/xxxxxxxx]\r\nIf you have any questions about the Course, please reply to this email. As always, we welcome your questions and comments. Please contact us at help@thecn.com.</textarea>\r\n						</div>\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td>\r\n						\r\n					</td>\r\n					<td>\r\n						<div class="r-float opera-wrap">\r\n							<button id="send" class="bt bt-blue-2 bt-size-normal" type="submit">SEND</button>\r\n							<button class="bt bt-gray bt-size-normal cancel" type="button">CANCEL</button>\r\n						</div>\r\n						<div class="clear"></div>\r\n					</td>\r\n				</tr>\r\n			</tbody>\r\n		</table>\r\n	</form>\r\n</div>'}),function(e){e.fn.serializeObject=function(t){t=e.extend({},t);var n=this,i={},r={},o={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/};return this.build=function(e,t,n){return e[t]=n,e},this.push_counter=function(e){return void 0===r[e]&&(r[e]=0),r[e]++},e.each(e(this).serializeArray(),function(){if(o.validate.test(this.name)){for(var t,r=this.name.match(o.key),s=this.value,a=this.name;void 0!==(t=r.pop());)a=a.replace(RegExp("\\["+t+"\\]$"),""),t.match(o.push)?s=n.build([],n.push_counter(a),s):t.match(o.fixed)?s=n.build([],t,s):t.match(o.named)&&(s=n.build({},t,s));i=e.extend(!0,i,s)}}),i}}(jQuery),define("jquerySerializeObject",function(){}),define("views/common/pop-up-window/invite-friend-join-club",["jquery","underscore","backbone","tools/regs","tools/pop-up-window","views/common/autocomplete-box/autocomplete","modules/email","modules/me","modules/user-detection","modules/course/course-user-position","text!templates/common/pop-up-window/invite-friend-join-club.html","jquerySerializeObject"],function(e,t,n,i,r,o,s,a,u,l,c){var d={email:"Enter email address then CLICK on the correct option",user:"Enter CN number then CLICK on the correct option"};return r.get("view").extend({className:"block-window-invite-join-club pop-up-window",template:c,events:{"click .cancel":"deleted","click #send":"save","change .raido_tag":"changeContent"},initialize_:function(e){t.bindAll(this,"changeContent"),this.model=new s;var n=new a;this.data={school_name:e.data.get("school").name,name:e.data.get("name")+" Course",current_name:n.get("display_name"),sender_id:n.get("id"),course_id:e.data.get("id")},this.receiversItemView=new(o())({searchTypes:["email"],placeholder:d.email,beforeSource:{email:function(e,t,n){if(i.check("email",t.term)){var r=new u;r.addUrlParam({detect_method:"email",value:t.term}),r.fetch({resultTrue:function(e){alert(t.term+"("+e.get("cn_number")+") already exists.")},resultFalse:function(){e(t,n)}})}}}}),this.insertView(".receivers_input",this.receiversItemView),this.parent={},e&&e.parent&&(this.parent=e.parent)},serialize:function(){return this.data},save:function(t){if(e(t.currentTarget).attr("locked"))return!1;e(t.currentTarget).attr("locked","locked");var n=this;return n.model.save(n.$("form").serializeObject(),{wait:!0,resultTrue:function(){r.get("function").alert("Your email has been sent.")},completeCallback:function(){e(t.currentTarget).removeAttr("locked")}}),!1},changeContent:function(t){var n=this,r=this.$(t.currentTarget);this.$("textarea").each(function(){e(this).hide();var t=e(this).attr("name");e(this).attr("_name",t),e(this).removeAttr("name")}),e("."+r.val()).show();var s=e("."+r.val()).attr("_name");e("."+r.val()).attr("name",s),e("."+r.val()).removeAttr("_name");var a=new(o())({searchTypes:[r.val()],placeholder:d[r.val()],beforeSource:{email:function(e,t,n){if(i.check("email",t.term)){var r=new u;r.addUrlParam({detect_method:"email",value:t.term}),r.fetch({resultTrue:function(e){alert(t.term+"("+e.get("cn_number")+") already exists.")},resultFalse:function(){e(t,n)}})}}},afterSelect:function(e,t,i){if(t&&t.item&&t.item.model){var r=t.item.model,o=n.parent.model,s=new l({id:o.get("id")});s.addUrlParam({user_id:r.id}),s.fetch({resultTrue:function(e){alert(r.display_name+" is "+e.get("user_position")+" in "+o.get("display_name")+".")},resultFalse:function(){"function"==typeof i&&i()}})}else i()}});this.$(".receivers_input").empty().append(a.render().view.el)}})}),define("text!templates/common/pop-up-window/oncourse-message.html",[],function(){return'<div class="head">\n	<h4>Message</h4>\n</div>\n<div class="main">\n    <div class="block-invite-oncourse-body">\n        Please instruct your students to join the CN by clicking on the CourseNetworking tab in Oncourse. Invite is intended for individuals who have not registered for your course through IU (and, therefore, do not have an IU user ID). For example, if you want a guest to join your CN Course, such as a colleague or a community partner, use this tool.\n    </div>\n    <div class="opera-wrap">\n        <button id="invite" class="bt bt-gray bt-size-normal">INVITE</button>\n        <button class="bt bt-blue-2 bt-size-normal cancel" type="button">CANCEL</button>\n    </div>\n</div>'}),define("views/common/pop-up-window/oncourse-message",["jquery","underscore","backbone","tools/pop-up-window","views/common/pop-up-window/invite-friend-join-club","text!templates/common/pop-up-window/oncourse-message.html"],function(e,t,n,i,r,o){return i.get("view").extend({className:"block-window-invite-join-oncourse pop-up-window",template:o,events:{"click .cancel":"deleted","click #invite":"invite"},initialize_:function(e){this.parent={},e&&e.parent&&(this.parent=e.parent)},invite:function(){var e=this;return i.get("function").open(new r({data:e.model,parent:e.parent}).render().view.el),!1}})}),define("modules/user/course-user",["jquery","underscore","backbone","tools/string-help"],function(e,t,n,i){return n.Model.extend({urlRoot:"api/course_user/",defaults:function(){return{score:{sub_total_seeds:0,sub_total:0}}},initDefaults:function(){var e=this,n=e.get("score");n=t.extend(n,{display_sub_total:i.addCommas(n.sub_total)});var r={score:n};return t.extend({},r)}})}),define("text!templates/course/common/sidebar/operate.html",[],function(){return'<div class="main">\n    <div class="top">\n        <div class="title">\n            {{#has_join}}\n            <b>\n                {{display_user_position_sentence}}.\n            </b>\n            {{/has_join}}\n            {{^has_join}}\n                <b>Register Type:</b>\n                {{#is_open_type}}\n                <span>Any CN member</span>\n                {{/is_open_type}}\n                 \n                {{#is_email_type}}\n                <span>Email Request</span>\n                {{/is_email_type}}\n                \n                 {{#is_code_type}}\n                <span>Code Request</span>\n                {{/is_code_type}}\n                \n                {{#is_no_one_type}}\n                <span>No one can join now.</span>\n                {{/is_no_one_type}}\n                \n                {{#is_fee_type}}\n                <span>Need Fee!</span>\n                {{/is_fee_type}}\n            {{/has_join}}\n        </div>\n        {{^has_join}}\n        <div class="body">\n            {{#is_open_type}}\n            <a class="bt-clubs bt-join" id="join" href="javascript:;">\n                JOIN\n            </a>\n            {{/is_open_type}}\n            \n            {{#is_email_type}}\n            <a class="bt-clubs bt-join" href="javascript:;" id="send_email">\n                SEND\n            </a>\n            {{/is_email_type}}\n            \n            {{#is_code_type}}\n            <div class="pin-wrap">\n                <a class="bt-clubs bt-join" id="join" href="javascript:;">\n                    JOIN\n                </a>\n                <input class="input-clubs" id="code" type="password" placeholder="Input PIN" />\n                <div class="clear"></div>\n            </div>\n            {{/is_code_type}}\n        </div>\n        {{/has_join}}\n    </div>\n    {{#has_join}}\n    <div class="bottom">\n        {{#can_invite}}\n        <a class="l-float text invite_join_course" href="javascript:;">\n             Invite\n        </a>\n        {{/can_invite}}\n         <a class="l-float text" id="drop" href="javascript:;">Drop</a>\n         <div class="clear"></div>\n    </div>\n    {{/has_join}}\n</div>\n'}),define("views/course/common/sidebar/operate",["jquery","underscore","backbone","controller","tools/pop-up-window","views/common/float-box/float-box-top","views/common/pop-up-window/invite-friend-join-club","views/common/pop-up-window/oncourse-message","modules/user/course-user","modules/me","text!templates/course/common/sidebar/operate.html"],function(e,t,n,i,r,o,s,a,u,l,c){var d=r.get("function");return n.View.extend({className:"block-course-operate",template:c,initialize:function(){this.model.on("change:has_join",this.render,this),this.model.on("change:display_user_position",this.render,this)},serialize:function(){return this.model.toJSON()},events:{"click .invite_join_course":"loadInviteJoinCourseView","click #join":"join","click #drop":"drop","click #send_email":"sendEmail"},afterRender:function(){new o({view:'<div style="padding: 5px; color: red; width:200px; hight:20px; font-size:14px;">Click here to join this course.</div>',target:e("#block_sidebar").find("#join"),arrow:{offset:35},delay:5e3}).show()},loadInviteJoinCourseView:function(){var e=this,t=new l,n="";n="oncourse"===t.get("create_from")||"oncourse"===e.model.get("create_from")?new a({model:e.model,parent:e}):new s({data:e.model,parent:e}),d.open(n.render().view.el)},sendEmail:function(){var e=this;d.confirm({content:"Are you sure you want to send a request to join "+e.model.get("display_name"),yesCallBack:function(){var t=new u;t.save({id:e.model.get("id")},{resultTrue:function(){d.alert("Your request to join "+e.model.get("display_name")+" has been sent.")}})}})},join:function(){var t=this,n="";n=e.trim(this.$("#code").val());var r=new u;r.save({id:t.model.get("id"),user_auth:{value:n}},{resultTrue:function(){t.model.set({has_join:!0}),t.model.set({display_user_position:"Student"}),d.alert("You have successfully joined "+t.model.get("display_name")+". You will now be directed to the course.",{autoCloseDownTime:3e3}),setTimeout(function(){i.go(t.model.get("course_id"))},3e3)},resultFalse:function(){d.alert("Please enter the PIN to join this course.",{autoCloseDownTime:3e3})}})},drop:function(){var e=this;d.confirm({content:"Are you sure you want to drop this Course?",yesCallBack:function(){var t=new u({id:e.model.get("id")});t.destroy({resultTrue:function(){e.model.set({has_join:!1}),e.model.set({can_manager:!1}),d.alert("Course dropped successfully.",{autoCloseDownTime:3e3}),setTimeout(function(){i.go("user")},3e3)}})}})}})}),define("modules/conexus/conexus-user-position",["jquery","underscore","backbone"],function(e,t,n){return n.Model.extend({urlRoot:"api/conexus_user_position/"})}),define("text!templates/common/pop-up-window/invite-friend-join-conexus.html",[],function(){return'<div class="head">\r\n	<h4>Invite friends</h4>\r\n</div>\r\n<div class="main">\r\n    <form>\r\n        <input type="hidden" name="type" value="conexus_invite"/>\r\n        <input type="hidden" name="sender[type]" value="user"/>\r\n        <input type="hidden" name="sender[id]" value="{{sender.id}}"/>\r\n        <input type="hidden" name="data[id]" value="{{conexus.id}}"/>\r\n        <input type="hidden" name="data[type]" value="conexus"/>\r\n		<table>\r\n			<tbody>\r\n				<tr>\r\n					<td>\r\n						<label for="">\r\n							To:\r\n						</label>\r\n					</td>\r\n					<td class="input-wrap cn_number_input receivers_input">\r\n						\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td></td>\r\n					<td>\r\n                        <div class="l-float radio-wrap">\r\n							<input class="raido_tag" id="other" type="radio" name="option" value="email" checked="checked"/>\r\n							<label for="other"> Not CN Member</label>\r\n							<div class="clear"></div>\r\n						</div>\r\n						<div class="l-float radio-wrap">\r\n                            <input class="raido_tag" id="cn_number" type="radio" name="option" value="user" />\r\n							<label for="cn_number">CN Member</label>\r\n							<div class="clear"></div>\r\n						</div>\r\n						<div class="clear"></div>\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td></td>\r\n					<td>\r\n						<div class="block-invite-email-body">\r\n							<textarea class="user display-none" name="content">{{sender.name}} would like to invite you to join {{conexus.name}} Conexus. Please sign in to your CN account and click on the request alert icon locate on the top of your screen to accept the invitation.\r\n\r\nIf you have any questions about the Conexus, please reply to this email. As always, we welcome your questions and comments. Please contact us at help@thecn.com.</textarea>\r\n							<textarea class="email"  _name="content">{{sender.name}} would like to invite you to join {{conexus.name}} Conexus. Please click on the link below and proceed to registration. \r\n\r\n[http://www.thecn.com/site/register/conexus_id/xxxxxx/email_id/xxxxxx/email/xxx@xxx.com/code/xxxxxxxx]\r\nIf you have any questions about the Conexus, please reply to this email. As always, we welcome your questions and comments. Please contact us at help@thecn.com.</textarea>\r\n						</div>\r\n					</td>\r\n				</tr>\r\n				<tr>\r\n					<td>\r\n						\r\n					</td>\r\n					<td>\r\n						<div class="r-float opera-wrap">\r\n							<button id="send" class="bt bt-blue-2 bt-size-normal" type="submit">SEND</button>\r\n							<button class="bt bt-gray bt-size-normal cancel" type="button">CANCEL</button>\r\n						</div>\r\n						<div class="clear"></div>\r\n					</td>\r\n				</tr>\r\n			</tbody>\r\n		</table>\r\n	</form>\r\n</div>'
}),define("views/common/pop-up-window/invite-friend-join-conexus",["jquery","underscore","backbone","tools/regs","tools/pop-up-window","views/common/autocomplete-box/autocomplete","modules/email","modules/me","modules/user-detection","modules/conexus/conexus-user-position","text!templates/common/pop-up-window/invite-friend-join-conexus.html","jquerySerializeObject"],function(e,t,n,i,r,o,s,a,u,l,c){new a;var d={email:"Enter email address then CLICK on the correct option",user:"Enter CN number then CLICK on the correct option"};return r.get("view").extend({className:"block-window-invite-join-club pop-up-window",template:c,events:{"click .cancel":"deleted","click #send":"save","change .raido_tag":"changeContent"},initialize_:function(e){t.bindAll(this,"changeContent"),this.model=new s;var n=new a,r=e.data;this.data={sender:{id:n.get("id"),name:n.get("display_name")},conexus:{id:r.get("id"),name:r.get("name")}},this.receiversItemView=new(o())({searchTypes:["email"],beforeSource:{email:function(e,t,n){if(i.check("email",t.term)){var r=new u;r.addUrlParam({detect_method:"email",value:t.term}),r.fetch({resultTrue:function(e){alert(t.term+"("+e.get("cn_number")+") already exists.")},resultFalse:function(){e(t,n)}})}}}}),this.insertView(".receivers_input",this.receiversItemView),this.parent={},e&&e.parent&&(this.parent=e.parent)},serialize:function(){return this.data},save:function(t){if(e(t.currentTarget).attr("locked"))return!1;e(t.currentTarget).attr("locked","locked");var n=this;return n.model.save(n.$("form").serializeObject(),{wait:!0,resultTrue:function(){r.get("function").alert("Your email has been sent.")},completeCallback:function(){e(t.currentTarget).removeAttr("locked")}}),!1},changeContent:function(t){var n=this,r=this.$(t.currentTarget);this.$("textarea").each(function(){e(this).hide();var t=e(this).attr("name");e(this).attr("_name",t),e(this).removeAttr("name")}),e("."+r.val()).show();var s=e("."+r.val()).attr("_name");e("."+r.val()).attr("name",s),e("."+r.val()).removeAttr("_name");var a=new(o())({searchTypes:[r.val()],placeholder:d[r.val()],beforeSource:{email:function(e,t,n){if(i.check("email",t.term)){var r=new u;r.addUrlParam({detect_method:"email",value:t.term}),r.fetch({resultTrue:function(e){alert(t.term+"("+e.get("cn_number")+") already exists.")},resultFalse:function(){e(t,n)}})}}},afterSource:{user:function(e,t){if(e.result&&e.data&&e.data.length>0){var i=e.data[0].model,r=n.parent.model,o=new l({id:r.get("id")});o.addUrlParam({user_id:i.id}),o.fetch({resultTrue:function(e){alert(i.display_name+" is "+e.get("user_position")+" in "+r.get("display_name")+".")},resultFalse:function(){"function"==typeof t&&t()}})}}}});this.$(".receivers_input").empty().append(a.render().view.el)}})}),define("modules/user/conexus-user",["jquery","underscore","backbone","tools/string-help"],function(e,t,n,i){return n.Model.extend({urlRoot:"api/conexus_user/",defaults:function(){return{score:{sub_total_seeds:0,sub_total:0}}},initDefaults:function(){var e=this,n=e.get("score");n=t.extend(n,{display_sub_total:i.addCommas(n.sub_total)});var r={score:n};return t.extend({},r)}})}),define("text!templates/conexus/common/sidebar/operate.html",[],function(){return'<div class="main">\n    <div class="top">\n        <div class="title">\n            {{#has_join}}\n            <b>\n                You\'re a {{display_user_position}} in this Conexus.\n            </b>\n            {{/has_join}}\n            {{^has_join}}\n            <b>Register Type:</b>\n            <span>Any CN member</span>\n            {{/has_join}}\n        </div>\n        {{^has_join}}\n        <div class="body">\n            <a class="bt-clubs bt-join" id="join"  href="javascript:;">JOIN</a>\n        </div>\n        {{/has_join}}\n    </div>\n    {{#has_join}}\n    <div class="bottom">\n        <a class="l-float text invite_join_conexus" href="javascript:;"> \n            Invite\n        </a>\n        <a class="l-float text" id="drop"  href="javascript:;">\n            Drop\n        </a>\n        <div class="clear"></div>\n    </div>\n    {{/has_join}}\n</div>\n'}),define("views/conexus/common/sidebar/operate",["jquery","underscore","backbone","controller","tools/pop-up-window","views/common/pop-up-window/invite-friend-join-conexus","modules/user/conexus-user","text!templates/conexus/common/sidebar/operate.html"],function(e,t,n,i,r,o,s,a){var u=r.get("function");return n.View.extend({className:"block-course-operate",template:a,events:{"click #join":"join","click #drop":"drop","click .invite_join_conexus":"load"},initialize:function(){this.model.on("change:has_join",this.render,this),this.model.on("change:display_user_position",this.render,this)},serialize:function(){return this.model.toJSON()},load:function(){u.open(new o({data:this.model,parent:this}).render().view.el)},join:function(){var e=this,t=new s;t.save({id:e.model.get("id")},{resultTrue:function(){e.model.set({has_join:!0}),e.model.set({display_user_position:"Member"}),u.alert("You have successfully joined this Conexus, you will now be directed to this Conexus.",{autoCloseDownTime:3e3}),setTimeout(function(){i.go(e.model.get("conexus_id"))},3e3)}})},drop:function(){var e=this;u.confirm({content:"Are you sure you want to drop this Conexus?",yesCallBack:function(){var t=new s({id:e.model.get("id")});t.destroy({resultTrue:function(){e.model.set({has_join:!1}),e.model.set({can_manager:!1}),u.alert("Conexus dropped successfully.",{autoCloseDownTime:3e3}),setTimeout(function(){i.go("user")},3e3)}})}})}})}),define("modules/user/cn-number",["jquery","underscore","modules/user/user"],function(e,t,n){return n.extend({urlRoot:"api/cn_number/"})}),define("modules/course/course",["jquery","underscore","backbone","tools/string-help"],function(e,t,n,i){return n.Model.extend({urlRoot:"api/course/",defaults:function(){return t.extend({type:"school_based",name:"",country_id:"",school_id:"",level:1,course_category_name:"",start_course_date:"",end_course_date:"",access_setting_id:"open",logo_url:"img/common/avatar/logo/default.png",country:{id:""},user_position:"",school:{url:""},instructors:[],instructional_users:[],user_score:{sub_total:0},create_from:"",tasks:[],allow_mooc:!1,enable_mooc:!1,is_end:!1},this.defaults_())},defaults_:function(){},initDefaults:function(){var n=this,r=["instructor","creater","assistant","coordinator","teaching_assistant","graduate_assistant","external_reviewer","instructional_designer","librarian"],o=n.get("user_score");o=t.extend(o,{display_sub_total:i.addCommas(o.sub_total)});var s={user_score:o},a=this.get("school");t.isString(a.url)&&a.url.length>0&&(a.url="http://"+a.url.replace(/http:\/\//,""));var u=e.inArray(n.get("user_position"),r)>-1,l=this.get("name");return t.extend({display_name:l,access_setting_string:n.displayAccessSetting(n.get("access_setting_id")),school:a,has_task:n.get("tasks").length>0,has_join:n.get("user_position").length>0,has_instructor:n.get("instructors").length>0,display_instructors_string:n.getDisplayInstructorsString(),has_instructional_users:n.get("instructional_users").length>0,can_manager:u,display_user_position:n.displayUserPosition(n.get("user_position")),display_user_position_sentence:n.displayUserPositionSentence(n.get("user_position")),is_open_type:"open"===n.get("access_setting_id"),is_email_type:"email"===n.get("access_setting_id"),is_code_type:"code"===n.get("access_setting_id"),is_no_one_type:"no_one"===n.get("access_setting_id"),is_fee_type:"fee"===n.get("access_setting_id"),is_not_available:!n.get("is_start")&&!n.get("is_end"),has_auth_read:n.get("user_position").length>0||"open"===n.get("access_setting_id"),can_invite:n.get("enable_mooc")||u},s)},getDisplayInstructorsString:function(){var e=this.get("instructors"),t="";if(e.length>0)for(var n in e)t+=e[n].display_name+", ";return t.substr(0,t.lastIndexOf(","))},initDefaults_:function(){},displayUserPosition:function(e){var t={instructor:"Instructor",student:"Student",coordinator:"Course Coordinator",teaching_assistant:"Teaching Assistant",graduate_assistant:"Graduate Assistant",external_reviewer:"External Reviewer",instructional_designer:"Instructional Designer",librarian:"Librarian",observer:"Observer"};return t[e]?t[e]:"Member"},displayUserPositionSentence:function(e){var t={instructor:"You're an Instructor in this Course",student:"You're a Student in this Course",coordinator:"You're a Course Coordinator in this Course",teaching_assistant:"You're a Teaching Assistant in this Course",graduate_assistant:"You're a Graduate Assistant in this Course",external_reviewer:"You're an External Reviewer in this Course",instructional_designer:"You're an Instructional Designer in this Course",librarian:"You're a Librarian in this Course",observer:"You're an Observer in this Course"};return t[e]?t[e]:"You're an Member in this Course"},displayAccessSetting:function(e){var t={code:"PIN",email:"Email request",no_one:"No one",open:"Any CN member"};return t[e]?t[e]:""}})}),define("modules/course/course-number",["jquery","underscore","modules/course/course"],function(e,t,n){return n.extend({urlRoot:"api/course_number/"})}),define("modules/conexus/conexus",["jquery","underscore","backbone","tools/string-help"],function(e,t,n,i){return n.Model.extend({urlRoot:"api/conexus/",defaults:function(){return{name:"",country_id:"",about:"",logo_attachment_id:"",logo_url:"img/common/avatar/conexus/default.png",country:{id:""},user_position:"",moderators:[],user_score:{sub_total:0},is_end:!1,is_open_type:!0}},initDefaults:function(){var n=this,r=["moderator","creater"],o=n.get("user_score");o=t.extend(o,{display_sub_total:i.addCommas(o.sub_total)});var s={user_score:o};return t.extend({display_name:n.get("name"),has_join:n.get("user_position").length>0,has_moderator:n.get("moderators").length>0,can_manager:e.inArray(n.get("user_position"),r)>-1,display_user_position:n.get("user_position").ucfirst(),is_new:n.isNew(),display_user_sub_total:i.addCommas(n.get("user_score").sub_total),display_moderators_string:n.getDisplayModeratorsString()},s)},getDisplayModeratorsString:function(){var e=this.get("moderators"),t="";if(e.length>0)for(var n in e)t+=e[n].display_name+", ";return t.substr(0,t.lastIndexOf(","))},validateFields:function(){var e=[],t=this.validateName();t&&e.push(t);var n=this.validateCountry();return n&&e.push(n),{errors:e,result:!e.length}},validateName:function(){var e=this.get("name");return t.isUndefined(e)||!e.length?"Please input Conexus name.":void 0},validateCountry:function(){var e=this.get("country_id");return t.isUndefined(e)||!e.length?"Please select your country.":void 0}})}),define("text!templates/common/card/user-profile.html",[],function(){return'<span class="text-hide icon-float-tip-arrow">Arrow</span>\r\n<a class=" text-hide bt-close-17 delete" href="javascript:;" title="close">Close</a>\r\n<div class="main">\r\n    {{#model}}\r\n    <div class="top">\r\n        <b title="{{display_name}}">{{display_name}}</b>\r\n        <div class="l-float chat-bt-wrap">\r\n            <a class="text-hide bt-chat-offline _bt_chat" href="javascript:;" data-id="{{id}}" data-online="{{is_online}}" style="margin-left: 5px;" title="chat">Chat</a>\r\n        	<b class="status _status">Offline</b>\r\n        </div>\r\n        <em>CN# {{cn_number}}</em>\r\n        <div class="clear"></div>\r\n    </div>\r\n    {{#result}}\r\n    <div class="center">\r\n        <div class="card-wrap">\r\n            {{#profile}}\r\n                {{#about}}\r\n                <div class="head break-word">\r\n                    <b>About {{cn_number}}:</b> {{{about}}}\r\n                </div>\r\n                {{/about}}\r\n                {{#display_tag_line}}\r\n                <div class="head break-word">\r\n                    <b>Tag Line:</b> {{display_tag_line}}\r\n                </div>\r\n                {{/display_tag_line}}\r\n            {{/profile}}\r\n            <div class="main">\r\n                <table class="block-user-relation-opt">\r\n                     <thead>\r\n                         <tr>\r\n                            <th>\r\n                                <a class="link load_send_email_window" href="javascript:;" data-id="{{id}}">\r\n                                    Email {{cn_number}}\r\n                                </a>\r\n                            </th>\r\n                            <th>\r\n                                <a class="link not_completed" href="javascript:;">\r\n                                    Report Member\r\n                                </a>\r\n                            </th>\r\n                            <th>\r\n                                {{#score}}\r\n                                <a class="anar-18-20 load_about_anar_window" href="javascript:;">\r\n                                    {{display_total}}\r\n                                </a>\r\n                                {{/score}}\r\n                            </th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                        <tr>\r\n                            <td>\r\n                            {{#relations}}\r\n                                {{#is_myself}}\r\n                                 <a class="bt-relation bt-relation-off">\r\n                                    <i>Follow</i>\r\n                                </a>\r\n                                {{/is_myself}}\r\n                                {{^is_myself}}\r\n                                <a class="\r\n                                    {{#display_is_my_following_user}}\r\n                                        remove_following bt-relation-on\r\n                                    {{/display_is_my_following_user}}\r\n                                    {{^display_is_my_following_user}}\r\n                                        add_following bt-relation-off\r\n                                    {{/display_is_my_following_user}} bt-relation " \r\n                                href="javascript:;">\r\n                                   <i> \r\n                                    {{#display_is_my_following_user}}\r\n                                        Following\r\n                                    {{/display_is_my_following_user}}\r\n                                    {{^display_is_my_following_user}}\r\n                                        Follow\r\n                                    {{/display_is_my_following_user}}\r\n                                   </i>\r\n                                </a>\r\n                                {{/is_myself}}\r\n                            {{/relations}}\r\n                            </td>\r\n                            <td>\r\n                            {{#relations}}\r\n                                {{#is_myself}}\r\n                                 <a class="bt-relation bt-relation-off">\r\n                                    <i>Colleague</i>\r\n                                </a>\r\n                                {{/is_myself}}\r\n                                {{^is_myself}}\r\n                                <a class="bt-relation \r\n                                    {{#display_is_my_colleague_user}}\r\n                                        remove_colleague bt-relation-on\r\n                                    {{/display_is_my_colleague_user}}\r\n                                    {{^display_is_my_colleague_user}}\r\n                                        {{#display_is_my_pending_colleague_user}}\r\n                                            bt-relation-pending\r\n                                        {{/display_is_my_pending_colleague_user}}\r\n                                        {{^display_is_my_pending_colleague_user}}\r\n                                            add_colleague bt-relation-off\r\n                                        {{/display_is_my_pending_colleague_user}}\r\n                                    {{/display_is_my_colleague_user}}" \r\n                                href="javascript:;">\r\n                                    <i>\r\n                                    {{#display_is_my_colleague_user}}\r\n                                        Colleague\r\n                                    {{/display_is_my_colleague_user}}\r\n                                    {{^display_is_my_colleague_user}}\r\n                                        {{#display_is_my_pending_colleague_user}}\r\n                                        Pending\r\n                                        {{/display_is_my_pending_colleague_user}}\r\n                                        {{^display_is_my_pending_colleague_user}}\r\n                                        Colleague\r\n                                        {{/display_is_my_pending_colleague_user}}\r\n                                    {{/display_is_my_colleague_user}}\r\n                                    </i>\r\n                                </a>\r\n                                {{/is_myself}}\r\n                            {{/relations}}\r\n                            </td>\r\n                            <td>\r\n                                <a class="bt-relation bt-relation-post" href="{{cn_number}}">\r\n                                    Posts\r\n                                </a>\r\n                            </td>\r\n                        </tr>\r\n                        {{#count}}\r\n                        <tr>\r\n                            <td>\r\n                                <em>{{display_follower_count}}</em>\r\n                            </td>\r\n                            <td>\r\n                                <em>{{display_colleague_count}}</em>\r\n                            </td>\r\n                            <td>\r\n                                <em>{{content}}</em>\r\n                            </td>\r\n                        </tr>\r\n                        {{/count}}\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    {{/result}}\r\n    {{^result}}\r\n    <div class="error-wrap _error">\r\n        <div class="block-loading block-horizontal-loading block_loading">\r\n            <img src="img/com/frontend/loading/horizontal.gif" alt="Loading" />\r\n        </div>\r\n    </div>\r\n    {{/result}}\r\n    {{/model}}\r\n</div>\r\n'}),define("text!templates/common/card/course-profile.html",[],function(){return'<span class="text-hide icon-float-tip-arrow">Arrow</span>\r\n<a class=" text-hide bt-close-17 delete" href="javascript:;" title="close">Close</a>\r\n<div class="main">\r\n{{#model}}\r\n    <div class="top">\r\n        <b title="{{display_name}}">{{display_name}}</b>\r\n        <em>CID {{course_id}}</em>\r\n        <div class="clear"></div>\r\n    </div>\r\n    {{#result}}\r\n    <div class="center">\r\n        <div class="card-wrap">\r\n            <div class="head">\r\n                <div class="left l-float">\r\n                    <img src="{{logo_url}}" alt="{{display_name}}" />\r\n                </div>\r\n                <div class="right l-float">\r\n                    <ul>\r\n                        {{#course_category.name}}\r\n                            <li>\r\n                                <b>{{course_category.name}}</b>\r\n                                <div class="clear"></div>\r\n                            </li>\r\n                        {{/course_category.name}}\r\n                        {{#school.name}}\r\n                            <li>\r\n                                <b>School:</b>\r\n                                <a class="link_bypass" {{#school.url}}href="{{school.url}}"{{/school.url}} target="_blank">\r\n                                    {{school.name}}\r\n                                </a>\r\n                                <div class="clear"></div>\r\n                            </li>\r\n                        {{/school.name}}\r\n                        <li>\r\n                            <b>Status:</b>\r\n                            {{#is_start}}\r\n                            <a class="icon-active">Active</a>\r\n                            {{/is_start}}\r\n                            {{#is_end}}\r\n                            <a class="icon-ended">Ended</a>\r\n                            {{/is_end}}\r\n                            {{#is_not_available}}\r\n                            <a class="">Unavailable</a>\r\n                            {{/is_not_available}}\r\n                            <div class="clear"></div>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <div class="clear"></div>\r\n            </div>\r\n            {{#about}}\r\n            <div class="main break-word">\r\n                {{{about}}}\r\n            </div>\r\n            {{/about}}\r\n            <div class="foot _foot">\r\n                \r\n            </div>\r\n        </div>\r\n    </div>\r\n    {{/result}}\r\n    {{^result}}\r\n    <div class="error-wrap _error">\r\n        <div class="block-loading block-horizontal-loading block_loading">\r\n            <img src="img/com/frontend/loading/horizontal.gif" alt="Loading" />\r\n        </div>\r\n    </div>\r\n    {{/result}}\r\n{{/model}}\r\n</div>\r\n'}),define("text!templates/common/card/conexus-profile.html",[],function(){return'<span class="text-hide icon-float-tip-arrow">Arrow</span>\r\n<a class=" text-hide bt-close-17 delete" href="javascript:;" title="close">Close</a>\r\n<div class="main">\r\n{{#model}}\r\n    <div class="top">\r\n        <b title="{{name}}">{{name}}</b>\r\n        <em>CID {{conexus_id}}</em>\r\n        <div class="clear"></div>\r\n    </div>\r\n    {{#result}}\r\n    <div class="center">\r\n        <div class="card-wrap">\r\n            <div class="head">\r\n                <div class="left l-float">\r\n                    <img src="{{logo_url}}" alt="{{name}}" />\r\n                </div>\r\n                <div class="right l-float">\r\n                    <ul>\r\n                        <li>\r\n                            <b>Status:</b>\r\n                            <a class="icon-active">Active</a>\r\n                            <div class="clear"></div>\r\n                        </li>\r\n                    </ul>\r\n                </div>\r\n                <div class="clear"></div>\r\n            </div>\r\n            {{#about}}\r\n            <div class="main break-word">\r\n                {{{about}}}\r\n            </div>\r\n            {{/about}}\r\n            <div class="foot _foot">\r\n                \r\n            </div>\r\n        </div>\r\n    </div>\r\n    {{/result}}\r\n    {{^result}}\r\n    <div class="error-wrap _error">\r\n        <div class="block-loading block-horizontal-loading block_loading">\r\n            <img src="img/com/frontend/loading/horizontal.gif" alt="Loading" />\r\n        </div>\r\n    </div>\r\n    {{/result}}\r\n{{/model}}\r\n</div>\r\n'}),define("views/common/card/profile",["jquery","underscore","backbone","tools/view/user-relation-manager","views/course/common/sidebar/operate","views/conexus/common/sidebar/operate","modules/user/user","modules/user/cn-number","modules/course/course","modules/course/course-number","modules/conexus/conexus","text!templates/common/card/user-profile.html","text!templates/common/card/course-profile.html","text!templates/common/card/conexus-profile.html"],function(e,t,n,i,r,o,s,a,u,l,c,d,f,h){var p={user:s,course:u,conexus:c,course_number:l,cn_number:a},m=n.View.extend({initialize:function(e){t.bindAll(this,"initialize_","beforeRender_","afterRender_","deleted","resultFalse"),this.data=e.data,this.style=e.style,this.data.result=!1,this.model=new p[this.data.type]({id:this.data.id}),this.$el.css({left:this.style.offset.left,top:this.style.offset.top}),this.initialize_(e)},initialize_:function(){},serialize:function(){return{result:this.data.result,model:this.model.toJSON()}},beforeRender:function(){this.beforeRender_()},beforeRender_:function(){},afterRender:function(){this.afterRender_()},afterRender_:function(){},deleted:function(){this.remove()},resultFalse:function(e){var n="";t.each(e,function(e){n+=e+"<br />"}),n.length||(n='Please close this window and refresh the page. <br/> <a href="mailto:help@thecn.com" target="_blank">help@thecn.com</a>'),this.$("._error").html(n)}}),g=m.extend({className:"block-float-down-box block-float-down-left-box block-user-profile-card block-float-profile-card block_float_profile_card",template:d,initialize_:function(){var e=this;this.model.addUrlParam({with_user_relations:1,with_user_score:1,with_user_count:1,with_user_profile:1}),this.model.fetch({resultTrue:function(t){e.data.result=!0,e.render(),window.CN_CONFIG.nodeApps.enable&&window.now&&now.checkIsOnlineByUserId(t.get("id"),function(t){t&&(e.$("._bt_chat").addClass("bt-chat-online chat_button"),e.$("._status").html("Online"))})},resultFalse:e.resultFalse}),this.model.on("change:display_is_my_following_user",this.render,this),this.model.on("change:display_is_my_colleague_user",this.render,this),this.model.on("change:display_is_my_pending_colleague_user",this.render,this),this.model.on("change:display_follower_count",this.render,this)},events:{"click .delete":"deleted","click .add_colleague":"addColleague","click .remove_colleague":"removeColleague","click .add_following":"addFollowing","click .remove_following":"removeFollowing"},addColleague:function(){i.addColleague(this.model)},removeColleague:function(){i.removeColleague(this.model)},addFollowing:function(){i.addFollowing(this.model)},removeFollowing:function(){i.removeFollowing(this.model)}}),v=m.extend({className:"block-float-down-box block-float-down-left-box block-course-profile-card block-float-profile-card block_float_profile_card",template:f,events:{"click .delete":"deleted"},initialize_:function(){var e=this;this.model.addUrlParam({with_course_school:1,with_course_course_category:1}),this.model.fetch({resultTrue:function(t){e.data.result=!0,e.render(),e.$("._foot").html(new r({model:t}).render().view.el)},resultFalse:e.resultFalse})}}),y=m.extend({className:"block-float-down-box block-float-down-left-box block-course-profile-card block-float-profile-card block_float_profile_card",template:h,events:{"click .delete":"deleted"},initialize_:function(){var e=this;this.model.fetch({resultTrue:function(t){e.data.result=!0,e.render(),e.$("._foot").html(new o({model:t}).render().view.el)},resultFalse:e.resultFalse})}}),b=m.extend({className:"block-float-down-box block-float-down-left-box block-course-profile-card block-float-profile-card block_float_profile_card",template:f,events:{"click .delete":"deleted"},initialize_:function(){var e=this;this.model.addUrlParam({with_course_school:1,with_course_course_category:1}),this.model.fetch({resultTrue:function(t){e.data.result=!0,e.render(),e.$("._foot").html(new r({model:t}).render().view.el)},resultFalse:e.resultFalse})}}),_={user:g,course:v,conexus:y,course_number:b,cn_number:g};return{get:function(e){return _[e]}}}),define("tools/profile-card",["jquery","views/common/card/profile"],function(e,t){return{init:function(){var n=[],i=!1,r=[],o=function(){for(var e in n)n.hasOwnProperty(e)&&n[e].remove()},s=function(e){if(e=isNaN(e)?300:e,e>0){var t=setTimeout(o,e);r.push(t)}else o()},a=function(){for(var e in r)clearTimeout(r[e])},u=!1;e(document).on("mouseleave",".show_card[data-id][data-type]",function(){u&&clearTimeout(u),s()}),e(document).on("mouseenter",".show_card[data-id][data-type]",function(r){var o=e(r.currentTarget),s=o.attr("data-id"),a=o.attr("data-type");-1!=e.inArray(a,["cn_number","user","course","conexus","course_number"])&&(i!=s&&(e(".block_float_profile_card").remove(),n=[],i=s),function(i,r,o){u=setTimeout(function(){if(!i||0>=i.length||!i.is(":visible"))return!1;var s=i.height(),a=i.offset().top+(s?s:12),u=i.offset().left-27+i.width()/2,l=new(t.get(o))({data:{id:r,type:o},style:{offset:{top:a,left:u}}}),c=l.render().view;return!i||0>=i.length||!i.is(":visible")?!1:(e("#wrap_home").prepend(c.el),n.push(c),void 0)},500)}(o,s,a))}),e(document).on({mouseenter:function(){a()},mouseleave:function(){s()}},".block_float_profile_card")}}}),define("tools/browser-detect",["jquery"],function(){return{init:function(){return this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS",this},searchString:function(e){for(var t=0;e.length>t;t++){var n=e[t].string,i=e[t].prop;if(this.versionSearchString=e[t].versionSearch||e[t].identity,n){if(-1!=n.indexOf(e[t].subString))return e[t].identity}else if(i)return e[t].identity}},searchVersion:function(e){var t=e.indexOf(this.versionSearchString);if(-1!=t)return parseFloat(e.substring(t+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone"},{string:navigator.userAgent,subString:"iPod",identity:"iPod"},{string:navigator.userAgent,subString:"iPad",identity:"iPad"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}),define("tools/place-holder",["jquery"],function(e){var t={};return t.isApply=function(){return document.createElement("input").placeholder===void 0},t.validTypes=["text","search","url","tel","email","password","number","textarea"],t.settings={live:!1,textColor:"gray"},t.run=function(){for(var n=document.getElementsByTagName("input"),i=document.getElementsByTagName("textarea"),r=n.length,o=r+i.length,s=0;o>s;s+=1){var a=r>s?n[s]:i[s-r],u=a.getAttribute("placeholder");if(e.inArray(a.type,t.validTypes)>-1&&u){var l="password"===a.type?a.getAttribute("data-placeholdertype"):a.getAttribute("data-currentplaceholder");u!==l&&(l||t.event(a))}}},t.event=function(n){if(""===e(n).val()&&""!==e(n).attr("placeholder")){var i=e(n).attr("placeholder");"Password"===e(n).attr("data-placeholdertype")&&(n.type="text"),e(n).val(i),e(n).css({color:t.settings.textColor})}if(e(n).blur(function(){var i=e(this).val(),r=e(this).attr("placeholder");""===i&&("Password"===e(this).attr("data-placeholdertype")&&(n.type="text"),e(this).val(r),e(n).css({color:t.settings.textColor}))}),e(n).closest("form").length>0){var r=e(n).closest("form");e(r).on("submit",function(){e(n).val()===e(n).attr("placeholder")&&e(n).val("")})}e(n).focus(function(){e(n).keydown(function(){e(n).css({color:"black"}),"Password"===e(this).attr("data-placeholdertype")&&(n.type="password");var t=e(this).val(),i=e(this).attr("placeholder");i===t&&e(this).val("")})})},{init:function(n){"object"===e.type(n)&&(t.settings=e.extend(!0,{},t.settings,n)),t.isApply()&&(t.run(),t.settings.live&&setInterval(t.run,500))}}}),require(["app","controller","tools/url-helper","tools/back-to-top","tools/pop-up-window","tools/regs","tools/profile-card","tools/browser-detect","tools/place-holder"],function(e,t,n,i,r,o,s,a,u){var l=r.get("function");
Backbone.history.start({pushState:!0,root:e.root}),$(document).on("click","a:not(.link_bypass)",function(n){var i={prop:$(this).prop("href"),attr:$(this).attr("href")},r=location.protocol+"//"+location.host+e.root;i.prop&&i.prop.slice(0,r.length)===r&&!o.check("url",i.attr)&&(n.preventDefault(),t.go(i.attr))}),$(document).on("click",".not_completed",function(){return l.alert("This function is not currently available."),!1}),$(document).on("click",".load_send_email_window",function(e){var t=$(e.currentTarget).attr("data-id");return require(["views/common/pop-up-window/controllers/send-email"],function(e){e(t)}),!1}),$(document).on("click",".create_personal_list",function(){require(["views/common/pop-up-window/create-personal-list"],function(e){l.open((new e).render().view.el)})}),$(document).on("click",".load_about_anar_window",function(){require(["views/text/about-anar"],function(e){l.open((new e).render().view.el)})}),$(document).on("click",".text_terms_of_use",function(){require(["views/text/terms-of-use"],function(e){l.open((new e).render().view.el)})}),$(document).on("click",".load_login_window",function(){require(["views/common/pop-up-window/login"],function(e){l.open((new e).render().view.el)})}),$(document).on("click",".load_register_window",function(){require(["views/common/pop-up-window/register"],function(e){l.open((new e).render().view.el)})}),$(document).on("click",".text_privacy_policy",function(){require(["views/text/privacy-policy"],function(e){l.open((new e).render().view.el)})}),$(document).on("click",'form [type="submit"]',function(){var e=!1,t=function(){var t=$(this);$.trim(t.val())||(e||(e=!0,i.run()),t.focus())};$(this).closest("form").not($(".form_reflect")).find('[required="required"]').each(t)}),$(document).on("click",".prev_router",function(){}),$(document).on("focus","textarea",function(){var e=this,t=$(this).closest("form"),n=$(this).height();$(this).attr("minHeight")||$(this).attr({minHeight:n}),t.submit(function(){$(e).height($(e).attr("minHeight"))}),$(this).autosize()}),$(document).on("click",".register_forgot_password",function(){require(["views/common/pop-up-window/forgot-pasword"],function(e){new e({email:$.trim($("#User_email").val())}).create()})}),$(document).on("click",".show_facebook_register",function(){require(["views/common/pop-up-window/facebook-register"],function(e){l.open((new e).render().view.el)})});var c=function(){require(["views/common/pop-up-window/twitter-register"],function(e){l.open((new e).render().view.el)})};"twitter"===n.getUrlVar("from")&&n.getUrlVar("oauth_verifier")&&c(),$(document).on("click",".show_twitter_register",function(){c()}),$(document).ready(function(){i.init(),u.init({live:!0}),l.bindGalleryNormal({element:$(".gallery_showing_img")}),l.bindGalleryNormal({element:$(".show_avatar"),maxWidth:400,maxHeight:400,minWidth:400,minHeight:400}),s.init();var e=a.init();"Explorer"===e.browser&&8>e.version&&require(["views/text/no-browser"],function(e){l.open((new e).render().view.el)}),$("body").addClass("cn-"+e.OS.toLowerCase())})}),define("main",function(){});